geom_hline(aes(yintercept = cmcHigh),
colour = "black",
linetype = "dashed") +
geom_text(aes(x = min(theta) + 3,
y = cmcHigh,
label = paste0("High CMC = ",cmcHigh)),
nudge_y = 1,
fontface = "plain",
family = "sans")
dplyr::bind_rows(
km1_unknown1_comparison$comparison_1to2$ccfResults %>%
cmcR:::cmcFilterPerTheta(consensus_function = median,
corr_thresh = .8,
dx_thresh = 15,
dy_thresh = 15,
theta_thresh = 3) %>%
dplyr::mutate(comparison = "A vs. B"),
km1_unknown1_comparison$comparison_2to1$ccfResults %>%
cmcR:::cmcFilterPerTheta(consensus_function = median,
corr_thresh = .8,
dx_thresh = 15,
dy_thresh = 15,
theta_thresh = 3) %>%
dplyr::mutate(comparison = "B vs. A")
) %>%
dplyr::group_by(comparison,theta) %>%
dplyr::tally() %>%
dplyr::mutate(cmcHigh = max(n) - 1)  %>%
ggplot(aes(x = theta,y = n)) +
geom_bar(stat = "identity") +
theme_bw()  +
xlab(expression(theta*" (degree)")) +
ylab("CMC number") +
facet_wrap(~ comparison,ncol = 1)  +
ylim(c(NA,25)) +
geom_hline(aes(yintercept = cmcHigh),
colour = "black",
linetype = "dashed") +
geom_text(aes(x = min(theta) + 3,
y = cmcHigh,
label = paste0("High CMC = ",cmcHigh)),
nudge_y = 1,
fontface = "plain",
family = "sans")
bind_rows(
km1_unknown1_comparison$comparison_1to2$ccfResults %>%
cmcR:::cmcFilterPerTheta(consensus_function = median,
corr_thresh = .8,
dx_thresh = 15,
dy_thresh = 15,
theta_thresh = 3) %>%
mutate(comparison = "A vs. B"),
km1_unknown1_comparison$comparison_2to1$ccfResults %>%
cmcR:::cmcFilterPerTheta(consensus_function = median,
corr_thresh = .8,
dx_thresh = 15,
dy_thresh = 15,
theta_thresh = 3) %>%
mutate(comparison = "B vs. A")
) %>%
group_by(comparison,theta) %>%
tally() %>%
mutate(cmcHigh = max(n) - 1)  %>%
ggplot(aes(x = theta,y = n)) +
geom_bar(stat = "identity") +
theme_bw()  +
xlab(expression(theta*" (degree)")) +
ylab("CMC number") +
facet_wrap(~ comparison,ncol = 1)  +
ylim(c(NA,25)) +
geom_hline(aes(yintercept = cmcHigh),
colour = "black",
linetype = "dashed") +
geom_text(aes(x = min(theta) + 3,
y = cmcHigh,
label = paste0("High CMC = ",cmcHigh)),
nudge_y = 1,
fontface = "plain",
family = "sans")
bind_rows(
km1_unknown2_comparison$comparison_1to2$ccfResults %>%
cmcR:::cmcFilterPerTheta(consensus_function = median,
corr_thresh = .8,
dx_thresh = 15,
dy_thresh = 15,
theta_thresh = 3) %>%
mutate(comparison = "A vs. B"),
km1_unknown2_comparison$comparison_2to1$ccfResults %>%
cmcR:::cmcFilterPerTheta(consensus_function = median,
corr_thresh = .8,
dx_thresh = 15,
dy_thresh = 15,
theta_thresh = 3) %>%
mutate(comparison = "B vs. A")
) %>%
group_by(comparison,theta) %>%
tally() %>%
mutate(cmcHigh = max(n) - 1) %>%
ggplot(aes(x = theta,y = n)) +
geom_bar(stat = "identity") +
theme_bw() +
xlab(expression(theta*" (degree)")) +
ylab("CMC number") +
facet_wrap(~ comparison,ncol = 1) +
ylim(c(NA,25))  +
geom_hline(aes(yintercept = cmcHigh),
colour = "black",
linetype = "dashed") +
geom_text(aes(x = min(theta) + 3,
y = cmcHigh,
label = paste0("High CMC = ",cmcHigh)),
nudge_y = 1,
fontface = "plain",
family = "sans")
set.seed(3152020) #RANSAC method is based on randomly sampling points in matrix
km1_residuals <- km1_raw %>%
x3ptools::sample_x3p(m = 2) #down-sampled copy of km1_raw
km1_residuals$surface.matrix <- km1_residuals$surface.matrix %>%
preProcess_ransac(inlierTreshold = 10^(-5),
finalSelectionThreshold = 2*(10^(-5)),
iters = 150) %>%
preProcess_levelBF(useResiduals = TRUE) %>%
preProcess_ransac(inlierTreshold = .1*(10^(-5)),
finalSelectionThreshold = 2*(10^(-5)),
iters = 300) %>%
preProcess_levelBF(useResiduals = TRUE) %>%
preProcess_cropWS(croppingThresh = 2) %>%
preProcess_removeFPCircle(aggregation_function = mean,
smootherSize = 2*round((.1*nrow(.)/2)) + 1,
meshSize = 1,
houghScoreQuant = .9) %>%
preProcess_gaussFilter(res = km1_residuals$header.info$incrementY,
wavelength = 16,
filtertype = "lp")
km1_residuals$surface.matrix %>%
imager::as.cimg() %>%
plot()
km1_residuals %>%
x3ptools::image_x3p(zoom = .7)
set.seed(3152020)
km2_residuals <- selectBFImpression_sample_x3p(x3p_path = "../../bulletCartridgeScans/fadul_allScans/Fadul_1/cc/Fadul 1-2.x3p",
ransacIters = 150,
ransacInlierThresh = 10^-5,
ransacFinalSelectThresh = 2*(10^-5),
useResiduals = TRUE)
unknown1_residuals <- selectBFImpression_sample_x3p(x3p_path = "../../bulletCartridgeScans/fadul_allScans/Fadul_2/cc/Fadul 2-1.x3p",
ransacIters = 150,
ransacInlierThresh = 10^-5,
ransacFinalSelectThresh = 2*(10^-5),
useResiduals = TRUE)
unknown2_residuals <- selectBFImpression_sample_x3p(x3p_path = "../../bulletCartridgeScans/fadul_allScans/Fadul_1/cc/Fadul F.x3p",
ransacIters = 150,
ransacInlierThresh = 10^-5,
ransacFinalSelectThresh = 2*(10^-5),
useResiduals = TRUE)
km2_residuals$x3p$surface.matrix <-
cmcR::preProcess_gaussFilter(surfaceMat = km2_residuals$x3p$surface.matrix,
res = km2_residuals$x3p$header.info$incrementY,
wavelength = 16,
filtertype = "lp")
unknown1_residuals$x3p$surface.matrix <-
cmcR::preProcess_gaussFilter(surfaceMat = unknown1_residuals$x3p$surface.matrix,
res = unknown1_residuals$x3p$header.info$incrementY,
wavelength = 16,
filtertype = "lp")
unknown2_residuals$x3p$surface.matrix <-
cmcR::preProcess_gaussFilter(surfaceMat = unknown2_residuals$x3p$surface.matrix,
res = unknown2_residuals$x3p$header.info$incrementY,
wavelength = 16,
filtertype = "lp")
km1_residuals$surface.matrix %>%
imager::as.cimg() %>%
plot()
km2_residuals$x3p$surface.matrix %>%
imager::as.cimg() %>%
plot()
unknown1_residuals$x3p$surface.matrix %>%
imager::as.cimg() %>%
plot()
unknown2_residuals$x3p$surface.matrix %>%
imager::as.cimg() %>%
plot()
km1_unknown1_comparison <- cellCCF_bothDirections(km1_residuals,
unknown1_residuals$x3p,
thetas = seq(-30,30,by = 3),
cellNumHoriz = 8,
cellNumVert = 8,
regionToCellProp = 4,
minObservedProp = .15,
centerCell = "individualCell",
scaleCell = "individualCell")
km1_unknown1_comparison$comparison_1to2$ccfResults$`0`
km1_unknown1_comparison$comparison_1to2$ccfResults$`0` %>%
head()
km1_unknown1_comparison$comparison_1to2$ccfResults$`0` %>%
head()
km1_unknown1_comparison$comparison_1to2$ccfResults$`15` %>%
head()
km1_unknown1_comparison$comparison_1to2$ccfResults$`21` %>%
head()
km1_unknown1_comparison$comparison_1to2$ccfResults$`-21` %>%
head()
km1_unknown1_comparison$comparison_1to2$ccfResults$`21` %>%
head()
?cor
km1_unknown1_comparison$comparison_1to2$ccfResults$`21` %>%
head()
km1_unknown2_comparison <- cellCCF_bothDirections(km1_residuals,
unknown2_residuals$x3p,
thetas = seq(-30,30,by = 3),
cellNumHoriz = 8,
cellNumVert = 8,
regionToCellProp = 4,
minObservedProp = .15,
centerCell = "individualCell",
scaleCell = "individualCell")
km1_unknown1_comparison$comparison_1to2$ccfResults %>%
topResultsPerCell()
km1_unknown1_comparison$comparison_1to2$ccfResults$`21` %>%
knitr::kable()
install.packages("kableExtra")
km1_unknown1_comparison$comparison_1to2$ccfResults %>%
topResultsPerCell() %>%
knitr::kable() %>%
kableExtra::kable_styling()
km1_unknown1_comparison$comparison_1to2$ccfResults %>%
topResultsPerCell() %>%
knitr::kable() %>%
xtable::xtable()
km1_unknown1_comparison$comparison_1to2$ccfResults %>%
topResultsPerCell() %>%
# knitr::kable() %>%
xtable::xtable()
km1_unknown1_comparison$comparison_1to2$ccfResults %>%
topResultsPerCell() %>%
knitr::kable()
km1_unknown1_comparison$comparison_1to2$ccfResults$`21` %>%
DT::datatable()
km1_unknown1_comparison$comparison_1to2$ccfResults %>%
topResultsPerCell() %>%
DT::datatable()
km1_unknown1_cmcs <- cmcR::cmcFilter_improved(km1_unknown1_comparison,
consensus_function = median,
corr_thresh = .8,
dx_thresh = 15)
km1_unknown2_cmcs <- cmcR::cmcFilter_improved(km1_unknown2_comparison,
consensus_function = median,
corr_thresh = .8,
dx_thresh = 15)
km1_unknown1_cmcs$finalCMCs
km1_unknown1_cmcs$initialCMCs
km1_unknown2_cmcs$initialCMCs
km1_unknown2_cmcs$finalCMCs
km1_unknown2_cmcs$finalCMCs %>%
arrange(cellNum)
km1_unknown2_cmcs$finalCMCs %>%
arrange(cellNum) %>%
DT::datatable()
km1_unknown1_comparison$comparison_1to2$ccfResults %>%
topResultsPerCell() %>%
cmcFilter(corr_thresh = .8,
dx_thresh = 15)
km1_unknown2_comparison$comparison_1to2$ccfResults %>%
topResultsPerCell() %>%
cmcFilter(corr_thresh = .8,
dx_thresh = 15)
imager::imlist(
km1_raw$surface.matrix %>%
imager::as.cimg()
km2_raw$surface.matrix %>%
imager::imlist(
km1_raw$surface.matrix %>%
imager::as.cimg(),
km2_raw$surface.matrix %>%
imager::as.cimg(),
unknown1_raw$surface.matrix %>%
imager::as.cimg(),
unknown2_raw$surface.matrix %>%
imager::as.cimg(),
) %>%
plot()
imager::imlist(
km1_raw$surface.matrix %>%
imager::as.cimg(),
km2_raw$surface.matrix %>%
imager::as.cimg(),
unknown1_raw$surface.matrix %>%
imager::as.cimg(),
unknown2_raw$surface.matrix %>%
imager::as.cimg()
) %>%
plot()
imager::imlist(
km1_raw$surface.matrix %>%
imager::as.cimg(),
km2_raw$surface.matrix %>%
imager::as.cimg(),
unknown1_raw$surface.matrix %>%
imager::as.cimg(),
unknown2_raw$surface.matrix %>%
imager::as.cimg()
) %>%
plot(xlim = c(0,1500))
bind_rows(
km1_unknown1_comparison$comparison_1to2$ccfResults %>%
cmcR:::cmcFilterPerTheta(consensus_function = median,
corr_thresh = .8,
dx_thresh = 15,
dy_thresh = 15,
theta_thresh = 3) %>%
mutate(comparison = "A vs. B"),
km1_unknown1_comparison$comparison_2to1$ccfResults %>%
cmcR:::cmcFilterPerTheta(consensus_function = median,
corr_thresh = .8,
dx_thresh = 15,
dy_thresh = 15,
theta_thresh = 3) %>%
mutate(comparison = "B vs. A")
) %>%
group_by(comparison,theta) %>%
tally() %>%
mutate(cmcHigh = max(n) - 1)  %>%
ggplot(aes(x = theta,y = n)) +
geom_bar(stat = "identity") +
theme_bw()  +
xlab(expression(theta*" (degree)")) +
ylab("CMC number") +
facet_wrap(~ comparison,ncol = 1)  +
ylim(c(NA,25)) +
geom_hline(aes(yintercept = cmcHigh),
colour = "black",
linetype = "dashed") +
geom_text(aes(x = min(theta) + 3,
y = cmcHigh,
label = paste0("High CMC = ",cmcHigh)),
nudge_y = 1,
fontface = "plain",
family = "sans")
bind_rows(
km1_unknown2_comparison$comparison_1to2$ccfResults %>%
cmcR:::cmcFilterPerTheta(consensus_function = median,
corr_thresh = .8,
dx_thresh = 15,
dy_thresh = 15,
theta_thresh = 3) %>%
mutate(comparison = "A vs. B"),
km1_unknown2_comparison$comparison_2to1$ccfResults %>%
cmcR:::cmcFilterPerTheta(consensus_function = median,
corr_thresh = .8,
dx_thresh = 15,
dy_thresh = 15,
theta_thresh = 3) %>%
mutate(comparison = "B vs. A")
) %>%
group_by(comparison,theta) %>%
tally() %>%
mutate(cmcHigh = max(n) - 1) %>%
ggplot(aes(x = theta,y = n)) +
geom_bar(stat = "identity") +
theme_bw() +
xlab(expression(theta*" (degree)")) +
ylab("CMC number") +
facet_wrap(~ comparison,ncol = 1) +
ylim(c(NA,25))  +
geom_hline(aes(yintercept = cmcHigh),
colour = "black",
linetype = "dashed") +
geom_text(aes(x = min(theta) + 3,
y = cmcHigh,
label = paste0("High CMC = ",cmcHigh)),
nudge_y = 1,
fontface = "plain",
family = "sans")
set.seed(3152020) #RANSAC method is based on randomly sampling points in matrix
km1_residuals <- km1_raw %>%
x3ptools::sample_x3p(m = 2) #down-sampled copy of km1_raw
km1_residuals$surface.matrix <- km1_residuals$surface.matrix %>%
preProcess_ransac(inlierTreshold = 10^(-5),
finalSelectionThreshold = 2*(10^(-5)),
iters = 150) %>%
preProcess_levelBF(useResiduals = TRUE) %>%
preProcess_ransac(inlierTreshold = .1*(10^(-5)),
finalSelectionThreshold = 2*(10^(-5)),
iters = 300) %>%
preProcess_levelBF(useResiduals = TRUE) %>%
preProcess_cropWS(croppingThresh = 2) %>%
preProcess_removeFPCircle(aggregation_function = mean,
smootherSize = 2*round((.1*nrow(.)/2)) + 1,
meshSize = 1,
houghScoreQuant = .9) %>%
preProcess_gaussFilter(res = km1_residuals$header.info$incrementY,
wavelength = 16,
filtertype = "lp")
km1_residuals %>%
x3ptools::image_x3p(zoom = .7)
km2_residuals <- selectBFImpression_sample_x3p(x3p_path = "../../bulletCartridgeScans/fadul_allScans/Fadul_1/cc/Fadul 1-2.x3p",
ransacIters = 150,
ransacInlierThresh = 10^-5,
ransacFinalSelectThresh = 2*(10^-5),
useResiduals = TRUE)
unknown1_residuals <- selectBFImpression_sample_x3p(x3p_path = "../../bulletCartridgeScans/fadul_allScans/Fadul_2/cc/Fadul 2-1.x3p",
ransacIters = 150,
ransacInlierThresh = 10^-5,
ransacFinalSelectThresh = 2*(10^-5),
useResiduals = TRUE)
unknown2_residuals <- selectBFImpression_sample_x3p(x3p_path = "../../bulletCartridgeScans/fadul_allScans/Fadul_1/cc/Fadul F.x3p",
ransacIters = 150,
ransacInlierThresh = 10^-5,
ransacFinalSelectThresh = 2*(10^-5),
useResiduals = TRUE)
unknown2_residuals <- selectBFImpression_sample_x3p(x3p_path = "../../bulletCartridgeScans/fadul_allScans/Fadul_1/cc/Fadul F.x3p",
ransacIters = 150,
ransacInlierThresh = 10^-5,
ransacFinalSelectThresh = 2*(10^-5),
useResiduals = TRUE)
km2_residuals$x3p$surface.matrix <-
cmcR::preProcess_gaussFilter(surfaceMat = km2_residuals$x3p$surface.matrix,
res = km2_residuals$x3p$header.info$incrementY,
wavelength = 16,
filtertype = "lp")
unknown1_residuals$x3p$surface.matrix <-
cmcR::preProcess_gaussFilter(surfaceMat = unknown1_residuals$x3p$surface.matrix,
res = unknown1_residuals$x3p$header.info$incrementY,
wavelength = 16,
filtertype = "lp")
unknown2_residuals$x3p$surface.matrix <-
cmcR::preProcess_gaussFilter(surfaceMat = unknown2_residuals$x3p$surface.matrix,
res = unknown2_residuals$x3p$header.info$incrementY,
wavelength = 16,
filtertype = "lp")
par(mar = c(1,1,1,1))
imager::imlist(
km1_residuals$surface.matrix %>%
imager::as.cimg(),
km2_residuals$x3p$surface.matrix %>%
imager::as.cimg(),
unknown1_residuals$x3p$surface.matrix %>%
imager::as.cimg(),
unknown2_residuals$x3p$surface.matrix %>%
imager::as.cimg()
) %>%
plot(main = "")
imager::imlist(
km1_residuals$surface.matrix %>%
imager::as.cimg(),
km2_residuals$x3p$surface.matrix %>%
imager::as.cimg(),
unknown1_residuals$x3p$surface.matrix %>%
imager::as.cimg(),
unknown2_residuals$x3p$surface.matrix %>%
imager::as.cimg()
) %>%
plot()
imager::imlist(
km1_residuals$surface.matrix %>%
imager::as.cimg(),
km2_residuals$x3p$surface.matrix %>%
imager::as.cimg(),
unknown1_residuals$x3p$surface.matrix %>%
imager::as.cimg(),
unknown2_residuals$x3p$surface.matrix %>%
imager::as.cimg()
) %>%
setNames(NULL) %>%
plot()
devtools::build_vignettes()
pkgdown::build_site()
person(given = "Joe",family = "Zemmels",email = "jzemmels@iastate.edu",role = c("aut","cre"))
usethis::use_package("x3ptools")
usethis::use_package("dplyr")
usethis::use_package("ggplot2")
usethis::use_package("imager")
usethis::use_package("cartridges3D")
usethis::use_package("purrr")
as.person(c("Joe Zemmels <jzemmels@iastate.edu> [aut,cre]","Heike Hofmann <hofmann@iastate.edu> [aut]","Susan VanderPlas <susan.vanderplas@unl.edu> [aut]"))
usethis::use_package("zoo")
library(cmcR)
library(cmcR)
usethis::use_package("stringr")
?zoo
?zoo::zoo
library(cmcR)
pkgdown::build_site()
pkgdown::build_site()
devtools::document()
library(cmcR)
devtools::document()
library(cmcR)
devtools::document()
pkgdown::build_site()
pkgdown::build_site()
devtools::document()
devtools::document()
devtools::document()
warnings()
devtools::build_vignettes()
devtools::build_site()
pkgdown::build_site()
devtools::document()
floor(c(1.4,2.5))
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
library(cmcR)
devtools::document()
devtools::document()
library(cmcR)
library(cmcR)
