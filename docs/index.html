<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>An implementation of the Congruent Matching Cells method for cartridge case identification • cmcR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="An implementation of the Congruent Matching Cells method for cartridge case identification">
<meta property="og:description" content="An open-source implementation of the Congruent Matching Cells 
    method for cartridge case identification as proposed by Song (2013) as well 
    as an extension of the method proposed by Tong et al. (2015).
    Provides a wide range of pre, inter, and post-processing options when
    working with cartridge case scan data and their associated comparisons. See
    the cmcR package website for more details and examples.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">cmcR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/cmcFilter_improved-function-options.html">cmcFilter_improved function options</a>
    </li>
    <li>
      <a href="articles/cmcR_plotReproduction.html">Reproduction of Song et al. (2018) plots using the cmcR package</a>
    </li>
    <li>
      <a href="articles/reproducibleExample.html">cmcR Reproducible Example</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="cmcr" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#cmcr" class="anchor"></a>cmcR</h1></div>
<!-- badges: start -->

<p>The cmcR package provides an open-source implementation of the Congruent Matching Cells method for cartridge case identification as proposed by <a href="https://tsapps.nist.gov/publication/get_pdf.cfm?pub_id=911193">Song (2013)</a> as well as the “High CMC” method proposed by <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4730689/pdf/jres.120.008.pdf">Tong et al. (2015)</a>.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<!-- You can install the released version of cmcR from [CRAN](https://CRAN.R-project.org) with: -->
<!-- ``` r -->
<!-- install.packages("cmcR") -->
<!-- ``` -->
<p>Install the development version from <a href="https://github.com/jzemmels/cmcR">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="r"><span class="co"># install.packages("devtools")</span>
<span class="kw pkg">devtools</span><span class="kw ns">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span>(<span class="st">"jzemmels/cmcR"</span>)</pre></div>
<p>Cartridge case scan data can be accessed at the <a href="https://tsapps.nist.gov/NRBTD/Studies/Search">NIST Ballisitics and Toolmarks Research Database</a></p>
</div>
<div id="example" class="section level2">
<h2 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h2>
<p>We will illustrate the package functionality here. This intended to be a concise demonstration, so please refer to the package vignettes available under the “Articles” tab of the <a href="https://csafe-isu.github.io/cmcR/index.html">package website</a> for more detailed information.</p>
<div class="sourceCode" id="cb2"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">cmcR</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">magrittr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">4132020</span>)</pre></div>
<p>Consider the known match cartridge case pair Fadul 1-1 and Fadul 1-2. The <code>read_x3p</code> function from the <a href="https://github.com/heike/x3ptools">x3ptools</a> package can read scans from the <a href="https://tsapps.nist.gov/NRBTD/Studies/Search">NBTRD</a> given the appropriate address. The two scans are read below and visualized using the <a href="https://csafe-isu.github.io/cmcR/reference/x3pListPlot.html"><code>x3pListPlot</code></a> function.</p>
<div class="sourceCode" id="cb3"><pre class="r"><span class="no">fadul1.1</span> <span class="kw">&lt;-</span> <span class="kw pkg">x3ptools</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/x3ptools/man/x3p_read.html">read_x3p</a></span>(<span class="st">"https://tsapps.nist.gov/NRBTD/Studies/CartridgeMeasurement/DownloadMeasurement/2d9cc51f-6f66-40a0-973a-a9292dbee36d"</span>)

<span class="no">fadul1.2</span> <span class="kw">&lt;-</span> <span class="kw pkg">x3ptools</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/x3ptools/man/x3p_read.html">read_x3p</a></span>(<span class="st">"https://tsapps.nist.gov/NRBTD/Studies/CartridgeMeasurement/DownloadMeasurement/cb296c98-39f5-46eb-abff-320a2f5568e8"</span>)

<span class="kw pkg">cmcR</span><span class="kw ns">::</span><span class="fu"><a href="reference/x3pListPlot.html">x3pListPlot</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">"Fadul 1-1"</span> <span class="kw">=</span> <span class="no">fadul1.1</span>,
                       <span class="st">"Fadul 1-2"</span> <span class="kw">=</span> <span class="no">fadul1.2</span>),
                  <span class="kw">type</span> <span class="kw">=</span> <span class="st">"faceted"</span>)</pre></div>
<p><img src="reference/figures/README-unnamed-chunk-3-1.png" width="100%"></p>
<div id="preprocessing" class="section level3">
<h3 class="hasAnchor">
<a href="#preprocessing" class="anchor"></a>Preprocessing</h3>
<p>To perform a proper comparison of these two cartridge cases, we need to remove regions that do not come into uniform or consistent contact with the breech face of the firearm. These include the small clusters of pixels in the corners of the two scans, caused by the staging area in which the scans are taken, and the plateaued region of points around the firing pin impression hole near the center of the scan. A variety of processing procedures are implemented in the cmcR package. Consider the <a href="https://csafe-isu.github.io/cmcR/reference/index.html">funtion reference</a> of the cmcR package for more information regarding these procedures. As is commonly done when comparing cartridge cases, we first downsample each scan (by a factor of 4, selecting every other row/column) using the <code>sample_x3p</code> function.</p>
<div class="sourceCode" id="cb4"><pre class="r"><span class="no">fadul1.1_processed</span> <span class="kw">&lt;-</span> <span class="kw pkg">x3ptools</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/x3ptools/man/x3p_sample.html">sample_x3p</a></span>(<span class="no">fadul1.1</span>)

<span class="no">fadul1.1_processed</span>$<span class="no">surface.matrix</span><span class="kw">&lt;-</span> <span class="no">fadul1.1_processed</span>$<span class="no">surface.matrix</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">cmcR</span><span class="kw ns">::</span><span class="fu"><a href="reference/preProcess_ransac.html">preProcess_ransac</a></span>() <span class="kw">%&gt;%</span>
  <span class="kw pkg">cmcR</span><span class="kw ns">::</span><span class="fu"><a href="reference/preProcess_levelBF.html">preProcess_levelBF</a></span>() <span class="kw">%&gt;%</span>
  <span class="kw pkg">cmcR</span><span class="kw ns">::</span><span class="fu"><a href="reference/preProcess_cropWS.html">preProcess_cropWS</a></span>() <span class="kw">%&gt;%</span>
  <span class="kw pkg">cmcR</span><span class="kw ns">::</span><span class="fu"><a href="reference/preProcess_removeFPCircle.html">preProcess_removeFPCircle</a></span>() <span class="kw">%&gt;%</span>
  <span class="kw pkg">cmcR</span><span class="kw ns">::</span><span class="fu"><a href="reference/preProcess_gaussFilter.html">preProcess_gaussFilter</a></span>(<span class="kw">res</span> <span class="kw">=</span> <span class="no">fadul1.1_processed</span>$<span class="no">header.info</span>$<span class="no">incrementY</span>)

<span class="no">fadul1.2_processed</span> <span class="kw">&lt;-</span> <span class="kw pkg">x3ptools</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/x3ptools/man/x3p_sample.html">sample_x3p</a></span>(<span class="no">fadul1.2</span>)

<span class="no">fadul1.2_processed</span>$<span class="no">surface.matrix</span><span class="kw">&lt;-</span> <span class="no">fadul1.2_processed</span>$<span class="no">surface.matrix</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">cmcR</span><span class="kw ns">::</span><span class="fu"><a href="reference/preProcess_ransac.html">preProcess_ransac</a></span>() <span class="kw">%&gt;%</span>
  <span class="kw pkg">cmcR</span><span class="kw ns">::</span><span class="fu"><a href="reference/preProcess_levelBF.html">preProcess_levelBF</a></span>() <span class="kw">%&gt;%</span>
  <span class="kw pkg">cmcR</span><span class="kw ns">::</span><span class="fu"><a href="reference/preProcess_cropWS.html">preProcess_cropWS</a></span>() <span class="kw">%&gt;%</span>
  <span class="kw pkg">cmcR</span><span class="kw ns">::</span><span class="fu"><a href="reference/preProcess_removeFPCircle.html">preProcess_removeFPCircle</a></span>() <span class="kw">%&gt;%</span>
  <span class="kw pkg">cmcR</span><span class="kw ns">::</span><span class="fu"><a href="reference/preProcess_gaussFilter.html">preProcess_gaussFilter</a></span>(<span class="kw">res</span> <span class="kw">=</span> <span class="no">fadul1.2_processed</span>$<span class="no">header.info</span>$<span class="no">incrementY</span>)

<span class="co">#manually update scan metadata processing</span>
<span class="no">fadul1.1_processed</span>$<span class="no">header.info</span>$<span class="no">sizeY</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span>(<span class="no">fadul1.1_processed</span>$<span class="no">surface.matrix</span>)
<span class="no">fadul1.1_processed</span>$<span class="no">header.info</span>$<span class="no">sizeX</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">fadul1.1_processed</span>$<span class="no">surface.matrix</span>)

<span class="no">fadul1.2_processed</span>$<span class="no">header.info</span>$<span class="no">sizeY</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span>(<span class="no">fadul1.2_processed</span>$<span class="no">surface.matrix</span>)
<span class="no">fadul1.2_processed</span>$<span class="no">header.info</span>$<span class="no">sizeX</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">fadul1.2_processed</span>$<span class="no">surface.matrix</span>)

<span class="kw pkg">cmcR</span><span class="kw ns">::</span><span class="fu"><a href="reference/x3pListPlot.html">x3pListPlot</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">"Processed Fadul 1-1"</span> <span class="kw">=</span> <span class="no">fadul1.1_processed</span>,
                       <span class="st">"Processed Fadul1-2"</span> <span class="kw">=</span> <span class="no">fadul1.2_processed</span>),
                  <span class="kw">type</span> <span class="kw">=</span> <span class="st">"faceted"</span>)</pre></div>
<p><img src="reference/figures/README-unnamed-chunk-4-1.png" width="100%"></p>
</div>
<div id="cell-based-comparison-procedure" class="section level3">
<h3 class="hasAnchor">
<a href="#cell-based-comparison-procedure" class="anchor"></a>Cell-based comparison procedure</h3>
<p>The scans are now ready to be compared using the cell-based comparison procedure. This is performed using the <a href="https://csafe-isu.github.io/cmcR/reference/cellCCF_bothDirections.html"><code>cellCCF_bothDirections</code></a> function.</p>
<div class="sourceCode" id="cb5"><pre class="r"><span class="no">kmComparison</span> <span class="kw">&lt;-</span> <span class="kw pkg">cmcR</span><span class="kw ns">::</span><span class="fu"><a href="reference/cellCCF_bothDirections.html">cellCCF_bothDirections</a></span>(<span class="kw">x3p1</span> <span class="kw">=</span> <span class="no">fadul1.1_processed</span>,
                                             <span class="kw">x3p2</span> <span class="kw">=</span> <span class="no">fadul1.2_processed</span>,
                                             <span class="kw">thetas</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(-<span class="fl">30</span>, <span class="fl">30</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="fl">3</span>))</pre></div>
<p>We may be interested in phase (<span class="math inline"><em>x</em></span>,<span class="math inline"><em>y</em></span>, and <span class="math inline"><em>θ</em></span>) at which each cell/region pair attained the maximum cross-correlation (for example, this information is used to define matches vs. non-matches under the original method of Song (2013)). The <code>topResultsPerCell</code> function calculates this information from a list of CCF results (as returned by the <code>cellCCF_bothDirections</code> function) and returns it as a data frame. As the name implies, <code>cellCCF_bothDirections</code> performs the cell-based comparison procedures in both directions (i.e., Fadul 1-1 is partitioned into a grid of cells and compared to regions in Fadul 1-2 and vice versa), hence the <code><a href="https://rdrr.io/r/base/Extract.html">$</a></code> extraction of the <code>kmComparison</code> list object below. A sample of the output is given below.</p>
<div class="sourceCode" id="cb6"><pre class="r"><span class="no">kmComparison</span>$<span class="no">comparison_1to2</span>$<span class="no">ccfResults</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">cmcR</span><span class="kw ns">::</span><span class="fu"><a href="reference/topResultsPerCell.html">topResultsPerCell</a></span>() <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>()
<span class="co">#&gt; # A tibble: 6 x 8</span>
<span class="co">#&gt; # Groups:   cellID [6]</span>
<span class="co">#&gt;   cellNum cellID              fft.ccf    dx    dy theta nonMissingProport~   ccf</span>
<span class="co">#&gt;     &lt;int&gt; &lt;chr&gt;                 &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;              &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1       3 y = 1 - 73, x = 14~   0.469     4    -2   -30              0.512 0.640</span>
<span class="co">#&gt; 2       4 y = 1 - 73, x = 21~   0.253   -28     6   -27              0.496 0.537</span>
<span class="co">#&gt; 3       5 y = 1 - 73, x = 29~   0.274    -7   -24    -3              0.525 0.503</span>
<span class="co">#&gt; 4       6 y = 1 - 73, x = 36~   0.252    12     6    27              0.604 0.563</span>
<span class="co">#&gt; 5       7 y = 1 - 73, x = 43~   0.258   -30   -22    21              0.125 0.783</span>
<span class="co">#&gt; 6       2 y = 1 - 73, x = 74~   0.322    19   -19     9              0.149 0.855</span></pre></div>
</div>
<div id="decision-rule" class="section level3">
<h3 class="hasAnchor">
<a href="#decision-rule" class="anchor"></a>Decision rule</h3>
<p>The final step in the CMC methodology is to apply a decision rule to the features extracted from the cell-based comparison procedure to declare a cell/region pair “congruent” or not. The number of “congruent” cell/region pairs is used as a similarity score between the two cartridge cases considered; the higher the number of congruent cell/region pairs, the more evidence there is that the cartridge case pair is a match. The various proposed CMC methods (two of which are implemented in the cmcR package) differ principally on the decision rule used to classify “congruent” cells. The <a href="https://csafe-isu.github.io/cmcR/reference/cmcFilter_improved.html"><code>cmcFilter_improved</code></a> function applies the decision rules from the original method of Song</p>
<p>(2013) and the High CMC method of Tong et al. (2015) to the output of the <code>cellCCF_bothDirections</code> function. Phase an correlation thresholds need to be set by the user.</p>
<div class="sourceCode" id="cb7"><pre class="r"><span class="no">kmCMC</span> <span class="kw">&lt;-</span> <span class="kw pkg">cmcR</span><span class="kw ns">::</span><span class="fu"><a href="reference/cmcFilter_improved.html">cmcFilter_improved</a></span>(<span class="kw">cellCCF_bothDirections_output</span> <span class="kw">=</span> <span class="no">kmComparison</span>,
                                  <span class="kw">ccf_thresh</span> <span class="kw">=</span> <span class="fl">.5</span>,
                                  <span class="kw">dx_thresh</span> <span class="kw">=</span> <span class="fl">20</span>,
                                  <span class="kw">theta_thresh</span> <span class="kw">=</span> <span class="fl">6</span>)</pre></div>
<p>The decision rule of the original method of Song (2013) only considers one of the two possible comparison directions. As such, we obtain a congruent matching cell count for both directions. The <code>comparison_1to2</code> direction refers to the case where Fadul 1-1 is partitioned into a grid of cells and compared to regions in Fadul 1-2.</p>
<div class="sourceCode" id="cb8"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">kmCMC</span>$<span class="no">originalMethodCMCs</span>$<span class="no">comparison_1to2</span>)
<span class="co">#&gt; [1] 17</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">kmCMC</span>$<span class="no">originalMethodCMCs</span>$<span class="no">comparison_1to2</span>)
<span class="co">#&gt; # A tibble: 6 x 8</span>
<span class="co">#&gt;   cellNum cellID              fft.ccf    dx    dy theta nonMissingProport~   ccf</span>
<span class="co">#&gt;     &lt;int&gt; &lt;chr&gt;                 &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;              &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1      17 y = 146 - 218, x =~   0.386     1   -10   -18              0.618 0.896</span>
<span class="co">#&gt; 2      25 y = 219 - 290, x =~   0.320    -7    12   -24              0.893 0.701</span>
<span class="co">#&gt; 3      32 y = 219 - 290, x =~   0.216    -7     3   -24              0.880 0.633</span>
<span class="co">#&gt; 4      33 y = 291 - 362, x =~   0.335    -6     0   -21              0.916 0.722</span>
<span class="co">#&gt; 5      34 y = 291 - 362, x =~   0.314   -10    -1   -21              0.377 0.661</span>
<span class="co">#&gt; 6      46 y = 363 - 435, x =~   0.308   -14    17   -21              0.481 0.860</span></pre></div>
<p>Conversely, the <code>comparison_2to1</code> direction refers to Fadul 1-2 is partitioned into a grid of cells and compared to regions in Fadul 1-1. The CMC counts we obtain are similar for both directions.</p>
<div class="sourceCode" id="cb9"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">kmCMC</span>$<span class="no">originalMethodCMCs</span>$<span class="no">comparison_2to1</span>)
<span class="co">#&gt; [1] 8</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">kmCMC</span>$<span class="no">originalMethodCMCs</span>$<span class="no">comparison_2to1</span>)
<span class="co">#&gt; # A tibble: 6 x 8</span>
<span class="co">#&gt;   cellNum cellID              fft.ccf    dx    dy theta nonMissingProport~   ccf</span>
<span class="co">#&gt;     &lt;int&gt; &lt;chr&gt;                 &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;              &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1       6 y = 1 - 73, x = 36~   0.244   -17   -14    12              0.631 0.533</span>
<span class="co">#&gt; 2      17 y = 147 - 219, x =~   0.492    -2     5    21              0.588 0.829</span>
<span class="co">#&gt; 3      43 y = 366 - 438, x =~   0.319    16     2    18              0.200 0.777</span>
<span class="co">#&gt; 4      55 y = 439 - 511, x =~   0.353   -12    20     9              0.894 0.602</span>
<span class="co">#&gt; 5      50 y = 439 - 511, x =~   0.355     6     0    21              0.912 0.685</span>
<span class="co">#&gt; 6      14 y = 74 - 146, x = ~   0.447   -12    -8     9              0.345 0.839</span></pre></div>
<p>The High CMC method of Tong et al. (2015) applies more stringent criteria to classify congruent vs. non-congruent matching cells. However, it also tends to assign a higher CMC count than original method of Song (2013). Such is the case in the example considered.</p>
<div class="sourceCode" id="cb10"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">kmCMC</span>$<span class="no">highCMCs</span>)
<span class="co">#&gt; [1] 40</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">kmCMC</span>$<span class="no">highCMCs</span>)
<span class="co">#&gt; # A tibble: 6 x 9</span>
<span class="co">#&gt;   cellNum cellID    fft.ccf    dx    dy nonMissingPropor~   ccf theta comparison</span>
<span class="co">#&gt;     &lt;int&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;             &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;     </span>
<span class="co">#&gt; 1      18 y = 146 ~   0.483   -15    22             0.194 0.815   -27 compariso~</span>
<span class="co">#&gt; 2      47 y = 363 ~   0.297   -19    22             0.978 0.515   -27 compariso~</span>
<span class="co">#&gt; 3      52 y = 436 ~   0.259     5     8             0.947 0.642   -27 compariso~</span>
<span class="co">#&gt; 4      60 y = 508 ~   0.270    10    -1             0.920 0.600   -27 compariso~</span>
<span class="co">#&gt; 5      62 y = 508 ~   0.484    10    -7             0.658 0.692   -27 compariso~</span>
<span class="co">#&gt; 6       4 y = 1 - ~   0.304   -15     7             0.496 0.523   -24 compariso~</span></pre></div>
<p>We can visualize the congruent matching cells for the comparison considered using the <a href="https://csafe-isu.github.io/cmcR/reference/cmcPlot.html">cmcPlot</a> function. Tong et al. (2015) recommend using the minimum of the two CMC counts determined under the original method of Song (2013) as the “initial” CMC count before applying the High CMC method criteria. This is what is visualized below.</p>
<div class="sourceCode" id="cb11"><pre class="r"><span class="no">cmcPlots</span> <span class="kw">&lt;-</span> <span class="kw pkg">cmcR</span><span class="kw ns">::</span><span class="fu"><a href="reference/cmcPlot.html">cmcPlot</a></span>(<span class="kw">x3p1</span> <span class="kw">=</span> <span class="no">fadul1.1_processed</span>,
                          <span class="kw">x3p2</span> <span class="kw">=</span> <span class="no">fadul1.2_processed</span>,
                          <span class="kw">cellCCF_bothDirections_output</span> <span class="kw">=</span> <span class="no">kmComparison</span>,
                          <span class="kw">cmcFilter_improved_output</span> <span class="kw">=</span> <span class="no">kmCMC</span>,
                          <span class="co">#arguments dictating output colors:</span>
                          <span class="kw">height.colors</span> <span class="kw">=</span> <span class="kw pkg">colorspace</span><span class="kw ns">::</span><span class="fu"><a href="http://colorspace.R-Forge.R-project.org//reference/desaturate.html">desaturate</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'#7f3b08'</span>,<span class="st">'#b35806'</span>,
                                                                   <span class="st">'#e08214'</span>,<span class="st">'#fdb863'</span>,
                                                                   <span class="st">'#fee0b6'</span>,<span class="st">'#f7f7f7'</span>,
                                                                   <span class="st">'#d8daeb'</span>,<span class="st">'#b2abd2'</span>,
                                                                   <span class="st">'#8073ac'</span>,<span class="st">'#542788'</span>,
                                                                   <span class="st">'#2d004b'</span>),
                                                                 <span class="kw">amount</span> <span class="kw">=</span> <span class="fl">.75</span>),
                          <span class="kw">cell.colors</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"#a60b00"</span>,<span class="st">"#1b03a3"</span>),
                          <span class="kw">cell.alpha</span> <span class="kw">=</span> <span class="fl">.15</span>,
                          <span class="kw">na.value</span> <span class="kw">=</span> <span class="st">"gray80"</span>)

<span class="no">cmcPlots</span>$<span class="no">originalMethodCMCs</span></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-11-1.png" width="100%"></p>
<div class="sourceCode" id="cb12"><pre class="r"><span class="no">cmcPlots</span>$<span class="no">highCMCs</span></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-12-1.png" width="100%"></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Joe Zemmels <br><small class="roles"> Author, maintainer </small>  </li>
<li>Heike Hofmann <br><small class="roles"> Author </small>  </li>
<li>Susan VanderPlas <br><small class="roles"> Author </small>  </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://travis-ci.com/jzemmels/cmcR"><img src="https://travis-ci.com/jzemmels/cmcR.svg?branch=master" alt="Travis build status"></a></li>
<li><a href="https://codecov.io/gh/jzemmels/cmcR?branch=master"><img src="https://codecov.io/gh/jzemmels/cmcR/branch/master/graph/badge.svg" alt="Codecov test coverage"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Joe Zemmels, Heike Hofmann, Susan VanderPlas.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
