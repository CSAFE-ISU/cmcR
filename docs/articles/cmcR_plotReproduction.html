<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reproduction of published plots using the cmcR package • cmcR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Reproduction of published plots using the cmcR package">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cmcR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/cmcR_plotReproduction.html">Reproduction of published plots using the cmcR package</a>
    </li>
    <li>
      <a href="../articles/reproducibleExample.html">Reproducible Example</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Reproduction of published plots using the cmcR package</h1>
            
      
      
      <div class="hidden name"><code>cmcR_plotReproduction.Rmd</code></div>

    </div>

    
    
<p>This vignette will give <code>R</code> code to reproduce (at least qualitatively if not precisely) plots commonly given in CMC literature using the <code>cmcR</code> package.</p>
<p>## Set-up</p>
<p>For the sake of the vignette, we will only consider comparisons between two known match pairs. So there will be two known match comparisons and four known non-match comparisons.</p>
<p>The four cartridge cases are from Fadul et al. (2011). The data are openly available from the <a href="https://tsapps.nist.gov/NRBTD/">NIST Ballistics Toolmark Research Database</a>. Specifically, we will consider the known match pairings between “Fadul 1-1” and “Fadul 1-2” (available <a href="https://tsapps.nist.gov/NRBTD/Studies/Firearm/Details/681f3cdf-8b1c-418a-af71-f52fd235e3da">here</a>) and between “Fadul 2-1” and “Fadul 2-2” (available <a href="https://tsapps.nist.gov/NRBTD/Studies/Firearm/Details/12e0f761-2528-4e7b-8600-360bbb788537">here</a>).</p>
<p>The pseudocode below shows how you can read an x3p file into <code>R</code> and perform the necessary pre-processing procedures on the surface matrix therein before applying the CMC method. Note that the package defaults (as of 4/13/20) are to perform the following:</p>
<ol style="list-style-type: decimal">
<li><p>Downsample the surface matrix by a factor of 4 (i.e., sample every other row/column from the surface matrix)</p></li>
<li><p>Identify the breech face impression height value in the surface matrix using the RANSAC (Random Sample Consensus method).</p></li>
<li><p>Take the residuals between the RANSAC-fitted plane and the observed values in the surface matrix within a small <code>finalSelectionThresh</code> threshold.</p></li>
<li><p>Remove rows/columns on the exterior of the resulting breech face impression surface matrix.</p></li>
<li><p>Detect and remove any observations within the firing pin impression circle on the interior of the breech face impression surface matrix.</p></li>
<li><p>Apply a Gaussian bandpass filter to the resulting surface matrix with wavelength cutoffs 16 and 250 microns <span class="math inline">\((\mu m)\)</span>.</p></li>
</ol>
<p>This is all done within the <code>selectBFImpression_sample_x3p</code> function. See <a href="https://jzemmels.github.io/cmcR/reference/selectBFImpression_sample_x3p.html">the documentation</a> for this function for more information. Note that the RANSAC method relies on randomly sampling points from the surface matrix. Thus results have been seen to vary, albeit slightly, between applications. Thus, a seed is set for reproducibility purposes.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(cmcR)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(tidyverse)</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(imager)</a>
<a class="sourceLine" id="cb1-4" title="4"><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">4132020</span>)</a>
<a class="sourceLine" id="cb1-5" title="5">  </a>
<a class="sourceLine" id="cb1-6" title="6">fadul1<span class="fl">.1</span> &lt;-<span class="st"> </span>cmcR<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cmcR/man/selectBFImpression_sample_x3p.html">selectBFImpression_sample_x3p</a></span>(<span class="st">"path/to/Fadul 1-1.x3p"</span>)</a>
<a class="sourceLine" id="cb1-7" title="7">fadul1<span class="fl">.2</span> &lt;-<span class="st"> </span>cmcR<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cmcR/man/selectBFImpression_sample_x3p.html">selectBFImpression_sample_x3p</a></span>(<span class="st">"path/to/Fadul 1-2.x3p"</span>)</a>
<a class="sourceLine" id="cb1-8" title="8">fadul2<span class="fl">.1</span> &lt;-<span class="st"> </span>cmcR<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cmcR/man/selectBFImpression_sample_x3p.html">selectBFImpression_sample_x3p</a></span>(<span class="st">"path/to/Fadul 2-1.x3p"</span>)</a>
<a class="sourceLine" id="cb1-9" title="9">fadul2<span class="fl">.2</span> &lt;-<span class="st"> </span>cmcR<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cmcR/man/selectBFImpression_sample_x3p.html">selectBFImpression_sample_x3p</a></span>(<span class="st">"path/to/Fadul 2-2.x3p"</span>)</a></code></pre></div>
<p>The cartridge cases after pre-processing can be visualized quickly by first converting the surface matrices into the <code>imager</code> package’s datatype <code>cimg</code>. The base <code>plot</code> function interacts fairly well with <code>cimg</code> objects.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="dt">mar =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb2-2" title="2"></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="kw">imlist</span>(<span class="st">"Fadul 1-1"</span> =<span class="st"> </span><span class="kw">as.cimg</span>(fadul1<span class="fl">.1</span><span class="op">$</span>x3p<span class="op">$</span>surface.matrix),</a>
<a class="sourceLine" id="cb2-4" title="4">       <span class="st">"Fadul 1-2"</span> =<span class="st"> </span><span class="kw">as.cimg</span>(fadul1<span class="fl">.2</span><span class="op">$</span>x3p<span class="op">$</span>surface.matrix),</a>
<a class="sourceLine" id="cb2-5" title="5">       <span class="st">"Fadul 2-1"</span> =<span class="st"> </span><span class="kw">as.cimg</span>(fadul2<span class="fl">.1</span><span class="op">$</span>x3p<span class="op">$</span>surface.matrix),</a>
<a class="sourceLine" id="cb2-6" title="6">       <span class="st">"Fadul 2-2"</span> =<span class="st"> </span><span class="kw">as.cimg</span>(fadul2<span class="fl">.2</span><span class="op">$</span>x3p<span class="op">$</span>surface.matrix)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>()</a></code></pre></div>
<p><img src="cmcR_plotReproduction_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>Now the cartridge cases are ready to be compared. This is done below using the <code>cellCCF_bothDirections</code> function for each KM and KNM pairing (so 6 in total). Note that we are considering the rangle of rotation values from -30 to 30 degrees and using a grid of 8 by 8 cells. The code here is written in a way to be at least somewhat generalizable (e.g., using the <code><a href="https://purrr.tidyverse.org/reference/map.html">purrr::map</a></code> family) if the reader is interested in applying the method to a larger set of cartridge cases.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">kmPairs &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">"1.1_1.2"</span> =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(fadul1<span class="fl">.1</span><span class="op">$</span>x3p,fadul1<span class="fl">.2</span><span class="op">$</span>x3p),</a>
<a class="sourceLine" id="cb3-2" title="2">                <span class="st">"2.1_2.2"</span> =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(fadul2<span class="fl">.1</span><span class="op">$</span>x3p,fadul2<span class="fl">.2</span><span class="op">$</span>x3p))</a>
<a class="sourceLine" id="cb3-3" title="3"></a>
<a class="sourceLine" id="cb3-4" title="4">knmPairs &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">"1.1_2.1"</span> =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(fadul1<span class="fl">.1</span><span class="op">$</span>x3p,fadul2<span class="fl">.1</span><span class="op">$</span>x3p),</a>
<a class="sourceLine" id="cb3-5" title="5">                 <span class="st">"1.1_2.2"</span> =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(fadul1<span class="fl">.1</span><span class="op">$</span>x3p,fadul2<span class="fl">.2</span><span class="op">$</span>x3p),</a>
<a class="sourceLine" id="cb3-6" title="6">                 <span class="st">"1.2_2.1"</span> =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(fadul1<span class="fl">.2</span><span class="op">$</span>x3p,fadul2<span class="fl">.1</span><span class="op">$</span>x3p),</a>
<a class="sourceLine" id="cb3-7" title="7">                 <span class="st">"1.2_2.2"</span> =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(fadul1<span class="fl">.2</span><span class="op">$</span>x3p,fadul2<span class="fl">.2</span><span class="op">$</span>x3p))</a>
<a class="sourceLine" id="cb3-8" title="8"></a>
<a class="sourceLine" id="cb3-9" title="9">kmComparisons &lt;-<span class="st"> </span>kmPairs <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-10" title="10"><span class="st">  </span><span class="kw">map</span>(<span class="op">~</span><span class="st"> </span>cmcR<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cmcR/man/cellCCF_bothDirections.html">cellCCF_bothDirections</a></span>(.[[<span class="dv">1</span>]],.[[<span class="dv">2</span>]],</a>
<a class="sourceLine" id="cb3-11" title="11">                                     <span class="dt">thetas =</span> <span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="op">-</span><span class="dv">30</span>,<span class="dv">30</span>,<span class="dt">by =</span> <span class="dv">3</span>),</a>
<a class="sourceLine" id="cb3-12" title="12">                                     <span class="dt">cellNumHoriz =</span> <span class="dv">8</span>))</a>
<a class="sourceLine" id="cb3-13" title="13"></a>
<a class="sourceLine" id="cb3-14" title="14">knmComparisons &lt;-<span class="st"> </span>knmPairs <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-15" title="15"><span class="st">  </span><span class="kw">map</span>(<span class="op">~</span><span class="st"> </span>cmcR<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cmcR/man/cellCCF_bothDirections.html">cellCCF_bothDirections</a></span>(.[[<span class="dv">1</span>]],.[[<span class="dv">2</span>]],</a>
<a class="sourceLine" id="cb3-16" title="16">                                     <span class="dt">thetas =</span> <span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="op">-</span><span class="dv">30</span>,<span class="dv">30</span>,<span class="dt">by =</span> <span class="dv">3</span>),</a>
<a class="sourceLine" id="cb3-17" title="17">                                     <span class="dt">cellNumHoriz =</span> <span class="dv">8</span>))</a></code></pre></div>
<p>With the comparisons completed, we can now show how to reproduce a variety of plots commonly given in the CMC literature.</p>
<div id="cmc-theta-distribution" class="section level3">
<h3 class="hasAnchor">
<a href="#cmc-theta-distribution" class="anchor"></a>CMC-<span class="math inline">\(\theta\)</span> distribution</h3>
<p>Tong et al. (2015) discusses an improvement to the CMC method originally proposed by Song (2013). Figures 2 and 3 of Tong et al. (2015) show how the CMC count varies across a variety of rotation values for a known match pair and a known non-match pair of cartridges cases, respectively. For a truly matching pair of cartridge cases, this “CMC-<span class="math inline">\(\theta\)</span> distribution” tends to attain a mode around the rotation value that correctly aligns one to the other. This tendency can be used to determine, for example, if comparing one cartridge case scan to another in one “direction” yields a CMC-<span class="math inline">\(\theta\)</span> mode that agrees the comparison in the other direction up to a sign.</p>
<p>The plot below illustrates this by showing the CMC-<span class="math inline">\(\theta\)</span> for the known match Fadul 1-1 and Fadul 1-2 pair. The <code>cmcPerThetaBarPlot</code> function is used to construct the plot. Comparing Fadul 1-1 to Fadul 1-2 (i.e., Fadul 1-1 is partitioned into a grid of cells and compared to larger regions in Fadul 1-2) clearly yields a CMC-<span class="math inline">\(\theta\)</span> mode around -24 degrees (i.e., Fadul 1-2 should be rotated -24 degrees to align with Fadul 1-1). In the other direction, we see that comparing Fadul 1-2 to Fadul 1-1 yields a CMC-<span class="math inline">\(\theta\)</span> mode around 21, which indicates that both directions agree (at least within a tolerance of, say, 3 degrees).</p>
<p>The way that Tong et al. propose to identify modes in the CMC-<span class="math inline">\(\theta\)</span> distribution is to introduce a “high CMC” threshold equal to the max CMC count minus some constant. That is, <span class="math inline">\(CMC_{\text{high}} = CMC_{\max} - \tau\)</span> for some <span class="math inline">\(\tau\)</span>. Using this high CMC threshold, we can determine how spread out the high CMC <span class="math inline">\(\theta\)</span> values are; the motivation here being that excessively diffuse high CMC <span class="math inline">\(\theta\)</span> values indicate that little “consensus” is reached as to the correct <span class="math inline">\(\theta\)</span> rotation value and the cartridge case pair under consideration is likely not a match.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">cmcR<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cmcR/man/cmcPerThetaBarPlot.html">cmcPerThetaBarPlot</a></span>(kmComparisons<span class="op">$</span><span class="st">`</span><span class="dt">1.1_1.2</span><span class="st">`</span>,</a>
<a class="sourceLine" id="cb4-2" title="2">                         <span class="dt">ccf_thresh =</span> <span class="fl">.6</span>,</a>
<a class="sourceLine" id="cb4-3" title="3">                         <span class="dt">dx_thresh =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb4-4" title="4">                         <span class="dt">highCMCThresh =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="cmcR_plotReproduction_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>In contrast, we can see the CMC-<span class="math inline">\(\theta\)</span> distribution for the known non-match pair of Fadul 1-1 and Fadul 2-1. Following the high CMC criterion discussed above, we can see that the range of <span class="math inline">\(\theta\)</span> values that we would classify as having a high CMC count is rather spread out (-18 to 3 degrees in one direction vs. -12 to 21 degrees in the other). Thus, we would conclude that this cartridge case pair is likely not a match.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">cmcR<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cmcR/man/cmcPerThetaBarPlot.html">cmcPerThetaBarPlot</a></span>(knmComparisons<span class="op">$</span><span class="st">`</span><span class="dt">1.1_2.1</span><span class="st">`</span>,</a>
<a class="sourceLine" id="cb5-2" title="2">                         <span class="dt">ccf_thresh =</span> <span class="fl">.6</span>,</a>
<a class="sourceLine" id="cb5-3" title="3">                         <span class="dt">dx_thresh =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb5-4" title="4">                         <span class="dt">highCMCThresh =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="cmcR_plotReproduction_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
</div>
<div id="ccf-map" class="section level3">
<h3 class="hasAnchor">
<a href="#ccf-map" class="anchor"></a>CCF Map</h3>
<p>We may be interested in learning more about a particular comparison that was done between a pair of cartridge case scans. For example, as discussed above it appears that Fadul 1-1 and Fadul 1-2 align well for a rotation of 24 degrees (-24 depending on the direction). We may be interested in what the cell/region pairs looked like just before the CCF was computed. The <code>getCellRegionPairs</code> function will take a data frame of CCF results, such as the one associated with the comparison after Fadul 1-2 is rotated -24 degrees, and return each cell/region pair represented in that data frame. For brevity, we’ll just consider as examples the Fadul 1-1 and Fadul 1-2 comparison as well as the Fadul 1-1 and Fadul 2-1 comparison.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">kmCellRegionPairs &lt;-<span class="st"> </span>cmcR<span class="op">::</span><span class="kw">getCellRegionPairs</span>(<span class="dt">x3p1 =</span> fadul1<span class="fl">.1</span><span class="op">$</span>x3p,</a>
<a class="sourceLine" id="cb6-2" title="2">                                              <span class="dt">x3p2 =</span> fadul1<span class="fl">.2</span><span class="op">$</span>x3p,</a>
<a class="sourceLine" id="cb6-3" title="3">                                              <span class="dt">ccfDF =</span> kmComparisons<span class="op">$</span><span class="st">`</span><span class="dt">1.1_1.2</span><span class="st">`</span><span class="op">$</span>comparison_1to2<span class="op">$</span>ccfResults<span class="op">$</span><span class="st">`</span><span class="dt">-24</span><span class="st">`</span>,</a>
<a class="sourceLine" id="cb6-4" title="4">                                              <span class="dt">params =</span> kmComparisons<span class="op">$</span><span class="st">`</span><span class="dt">1.1_1.2</span><span class="st">`</span><span class="op">$</span>comparison_1to2<span class="op">$</span>params)</a>
<a class="sourceLine" id="cb6-5" title="5"></a>
<a class="sourceLine" id="cb6-6" title="6">knmCellRegionPairs &lt;-<span class="st"> </span>cmcR<span class="op">::</span><span class="kw">getCellRegionPairs</span>(<span class="dt">x3p1 =</span> fadul1<span class="fl">.1</span><span class="op">$</span>x3p,</a>
<a class="sourceLine" id="cb6-7" title="7">                                               <span class="dt">x3p2 =</span> fadul2<span class="fl">.1</span><span class="op">$</span>x3p,</a>
<a class="sourceLine" id="cb6-8" title="8">                                               <span class="dt">ccfDF =</span> knmComparisons<span class="op">$</span><span class="st">`</span><span class="dt">1.1_2.1</span><span class="st">`</span><span class="op">$</span>comparison_1to2<span class="op">$</span>ccfResults<span class="op">$</span><span class="st">`</span><span class="dt">-9</span><span class="st">`</span>,</a>
<a class="sourceLine" id="cb6-9" title="9">                                               <span class="dt">params =</span> knmComparisons<span class="op">$</span><span class="st">`</span><span class="dt">1.1_2.1</span><span class="st">`</span><span class="op">$</span>comparison_1to2<span class="op">$</span>params)</a></code></pre></div>
<p>Figures 4 and 5 in Tong et al. (2015) show examples of “CCF maps,” as they are aptly called, for a known match cell/region pair and a known non-match cell/region pair, respectively. These “maps” are actually just the 3-dimensional cross-correlation function surface. They are referred as maps because they indicate what the CCF is for various translation values of one surface matrix compared to the other. The coordinates at which the CCF achieves a maximum can be used as estimates of the “true” translation values at which a particular cell aligns best to its associated region. The <code>ccfMapPlot</code> function plots the CCF where function values are mapped to color. Additionally, the function will plot the cell/region pair for which the CCF map was determined. An orange square will be plotted on the region that visually indicates where the CCF “believes” the correct translation of the cell to be relative to the region. The plot below shows a particular cell/region pair and its associated CCF map from the known match comparison of Fadul 1-1 vs. Fadul 1-2. Note that the CCF max value is actually rather small in this instance. This is an artifact of how the CCF method is calculated using a Fast Fourier Transform technique. Effectively, any <code>NA</code> values in the scan, of which there are many, must be replaced prior to calculation of the CCF using FFTs. This often causes the CCF to be “deflated” relative the “true” CCF values.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">kmCellRegionPairs<span class="op">$</span><span class="st">`</span><span class="dt">-24</span><span class="st">`</span>[<span class="dv">27</span>] <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="st">  </span><span class="kw">map</span>(<span class="op">~</span><span class="st"> </span>cmcR<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cmcR/man/ccfMapPlot.html">ccfMapPlot</a></span>(<span class="dt">mat1 =</span> .[[<span class="dv">1</span>]],</a>
<a class="sourceLine" id="cb7-3" title="3">                         <span class="dt">mat2 =</span> .[[<span class="dv">2</span>]],</a>
<a class="sourceLine" id="cb7-4" title="4">                         <span class="dt">theta =</span> <span class="dv">-24</span>))</a></code></pre></div>
<p><img src="cmcR_plotReproduction_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<pre><code>#&gt; $`x = 435 - 506,y = 146 - 217`
#&gt; NULL</code></pre>
<p>In contrast, the plot below shows a particular cell/region pair and its associated CCF map from the known non-match comparison of Fadul 1-1 vs. Fadul 2-1.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">knmCellRegionPairs<span class="op">$</span><span class="st">`</span><span class="dt">-9</span><span class="st">`</span>[<span class="dv">30</span>] <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-2" title="2"><span class="st">  </span><span class="kw">map</span>(<span class="op">~</span><span class="st"> </span>cmcR<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cmcR/man/ccfMapPlot.html">ccfMapPlot</a></span>(<span class="dt">mat1 =</span> .[[<span class="dv">1</span>]],</a>
<a class="sourceLine" id="cb9-3" title="3">                         <span class="dt">mat2 =</span> .[[<span class="dv">2</span>]],</a>
<a class="sourceLine" id="cb9-4" title="4">                         <span class="dt">theta =</span> <span class="dv">-9</span>))</a></code></pre></div>
<p><img src="cmcR_plotReproduction_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<pre><code>#&gt; $`x = 435 - 506,y = 363 - 434`
#&gt; NULL</code></pre>
</div>
<div id="ccf_max-distribution" class="section level3">
<h3 class="hasAnchor">
<a href="#ccf_max-distribution" class="anchor"></a><span class="math inline">\(CCF_\max\)</span> distribution</h3>
<p>Figure 4 of Tong et al. (2014) and Figure 5(a) of Chen et al. (2017)</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb11-2" title="2"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">data =</span> kmComparisons <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-3" title="3"><span class="st">                   </span><span class="kw">map2_dfr</span>(<span class="dt">.x =</span> .,</a>
<a class="sourceLine" id="cb11-4" title="4">                            <span class="dt">.y =</span> <span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(.),</a>
<a class="sourceLine" id="cb11-5" title="5">                            <span class="op">~</span><span class="st"> </span>cmcR<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cmcR/man/topResultsPerCell.html">topResultsPerCell</a></span>(.x<span class="op">$</span>comparison_1to2<span class="op">$</span>ccfResults) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-6" title="6"><span class="st">                              </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-7" title="7"><span class="st">                              </span><span class="kw">mutate</span>(<span class="dt">pair =</span> <span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(.y,<span class="dt">times =</span> <span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(.)))),</a>
<a class="sourceLine" id="cb11-8" title="8">                 <span class="kw">aes</span>(<span class="dt">x =</span> ccf,<span class="dt">y =</span> ..density..),</a>
<a class="sourceLine" id="cb11-9" title="9">                 <span class="dt">fill =</span> <span class="st">"orange"</span>,</a>
<a class="sourceLine" id="cb11-10" title="10">                 <span class="dt">alpha =</span> <span class="fl">.7</span>,</a>
<a class="sourceLine" id="cb11-11" title="11">                 <span class="dt">binwidth =</span> <span class="fl">.03</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-12" title="12"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">data =</span> knmComparisons <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-13" title="13"><span class="st">                   </span><span class="kw">map2_dfr</span>(<span class="dt">.x =</span> .,</a>
<a class="sourceLine" id="cb11-14" title="14">                            <span class="dt">.y =</span> <span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(.),</a>
<a class="sourceLine" id="cb11-15" title="15">                            <span class="op">~</span><span class="st"> </span>cmcR<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cmcR/man/topResultsPerCell.html">topResultsPerCell</a></span>(.x<span class="op">$</span>comparison_1to2<span class="op">$</span>ccfResults) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-16" title="16"><span class="st">                              </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-17" title="17"><span class="st">                              </span><span class="kw">mutate</span>(<span class="dt">pair =</span> <span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(.y,<span class="dt">times =</span> <span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(.)))),</a>
<a class="sourceLine" id="cb11-18" title="18">                 <span class="kw">aes</span>(<span class="dt">x =</span> ccf,<span class="dt">y =</span> ..density..),</a>
<a class="sourceLine" id="cb11-19" title="19">                 <span class="dt">fill =</span> <span class="st">"royalblue"</span>,</a>
<a class="sourceLine" id="cb11-20" title="20">                 <span class="dt">alpha =</span> <span class="fl">.7</span>,</a>
<a class="sourceLine" id="cb11-21" title="21">                 <span class="dt">binwidth =</span> <span class="fl">.03</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-22" title="22"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">data =</span> <span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="dt">x =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(.<span class="dv">5</span>,.<span class="dv">5</span>),</a>
<a class="sourceLine" id="cb11-23" title="23">                             <span class="dt">y =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,<span class="dv">0</span>),</a>
<a class="sourceLine" id="cb11-24" title="24">                             <span class="dt">comparisonType =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"known non-match"</span>,<span class="st">"known match"</span>)),</a>
<a class="sourceLine" id="cb11-25" title="25">           <span class="kw">aes</span>(<span class="dt">x =</span> x,<span class="dt">y =</span> y,<span class="dt">fill =</span> comparisonType),<span class="dt">stat =</span> <span class="st">"identity"</span>,</a>
<a class="sourceLine" id="cb11-26" title="26">           <span class="dt">alpha =</span> <span class="fl">.7</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-27" title="27"><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"orange"</span>,<span class="st">"royalblue"</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-28" title="28"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb11-29" title="29"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/graphics/plot.window.html">xlim</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb11-30" title="30"><span class="co">#&gt; Warning: Removed 2 rows containing missing values (geom_bar).</span></a>
<a class="sourceLine" id="cb11-31" title="31"></a>
<a class="sourceLine" id="cb11-32" title="32"><span class="co">#&gt; Warning: Removed 2 rows containing missing values (geom_bar).</span></a></code></pre></div>
<p><img src="cmcR_plotReproduction_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">bind_rows</span>(kmComparisons <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-2" title="2"><span class="st">            </span><span class="kw">map2_dfr</span>(<span class="dt">.x =</span> .,</a>
<a class="sourceLine" id="cb12-3" title="3">                     <span class="dt">.y =</span> <span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(.),</a>
<a class="sourceLine" id="cb12-4" title="4">                     <span class="op">~</span><span class="st"> </span>cmcR<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cmcR/man/topResultsPerCell.html">topResultsPerCell</a></span>(.x<span class="op">$</span>comparison_1to2<span class="op">$</span>ccfResults) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-5" title="5"><span class="st">                       </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-6" title="6"><span class="st">                       </span><span class="kw">mutate</span>(<span class="dt">pair =</span> <span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(.y,<span class="dt">times =</span> <span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(.)),</a>
<a class="sourceLine" id="cb12-7" title="7">                              <span class="dt">comparisonType =</span> <span class="st">"known match"</span>)),</a>
<a class="sourceLine" id="cb12-8" title="8">          knmComparisons <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-9" title="9"><span class="st">            </span><span class="kw">map2_dfr</span>(<span class="dt">.x =</span> .,</a>
<a class="sourceLine" id="cb12-10" title="10">                     <span class="dt">.y =</span> <span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(.),</a>
<a class="sourceLine" id="cb12-11" title="11">                     <span class="op">~</span><span class="st"> </span>cmcR<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cmcR/man/topResultsPerCell.html">topResultsPerCell</a></span>(.x<span class="op">$</span>comparison_1to2<span class="op">$</span>ccfResults) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-12" title="12"><span class="st">                       </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-13" title="13"><span class="st">                       </span><span class="kw">mutate</span>(<span class="dt">pair =</span> <span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(.y,<span class="dt">times =</span> <span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(.)),</a>
<a class="sourceLine" id="cb12-14" title="14">                              <span class="dt">comparisonType =</span> <span class="st">"known non-match"</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-15" title="15"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> ccf,<span class="dt">fill =</span> comparisonType)) <span class="op">+</span></a>
<a class="sourceLine" id="cb12-16" title="16"><span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">alpha =</span> <span class="fl">.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb12-17" title="17"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb12-18" title="18"><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"orange"</span>,<span class="st">"royalblue"</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb12-19" title="19"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/graphics/plot.window.html">xlim</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,<span class="dv">1</span>))</a></code></pre></div>
<p><img src="cmcR_plotReproduction_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
</div>
<div id="identified-cmcs" class="section level3">
<h3 class="hasAnchor">
<a href="#identified-cmcs" class="anchor"></a>Identified CMCs</h3>
<p>Figure 7 of Tong et al. (2015)</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1">kmCMCs &lt;-<span class="st"> </span>kmComparisons <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-2" title="2"><span class="st">  </span><span class="kw">map</span>(<span class="op">~</span><span class="st"> </span>cmcR<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cmcR/man/cmcFilter_improved.html">cmcFilter_improved</a></span>(<span class="dt">cellCCF_bothDirections_output =</span> .,</a>
<a class="sourceLine" id="cb13-3" title="3">                                 <span class="dt">consensus_function =</span> median,</a>
<a class="sourceLine" id="cb13-4" title="4">                                 <span class="dt">ccf_thresh =</span> <span class="fl">.6</span>,</a>
<a class="sourceLine" id="cb13-5" title="5">                                 <span class="dt">dx_thresh =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb13-6" title="6">                                 <span class="dt">theta_thresh =</span> <span class="dv">3</span>))</a>
<a class="sourceLine" id="cb13-7" title="7"></a>
<a class="sourceLine" id="cb13-8" title="8">knmCMCs &lt;-<span class="st"> </span>knmComparisons <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-9" title="9"><span class="st">  </span><span class="kw">map</span>(<span class="op">~</span><span class="st"> </span>cmcR<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cmcR/man/cmcFilter_improved.html">cmcFilter_improved</a></span>(<span class="dt">cellCCF_bothDirections_output =</span> .,</a>
<a class="sourceLine" id="cb13-10" title="10">                                 <span class="dt">consensus_function =</span> median,</a>
<a class="sourceLine" id="cb13-11" title="11">                                 <span class="dt">ccf_thresh =</span> <span class="fl">.6</span>,</a>
<a class="sourceLine" id="cb13-12" title="12">                                 <span class="dt">dx_thresh =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb13-13" title="13">                                 <span class="dt">theta_thresh =</span> <span class="dv">3</span>))</a>
<a class="sourceLine" id="cb13-14" title="14"></a>
<a class="sourceLine" id="cb13-15" title="15">cmcR<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cmcR/man/cmcPlot.html">cmcPlot</a></span>(<span class="dt">x3p =</span> fadul1<span class="fl">.1</span><span class="op">$</span>x3p,</a>
<a class="sourceLine" id="cb13-16" title="16">              <span class="dt">cmcDF =</span> kmCMCs<span class="op">$</span><span class="st">`</span><span class="dt">1.1_1.2</span><span class="st">`</span><span class="op">$</span>finalCMCs)</a></code></pre></div>
<p><img src="cmcR_plotReproduction_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1">cmcR<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cmcR/man/cmcPlot.html">cmcPlot</a></span>(<span class="dt">x3p =</span> fadul1<span class="fl">.1</span><span class="op">$</span>x3p,</a>
<a class="sourceLine" id="cb14-2" title="2">              <span class="dt">cmcDF =</span> knmCMCs<span class="op">$</span><span class="st">`</span><span class="dt">1.1_2.1</span><span class="st">`</span><span class="op">$</span>initialCMCs[[<span class="dv">1</span>]]<span class="op">$</span>comparison_1to2)</a></code></pre></div>
<p><img src="cmcR_plotReproduction_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
</div>
<div id="cmc-distribution" class="section level3">
<h3 class="hasAnchor">
<a href="#cmc-distribution" class="anchor"></a>CMC Distribution</h3>
<p>Figure 7 of Tong et al. (2014), Figure 9 of Tong et al. (2015), and Figure 6 of Chen et al. (2017)</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1"><span class="kw">bind_rows</span>(kmCMCs <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-2" title="2"><span class="st">            </span><span class="kw">map2_dfr</span>(<span class="dt">.x =</span> .,</a>
<a class="sourceLine" id="cb15-3" title="3">                     <span class="dt">.y =</span> <span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(.),</a>
<a class="sourceLine" id="cb15-4" title="4">                     <span class="op">~</span><span class="st"> </span>.<span class="op">$</span>finalCMCs <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-5" title="5"><span class="st">                       </span><span class="kw">mutate</span>(<span class="dt">pair =</span> <span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(.y,<span class="dt">times =</span> <span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(.)),</a>
<a class="sourceLine" id="cb15-6" title="6">                              <span class="dt">comparisonType =</span> <span class="st">"known match"</span>)),</a>
<a class="sourceLine" id="cb15-7" title="7">          knmCMCs <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-8" title="8"><span class="st">            </span><span class="kw">map2_dfr</span>(<span class="dt">.x =</span> .,</a>
<a class="sourceLine" id="cb15-9" title="9">                     <span class="dt">.y =</span> <span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(.),</a>
<a class="sourceLine" id="cb15-10" title="10">                     <span class="cf">function</span>(<span class="dt">cmcs =</span> .x,<span class="dt">name =</span> .y){</a>
<a class="sourceLine" id="cb15-11" title="11">                       <span class="cf">if</span>(<span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span>(cmcs<span class="op">$</span>finalCMCs)){</a>
<a class="sourceLine" id="cb15-12" title="12">                       <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>(cmcs<span class="op">$</span>finalCMCs <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-13" title="13"><span class="st">                       </span><span class="kw">mutate</span>(<span class="dt">pair =</span> <span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(name,<span class="dt">times =</span> <span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(.)),</a>
<a class="sourceLine" id="cb15-14" title="14">                              <span class="dt">comparisonType =</span> <span class="st">"known non-match"</span>))</a>
<a class="sourceLine" id="cb15-15" title="15">                       }</a>
<a class="sourceLine" id="cb15-16" title="16">                       <span class="cf">else</span>{</a>
<a class="sourceLine" id="cb15-17" title="17">                         cmcs<span class="op">$</span>initialCMCs[[<span class="dv">1</span>]][[<span class="kw"><a href="https://rdrr.io/r/base/which.min.html">which.min</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(cmcs<span class="op">$</span>initialCMCs[[<span class="dv">1</span>]]<span class="op">$</span>comparison_1to2),<span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(cmcs<span class="op">$</span>initialCMCs[[<span class="dv">1</span>]]<span class="op">$</span>comparison_2to1)))]] <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-18" title="18"><span class="st">                           </span><span class="kw">mutate</span>(<span class="dt">pair =</span> <span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(name,<span class="dt">times =</span> <span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(.)),</a>
<a class="sourceLine" id="cb15-19" title="19">                              <span class="dt">comparisonType =</span> <span class="st">"known non-match"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-20" title="20"><span class="st">                           </span><span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>()</a>
<a class="sourceLine" id="cb15-21" title="21">                       }</a>
<a class="sourceLine" id="cb15-22" title="22">                       })) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-23" title="23"><span class="st">  </span><span class="kw">group_by</span>(pair,comparisonType) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-24" title="24"><span class="st">  </span><span class="kw">tally</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-25" title="25"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> n,<span class="dt">fill =</span> comparisonType)) <span class="op">+</span></a>
<a class="sourceLine" id="cb15-26" title="26"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb15-27" title="27"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb15-28" title="28"><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"orange"</span>,<span class="st">"royalblue"</span>))</a></code></pre></div>
<p><img src="cmcR_plotReproduction_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<ul>
<li><p>Song, J. (2013). Proposed “NIST Ballistics Identification System (NBIS)” Based on 3D Topogra-phy Measurements on Correlation Cells.American Firearm and Tool Mark Examiners Journal,45(2):11.</p></li>
<li><p>Tong, M., Song, J., and Chu, W. (2015). An Improved Algorithm of Congruent Matching Cells(CMC) Method for Firearm Evidence Identifications.Journal of Research of the National Institute of Standards and Technology, 120:102.</p></li>
<li><p>Fadul T., Hernandez G., Stoiloff S. and Gulati Sneh “An Empirical Study to Improve the Scientific Foundation of Forensic Firearm and Tool Mark Identification Utilizing 10 Consecutively Manufactured Slides,” 2011 NCJRS 237960</p></li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Joe Zemmels, Heike Hofmann, Susan VanderPlas.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
