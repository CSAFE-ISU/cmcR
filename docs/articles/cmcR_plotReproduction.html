<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reproduction of Song et al. (2018) plots using the cmcR package • cmcR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Reproduction of Song et al. (2018) plots using the cmcR package">
<meta property="og:description" content="cmcR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cmcR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/cmcR_plotReproduction.html">Reproduction of Song et al. (2018) plots using the cmcR package</a>
    </li>
    <li>
      <a href="../articles/decisionRuleDescription.html">CMC Decision Rule Description</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="cmcR_plotReproduction_files/header-attrs-2.4/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Reproduction of Song et al. (2018) plots using the cmcR package</h1>
            
      
      
      <div class="hidden name"><code>cmcR_plotReproduction.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">cmcR</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">magrittr</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://purrr.tidyverse.org">purrr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/heike/x3ptools">x3ptools</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-forge.r-project.org/projects/rgl/">rgl</a></span><span class="op">)</span></pre></div>
<!-- TODO: -->
<!--   - Add hyperlinks to .png images of original plots -->
<!--   - Add red squares indicating non-CMCs based on topResultsPerCell output -->
<!--   - For RGL images - high contrast lighting. Use x3p_lighter(). Look into rgl for different lighting choices too. -->
<!--   - Try linear scale first -->
<!--   - create custom scale function where breaks happen at quintiles (median == white, max and min are dark orange and dark blue, respectively.) -->
<!--   - CCF map plot - show custom labels -- show 0, min, and max -->
<!--   This vignette will give `R` code to reproduce (at least qualitatively if not precisely) plots in Tong et al. (2018) using the `cmcR` package. -->
<div id="set-up" class="section level2">
<h2 class="hasAnchor">
<a href="#set-up" class="anchor"></a>Set-up</h2>
<p>For the sake of an example we will consider 3 cartridge cases are from Fadul et al. (2011). The data are openly available from the <a href="https://tsapps.nist.gov/NRBTD/">NIST Ballistics Toolmark Research Database</a>. Specifically, we will consider the comparisons between “Fadul 1-1” and “Fadul 1-2” (available <a href="https://tsapps.nist.gov/NRBTD/Studies/Firearm/Details/681f3cdf-8b1c-418a-af71-f52fd235e3da">here</a>) and “Fadul 2-1” (available <a href="https://tsapps.nist.gov/NRBTD/Studies/Firearm/Details/12e0f761-2528-4e7b-8600-360bbb788537">here</a>). Note that Fadul 1-1 and Fadul 1-2 are known to have been fired from the same firearm while Fadul 2-1 was fired from a different firearm.</p>
<p><!-- The pseudocode below shows how you can read an x3p file into `R` and perform the necessary pre-processing procedures on the surface matrix therein before applying the CMC method. Note that the package defaults (as of 4/13/20) are to perform the following: --></p>
<p><!-- 1. Downsample the surface matrix by a factor of 4 (i.e., sample every other row/column from the surface matrix) --></p>
<p><!-- 2. Identify the breech face impression height value in the surface matrix using the RANSAC (Random Sample Consensus method). --></p>
<p><!-- 3. Take the residuals between the RANSAC-fitted plane and the observed values in the surface matrix within a small `highSelectionThresh` threshold. --></p>
<p><!-- 4. Remove rows/columns on the exterior of the resulting breech face impression surface matrix. --></p>
<p><!-- 5. Detect and remove any observations within the firing pin impression circle on the interior of the breech face impression surface matrix. --></p>
<p><!-- 6. Apply a Gaussian bandpass filter to the resulting surface matrix with wavelength cutoffs 16 and 250 microns $(\mu m)$. --></p>
<p><!-- This is all done within the `selectBFImpression_sample_x3p` function. See [the documentation](https://jzemmels.github.io/cmcR/reference/selectBFImpression_sample_x3p.html) for this function for more information. Note that the RANSAC method relies on randomly sampling points from the surface matrix. Thus results have been seen to vary, albeit slightly, between applications. Thus, a seed is set for reproducibility purposes. --></p>
</div>
<div id="cartridge-case-scan-image-figure-1-1" class="section level2">
<h2 class="hasAnchor">
<a href="#cartridge-case-scan-image-figure-1-1" class="anchor"></a>Cartridge case scan image (Figure 1.1)</h2>
<p>The <code>rgl</code> package can be used to visualize the cartridge case scans in 3 dimensions. The code below shows how to construct an <code>rgl</code> “scene” including placing lights at desired locations and controlling color, surface reflectance, etc. Each <code>rgl</code> scene can support up to 8 lights, but two are setup in the scene below - one directly above the scan at <span class="math inline">\((0,0,10)\)</span> and another located “north-by-northwest” of the scan at <span class="math inline">\((-1,2,2)\)</span>. Note that these positions are relative to where the viewer begins - which is somewhere along the <span class="math inline">\(z\)</span>-axis depending on the value provided to the <code>zoom</code> attribute. Based on experimentation, it appears that applying a Gaussian filter to the surface matrix prior to setting up the scene makes the breech face impressions more visually distinct (otherwise, a good deal of noise due to the scanning process makes it difficult to see much structure). There’s truly an arbitrary amount of tinkering one could perform to get the “best” looking scene for a particular cartridge case scan, so in no way is the scene setup shown below generalizable to more cartridge case scans. Ince the <code>rgl</code> device is opened, the <code><a href="https://rdrr.io/pkg/x3ptools/man/x3p_snapshot.html">x3ptools::x3p_snapshot</a></code> function saves the device’s current viewpoint as a .png in a local directly called bfScanImages. The same procedure is carried out for the <code>fadul1.2_raw</code> object (not shown).</p>
<p>To learn more about how various aspects of a scene are constructed, see <a href="https://cran.r-project.org/web/packages/rgl/vignettes/rgl.html">this vignette</a> for the <code>rgl</code> package. For more details on using <code>rgl</code> specifically applied to .x3p files, see the documentation for the <a href="https://github.com/heike/x3ptools"><code>x3ptools</code> package on Github</a>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="va">fadul1.1_id</span> <span class="op">&lt;-</span> <span class="st">"DownloadMeasurement/2d9cc51f-6f66-40a0-973a-a9292dbee36d"</span>
<span class="co"># Same source comparison</span>
<span class="va">fadul1.2_id</span> <span class="op">&lt;-</span> <span class="st">"DownloadMeasurement/cb296c98-39f5-46eb-abff-320a2f5568e8"</span>

<span class="co"># Code to download breech face impressions:</span>
<span class="va">nbtrd_url</span> <span class="op">&lt;-</span> <span class="st">"https://tsapps.nist.gov/NRBTD/Studies/CartridgeMeasurement"</span>

<span class="va">fadul1.1_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/x3ptools/man/x3p_read.html">x3p_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">nbtrd_url</span>,<span class="va">fadul1.1_id</span><span class="op">)</span><span class="op">)</span>
<span class="va">fadul1.2_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/x3ptools/man/x3p_read.html">x3p_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">nbtrd_url</span>,<span class="va">fadul1.2_id</span><span class="op">)</span><span class="op">)</span></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="co">#apply lowpass filter to reduce noise in scan:</span>
<span class="va">surface1</span> <span class="op">&lt;-</span> <span class="va">fadul1.1_raw</span> <span class="op">%&gt;%</span>
  <span class="fu">cmcR</span><span class="fu">::</span><span class="fu"><a href="../reference/preProcess_gaussFilter.html">preProcess_gaussFilter</a></span><span class="op">(</span>wavelength <span class="op">=</span> <span class="fl">16</span>,filtertype <span class="op">=</span> <span class="st">"lp"</span><span class="op">)</span>
<span class="va">surface2</span> <span class="op">&lt;-</span> <span class="va">fadul1.2_raw</span> <span class="op">%&gt;%</span>
  <span class="fu">cmcR</span><span class="fu">::</span><span class="fu"><a href="../reference/preProcess_gaussFilter.html">preProcess_gaussFilter</a></span><span class="op">(</span>wavelength <span class="op">=</span> <span class="fl">16</span>,filtertype <span class="op">=</span> <span class="st">"lp"</span><span class="op">)</span>

<span class="va">params</span> <span class="op">&lt;-</span> <span class="fu">rgl</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/rgl/man/par3d.html">r3dDefaults</a></span>

<span class="va">zoom</span> <span class="op">=</span> <span class="fl">.7</span>
<span class="va">size</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">300</span>,<span class="fl">300</span><span class="op">)</span>

<span class="va">params</span><span class="op">$</span><span class="va">windowRect</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">40</span>, <span class="fl">125</span>, <span class="fl">40</span> <span class="op">+</span> <span class="va">size</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">125</span> <span class="op">+</span> <span class="va">size</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>
<span class="va">params</span><span class="op">$</span><span class="va">userMatrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">params</span><span class="op">$</span><span class="va">zoom</span> <span class="op">&lt;-</span> <span class="va">zoom</span>

<span class="co">#opens blank "canvas" upon which we can add lights, surfaces, etc.</span>
<span class="fu"><a href="https://rdrr.io/pkg/rgl/man/par3d.html">open3d</a></span><span class="op">(</span>params <span class="op">=</span> <span class="va">params</span><span class="op">)</span>
<span class="co">#&gt; wgl </span>
<span class="co">#&gt;   1</span>

<span class="co">#removes any previously declared lights in scene</span>
<span class="fu"><a href="https://rdrr.io/pkg/rgl/man/scene.html">rgl.pop</a></span><span class="op">(</span><span class="st">"lights"</span><span class="op">)</span>

<span class="co">#set-up two lights for scene -- a lot of experimentation possible here</span>
<span class="fu"><a href="https://rdrr.io/pkg/rgl/man/light.html">light3d</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>,y <span class="op">=</span> <span class="fl">1</span>,z <span class="op">=</span> <span class="fl">2</span>,viewpoint.rel <span class="op">=</span> <span class="cn">TRUE</span>,ambient <span class="op">=</span> <span class="st">"white"</span>,diffuse <span class="op">=</span> <span class="st">"white"</span>,specular <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/rgl/man/light.html">light3d</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>,y <span class="op">=</span> <span class="fl">0</span>,z <span class="op">=</span> <span class="fl">10</span>,ambient <span class="op">=</span> <span class="st">"grey60"</span>,diffuse <span class="op">=</span> <span class="st">"grey50"</span>,specular <span class="op">=</span> <span class="st">"grey60"</span>,viewpoint.rel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co">#setup surface visualization</span>
<span class="va">multiply</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="co">#x3ptools::image_x3p default to exaggerate relief</span>
<span class="va">z</span> <span class="op">&lt;-</span> <span class="va">multiply</span> <span class="op">*</span> <span class="va">surface1</span><span class="op">$</span><span class="va">surface.matrix</span> <span class="co"># Exaggerate the relief</span>
<span class="va">yidx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">:</span><span class="fl">1</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="va">fadul1.1_raw</span><span class="op">$</span><span class="va">header.info</span><span class="op">$</span><span class="va">incrementY</span> <span class="op">*</span> <span class="va">yidx</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="va">fadul1.1_raw</span><span class="op">$</span><span class="va">header.info</span><span class="op">$</span><span class="va">incrementX</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">)</span>

<span class="co"># emission, specular, ambient affect how the surface interacts with lights --</span>
<span class="co"># again, a lot of possible experimentation</span>
<span class="fu"><a href="https://rdrr.io/pkg/rgl/man/surface3d.html">surface3d</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">z</span>, back <span class="op">=</span> <span class="st">"filled"</span>,emission <span class="op">=</span> <span class="st">"grey30"</span>,specular <span class="op">=</span> <span class="st">"grey50"</span>,ambient <span class="op">=</span> <span class="st">"grey10"</span><span class="op">)</span>

<span class="fu">x3ptools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/x3ptools/man/x3p_snapshot.html">x3p_snapshot</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"bfScanImages/fadul1-1.png"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/rgl/man/rgl.open.html">rgl.close</a></span><span class="op">(</span><span class="op">)</span></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="fu">magick</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/magick/reference/animation.html">image_append</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu">magick</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/magick/reference/editing.html">image_read</a></span><span class="op">(</span><span class="st">"bfScanImages/fadul1-1.png"</span><span class="op">)</span>,
                       <span class="fu">magick</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/magick/reference/editing.html">image_read</a></span><span class="op">(</span><span class="st">"bfScanImages/fadul1-2.png"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="op">)</span></pre></div>
<p><img src="cmcR_plotReproduction_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
<div id="processed-cartrige-case-scan-figure-5" class="section level2">
<h2 class="hasAnchor">
<a href="#processed-cartrige-case-scan-figure-5" class="anchor"></a>Processed Cartrige Case Scan (Figure 5)</h2>
<p>Plotting the cartridge case surface matrix in which height values are mapped to a divergent color scheme may help highlight breech face impressions. We can use <code>ggplot2</code> to accomplish this.</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"fadul1.1_processed"</span>,<span class="st">"fadul1.2_processed"</span><span class="op">)</span></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="co">#Download a non-matching cartridge case to Fadul 1-1 and Fadul 1-2</span>

<span class="va">fadul2.1_raw</span> <span class="op">&lt;-</span> <span class="fu">x3ptools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/x3ptools/man/x3p_read.html">read_x3p</a></span><span class="op">(</span><span class="st">"https://tsapps.nist.gov/NRBTD/Studies/CartridgeMeasurement/DownloadMeasurement/8ae0b86d-210a-41fd-ad75-8212f9522f96"</span><span class="op">)</span>

<span class="va">fadul2.1_processed</span> <span class="op">&lt;-</span> <span class="va">fadul2.1_raw</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/preProcess_crop.html">preProcess_crop</a></span><span class="op">(</span>region <span class="op">=</span> <span class="st">"exterior"</span>,
                  radiusOffset <span class="op">=</span> <span class="op">-</span><span class="fl">30</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/preProcess_crop.html">preProcess_crop</a></span><span class="op">(</span>region <span class="op">=</span> <span class="st">"interior"</span>,
                  radiusOffset <span class="op">=</span> <span class="fl">200</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/preProcess_ransacLevel.html">preProcess_removeTrend</a></span><span class="op">(</span>statistic <span class="op">=</span> <span class="st">"quantile"</span>,
                                 tau <span class="op">=</span> <span class="fl">.5</span>,
                                 method <span class="op">=</span> <span class="st">"fn"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/preProcess_gaussFilter.html">preProcess_gaussFilter</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">x3ptools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/x3ptools/man/x3p_sample.html">sample_x3p</a></span><span class="op">(</span><span class="op">)</span></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="fu">cmcR</span><span class="fu">::</span><span class="fu"><a href="../reference/x3pListPlot.html">x3pListPlot</a></span><span class="op">(</span>x3pList <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"Fadul 1-1"</span> <span class="op">=</span> <span class="va">fadul1.1_processed</span>,
                                 <span class="st">"Fadul 1-2"</span> <span class="op">=</span> <span class="va">fadul1.2_processed</span>,
                                 <span class="st">"Fadul 2-1"</span> <span class="op">=</span> <span class="va">fadul2.1_processed</span><span class="op">)</span>,
                  type <span class="op">=</span> <span class="st">"faceted"</span>,
                  rotate <span class="op">=</span> <span class="fl">90</span>,
                  legend.quantiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">.01</span>,<span class="fl">.2</span>,<span class="fl">.5</span>,<span class="fl">.8</span>,<span class="fl">.99</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></pre></div>
<p><img src="cmcR_plotReproduction_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
</div>
<div id="cmc-plot-figure-4" class="section level2">
<h2 class="hasAnchor">
<a href="#cmc-plot-figure-4" class="anchor"></a>CMC Plot (Figure 4)</h2>
<p>The code below will perform the cell-based comparison procedure and then determine the initial/high CMCs for the known match and known non-match pairs of cartridge cases. The “initial” CMCs are determined based on the originally proposed method from Song (2013) while the “high” CMCs are determined using the “High CMC” method proposed by Tong et al. (2015).</p>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="va">kmComparisonFeatures</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">30</span>,<span class="fl">30</span>,by <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,
                                       <span class="op">~</span> <span class="fu"><a href="../reference/comparison_allTogether.html">comparison_allTogether</a></span><span class="op">(</span>reference <span class="op">=</span> <span class="va">fadul1.1_processed</span>,
                                                                target <span class="op">=</span> <span class="va">fadul1.2_processed</span>,
                                                                
                                                                theta <span class="op">=</span> <span class="va">.</span><span class="op">)</span><span class="op">)</span>

<span class="va">kmComparisonFeatures_rev</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">30</span>,<span class="fl">30</span>,by <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,
                                           <span class="op">~</span> <span class="fu"><a href="../reference/comparison_allTogether.html">comparison_allTogether</a></span><span class="op">(</span>reference <span class="op">=</span> <span class="va">fadul1.2_processed</span>,
                                                                    target <span class="op">=</span> <span class="va">fadul1.1_processed</span>,
                                                                    theta <span class="op">=</span> <span class="va">.</span><span class="op">)</span><span class="op">)</span>

<span class="va">kmComparison_allCMCs</span> <span class="op">&lt;-</span> <span class="va">kmComparisonFeatures</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>originalMethodClassif <span class="op">=</span> <span class="fu"><a href="../reference/decision_CMC.html">decision_CMC</a></span><span class="op">(</span>cellIndex <span class="op">=</span> <span class="va">cellIndex</span>,
                                              x <span class="op">=</span> <span class="va">x</span>,
                                              y <span class="op">=</span> <span class="va">y</span>,
                                              theta <span class="op">=</span> <span class="va">theta</span>,
                                              corr <span class="op">=</span> <span class="va">pairwiseCompCor</span>,
                                              xThresh <span class="op">=</span> <span class="fl">20</span>,
                                              thetaThresh <span class="op">=</span> <span class="fl">6</span>,
                                              corrThresh <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span>,
         highCMCClassif <span class="op">=</span> <span class="fu"><a href="../reference/decision_CMC.html">decision_CMC</a></span><span class="op">(</span>cellIndex <span class="op">=</span> <span class="va">cellIndex</span>,
                                              x <span class="op">=</span> <span class="va">x</span>,
                                              y <span class="op">=</span> <span class="va">y</span>,
                                              theta <span class="op">=</span> <span class="va">theta</span>,
                                              corr <span class="op">=</span> <span class="va">pairwiseCompCor</span>,
                                              xThresh <span class="op">=</span> <span class="fl">20</span>,
                                              thetaThresh <span class="op">=</span> <span class="fl">6</span>,
                                              corrThresh <span class="op">=</span> <span class="fl">.5</span>,
                                              tau <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>

<span class="va">kmComparison_allCMCs_rev</span> <span class="op">&lt;-</span> <span class="va">kmComparisonFeatures_rev</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>originalMethodClassif <span class="op">=</span> <span class="fu"><a href="../reference/decision_CMC.html">decision_CMC</a></span><span class="op">(</span>cellIndex <span class="op">=</span> <span class="va">cellIndex</span>,
                                              x <span class="op">=</span> <span class="va">x</span>,
                                              y <span class="op">=</span> <span class="va">y</span>,
                                              theta <span class="op">=</span> <span class="va">theta</span>,
                                              corr <span class="op">=</span> <span class="va">pairwiseCompCor</span>,
                                              xThresh <span class="op">=</span> <span class="fl">20</span>,
                                              thetaThresh <span class="op">=</span> <span class="fl">6</span>,
                                              corrThresh <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span>,
         highCMCClassif <span class="op">=</span> <span class="fu"><a href="../reference/decision_CMC.html">decision_CMC</a></span><span class="op">(</span>cellIndex <span class="op">=</span> <span class="va">cellIndex</span>,
                                              x <span class="op">=</span> <span class="va">x</span>,
                                              y <span class="op">=</span> <span class="va">y</span>,
                                              theta <span class="op">=</span> <span class="va">theta</span>,
                                              corr <span class="op">=</span> <span class="va">pairwiseCompCor</span>,
                                              xThresh <span class="op">=</span> <span class="fl">20</span>,
                                              thetaThresh <span class="op">=</span> <span class="fl">6</span>,
                                              corrThresh <span class="op">=</span> <span class="fl">.5</span>,
                                              tau <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>

<span class="va">knmComparisonFeatures</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">30</span>,<span class="fl">30</span>,by <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,
                                       <span class="op">~</span> <span class="fu"><a href="../reference/comparison_allTogether.html">comparison_allTogether</a></span><span class="op">(</span>reference <span class="op">=</span> <span class="va">fadul1.1_processed</span>,
                                                                target <span class="op">=</span> <span class="va">fadul2.1_processed</span>,
                                                                
                                                                theta <span class="op">=</span> <span class="va">.</span><span class="op">)</span><span class="op">)</span>

<span class="va">knmComparisonFeatures_rev</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dfr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">30</span>,<span class="fl">30</span>,by <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,
                                           <span class="op">~</span> <span class="fu"><a href="../reference/comparison_allTogether.html">comparison_allTogether</a></span><span class="op">(</span>reference <span class="op">=</span> <span class="va">fadul2.1_processed</span>,
                                                                    target <span class="op">=</span> <span class="va">fadul1.1_processed</span>,
                                                                    theta <span class="op">=</span> <span class="va">.</span><span class="op">)</span><span class="op">)</span>

<span class="va">knmComparison_allCMCs</span> <span class="op">&lt;-</span> <span class="va">knmComparisonFeatures</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>originalMethodClassif <span class="op">=</span> <span class="fu"><a href="../reference/decision_CMC.html">decision_CMC</a></span><span class="op">(</span>cellIndex <span class="op">=</span> <span class="va">cellIndex</span>,
                                              x <span class="op">=</span> <span class="va">x</span>,
                                              y <span class="op">=</span> <span class="va">y</span>,
                                              theta <span class="op">=</span> <span class="va">theta</span>,
                                              corr <span class="op">=</span> <span class="va">pairwiseCompCor</span>,
                                              xThresh <span class="op">=</span> <span class="fl">20</span>,
                                              thetaThresh <span class="op">=</span> <span class="fl">6</span>,
                                              corrThresh <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span>,
         highCMCClassif <span class="op">=</span> <span class="fu"><a href="../reference/decision_CMC.html">decision_CMC</a></span><span class="op">(</span>cellIndex <span class="op">=</span> <span class="va">cellIndex</span>,
                                              x <span class="op">=</span> <span class="va">x</span>,
                                              y <span class="op">=</span> <span class="va">y</span>,
                                              theta <span class="op">=</span> <span class="va">theta</span>,
                                              corr <span class="op">=</span> <span class="va">pairwiseCompCor</span>,
                                              xThresh <span class="op">=</span> <span class="fl">20</span>,
                                              thetaThresh <span class="op">=</span> <span class="fl">6</span>,
                                              corrThresh <span class="op">=</span> <span class="fl">.5</span>,
                                              tau <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>

<span class="va">knmComparison_allCMCs_rev</span> <span class="op">&lt;-</span> <span class="va">knmComparisonFeatures_rev</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>originalMethodClassif <span class="op">=</span> <span class="fu"><a href="../reference/decision_CMC.html">decision_CMC</a></span><span class="op">(</span>cellIndex <span class="op">=</span> <span class="va">cellIndex</span>,
                                              x <span class="op">=</span> <span class="va">x</span>,
                                              y <span class="op">=</span> <span class="va">y</span>,
                                              theta <span class="op">=</span> <span class="va">theta</span>,
                                              corr <span class="op">=</span> <span class="va">pairwiseCompCor</span>,
                                              xThresh <span class="op">=</span> <span class="fl">20</span>,
                                              thetaThresh <span class="op">=</span> <span class="fl">6</span>,
                                              corrThresh <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span>,
         highCMCClassif <span class="op">=</span> <span class="fu"><a href="../reference/decision_CMC.html">decision_CMC</a></span><span class="op">(</span>cellIndex <span class="op">=</span> <span class="va">cellIndex</span>,
                                              x <span class="op">=</span> <span class="va">x</span>,
                                              y <span class="op">=</span> <span class="va">y</span>,
                                              theta <span class="op">=</span> <span class="va">theta</span>,
                                              corr <span class="op">=</span> <span class="va">pairwiseCompCor</span>,
                                              xThresh <span class="op">=</span> <span class="fl">20</span>,
                                              thetaThresh <span class="op">=</span> <span class="fl">6</span>,
                                              corrThresh <span class="op">=</span> <span class="fl">.5</span>,
                                              tau <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></pre></div>
<p>We can then visualize the CMCs for these comparisons. Below are the CMCs determined under the original method of Song (2013).</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="va">kmCMCPlot</span> <span class="op">&lt;-</span> <span class="fu">cmcR</span><span class="fu">::</span><span class="fu"><a href="../reference/cmcPlot.html">cmcPlot</a></span><span class="op">(</span>referenceScan <span class="op">=</span> <span class="va">fadul1.1_processed</span>,
                            targetScan <span class="op">=</span> <span class="va">fadul1.2_processed</span>,
                            reference_v_target_CMCs <span class="op">=</span> <span class="va">kmComparison_allCMCs</span>,
                            target_v_reference_CMCs <span class="op">=</span> <span class="va">kmComparison_allCMCs_rev</span>,
                            type <span class="op">=</span> <span class="st">"faceted"</span>,
                            x3pNames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Fadul 1-1"</span>,<span class="st">"Fadul 2-1"</span><span class="op">)</span>,
                            legend.quantiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">.01</span>,<span class="fl">.2</span>,<span class="fl">.5</span>,<span class="fl">.8</span>,<span class="fl">.99</span>,<span class="fl">1</span><span class="op">)</span>,
                            cell.colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#a60b00"</span>,<span class="st">"#1b03a3"</span><span class="op">)</span>,
                            cell.alpha <span class="op">=</span> <span class="fl">.15</span>,
                            na.value <span class="op">=</span> <span class="st">"gray80"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="op">~</span> <span class="va">.</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">kmLegend_originalCMC</span> <span class="op">&lt;-</span> <span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/get_legend.html">get_legend</a></span><span class="op">(</span><span class="va">kmCMCPlot</span><span class="op">$</span><span class="va">originalMethodCMCs_reference_v_target</span> <span class="op">+</span>
                                   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.direction <span class="op">=</span> <span class="st">"horizontal"</span><span class="op">)</span><span class="op">)</span>

<span class="va">km_originalCMC_reference_v_target</span> <span class="op">&lt;-</span> <span class="va">kmCMCPlot</span><span class="op">$</span><span class="va">originalMethodCMCs_reference_v_target</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span>,
        plot.margin<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">.05</span>,<span class="op">-</span><span class="fl">.5</span>,<span class="op">-</span><span class="fl">.05</span>,<span class="op">-</span><span class="fl">.5</span><span class="op">)</span>, <span class="st">"cm"</span><span class="op">)</span>,
        plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="va">km_originalCMC_target_v_reference</span> <span class="op">&lt;-</span> <span class="va">kmCMCPlot</span><span class="op">$</span><span class="va">originalMethodCMCs_target_v_reference</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span>,
        plot.margin<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">.05</span>,<span class="op">-</span><span class="fl">.5</span>,<span class="op">-</span><span class="fl">.05</span>,<span class="op">-</span><span class="fl">.5</span><span class="op">)</span>, <span class="st">"cm"</span><span class="op">)</span>,
        plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="va">km_originalCMCPlot_bothDirections</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">10</span><span class="op">)</span>,
                  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">11</span><span class="op">)</span>,
                  expand <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotation_custom.html">annotation_custom</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplotGrob.html">ggplotGrob</a></span><span class="op">(</span><span class="va">km_originalCMC_reference_v_target</span><span class="op">)</span>,
                    xmin <span class="op">=</span> <span class="fl">1</span>,xmax <span class="op">=</span> <span class="fl">10</span>,ymin <span class="op">=</span> <span class="fl">6.2</span>,ymax <span class="op">=</span> <span class="fl">11</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotation_custom.html">annotation_custom</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplotGrob.html">ggplotGrob</a></span><span class="op">(</span><span class="va">km_originalCMC_target_v_reference</span><span class="op">)</span>,
                    xmin <span class="op">=</span> <span class="fl">1</span>,xmax <span class="op">=</span> <span class="fl">10</span>,ymin <span class="op">=</span> <span class="fl">2</span>,ymax <span class="op">=</span> <span class="fl">6.2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotation_custom.html">annotation_custom</a></span><span class="op">(</span><span class="va">kmLegend_originalCMC</span>,
                    xmin <span class="op">=</span> <span class="fl">1</span>,xmax <span class="op">=</span> <span class="fl">10</span>,ymin <span class="op">=</span> <span class="fl">1.45</span>,ymax <span class="op">=</span> <span class="fl">1.45</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>,x <span class="op">=</span> <span class="fl">3.85</span>,y <span class="op">=</span> <span class="fl">8.15</span>,size <span class="op">=</span> <span class="fl">5</span>,label <span class="op">=</span> <span class="st">"Fadul 1-1"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>,x <span class="op">=</span> <span class="fl">3.85</span>,y <span class="op">=</span> <span class="fl">4</span>,size <span class="op">=</span> <span class="fl">5</span>,label <span class="op">=</span> <span class="st">"Fadul 1-1"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>,x <span class="op">=</span> <span class="fl">7.05</span>,y <span class="op">=</span> <span class="fl">8.15</span>,size <span class="op">=</span> <span class="fl">5</span>,label <span class="op">=</span> <span class="st">"Fadul 1-2"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>,x <span class="op">=</span> <span class="fl">7.05</span>,y <span class="op">=</span> <span class="fl">4</span>,size <span class="op">=</span> <span class="fl">5</span>,label <span class="op">=</span> <span class="st">"Fadul 1-2"</span><span class="op">)</span>

<span class="va">km_originalCMCPlot_bothDirections</span></pre></div>
<p><img src="cmcR_plotReproduction_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>And the CMCs determined under the High CMC method of Tong et al. (2015).</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="va">kmLegend_highCMC</span> <span class="op">&lt;-</span> <span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/get_legend.html">get_legend</a></span><span class="op">(</span><span class="va">kmCMCPlot</span><span class="op">$</span><span class="va">highCMC_reference_v_target</span> <span class="op">+</span>
                                   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.direction <span class="op">=</span> <span class="st">"horizontal"</span><span class="op">)</span><span class="op">)</span>

<span class="va">km_highCMC_reference_v_target</span> <span class="op">&lt;-</span> <span class="va">kmCMCPlot</span><span class="op">$</span><span class="va">highCMC_reference_v_target</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span>,
        plot.margin<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">.05</span>,<span class="op">-</span><span class="fl">.5</span>,<span class="op">-</span><span class="fl">.05</span>,<span class="op">-</span><span class="fl">.5</span><span class="op">)</span>, <span class="st">"cm"</span><span class="op">)</span>,
        plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="va">km_highCMC_target_v_reference</span> <span class="op">&lt;-</span> <span class="va">kmCMCPlot</span><span class="op">$</span><span class="va">highCMC_target_v_reference</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span>,
        plot.margin<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">.05</span>,<span class="op">-</span><span class="fl">.5</span>,<span class="op">-</span><span class="fl">.05</span>,<span class="op">-</span><span class="fl">.5</span><span class="op">)</span>, <span class="st">"cm"</span><span class="op">)</span>,
        plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="va">km_highCMCCMCPlot_bothDirections</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">10</span><span class="op">)</span>,
                  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">11</span><span class="op">)</span>,
                  expand <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotation_custom.html">annotation_custom</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplotGrob.html">ggplotGrob</a></span><span class="op">(</span><span class="va">km_highCMC_reference_v_target</span><span class="op">)</span>,
                    xmin <span class="op">=</span> <span class="fl">1.1</span>,xmax <span class="op">=</span> <span class="fl">10</span>,ymin <span class="op">=</span> <span class="fl">6.55</span>,ymax <span class="op">=</span> <span class="fl">11</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotation_custom.html">annotation_custom</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplotGrob.html">ggplotGrob</a></span><span class="op">(</span><span class="va">km_highCMC_target_v_reference</span><span class="op">)</span>,
                    xmin <span class="op">=</span> <span class="fl">1</span>,xmax <span class="op">=</span> <span class="fl">10</span>,ymin <span class="op">=</span> <span class="fl">2</span>,ymax <span class="op">=</span> <span class="fl">6.55</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotation_custom.html">annotation_custom</a></span><span class="op">(</span><span class="va">kmLegend_highCMC</span>,
                    xmin <span class="op">=</span> <span class="fl">1</span>,xmax <span class="op">=</span> <span class="fl">10</span>,ymin <span class="op">=</span> <span class="fl">1.45</span>,ymax <span class="op">=</span> <span class="fl">1.45</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>,x <span class="op">=</span> <span class="fl">3.65</span>,y <span class="op">=</span> <span class="fl">8.65</span>,size <span class="op">=</span> <span class="fl">5</span>,label <span class="op">=</span> <span class="st">"Fadul 1-1"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>,x <span class="op">=</span> <span class="fl">3.65</span>,y <span class="op">=</span> <span class="fl">4</span>,size <span class="op">=</span> <span class="fl">5</span>,label <span class="op">=</span> <span class="st">"Fadul 1-1"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>,x <span class="op">=</span> <span class="fl">7.25</span>,y <span class="op">=</span> <span class="fl">8.65</span>,size <span class="op">=</span> <span class="fl">5</span>,label <span class="op">=</span> <span class="st">"Fadul 1-2"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>,x <span class="op">=</span> <span class="fl">7.25</span>,y <span class="op">=</span> <span class="fl">4</span>,size <span class="op">=</span> <span class="fl">5</span>,label <span class="op">=</span> <span class="st">"Fadul 1-2"</span><span class="op">)</span>

<span class="va">km_highCMCCMCPlot_bothDirections</span></pre></div>
<p><img src="cmcR_plotReproduction_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<p>The known non-match pair didn’t yield any high CMCs, so we can only visualize the CMCs identified under the original method of Song (2013).</p>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="va">knmCMCPlot</span> <span class="op">&lt;-</span> <span class="fu">cmcR</span><span class="fu">::</span><span class="fu"><a href="../reference/cmcPlot.html">cmcPlot</a></span><span class="op">(</span>referenceScan <span class="op">=</span> <span class="va">fadul1.1_processed</span>,
                            targetScan <span class="op">=</span> <span class="va">fadul2.1_processed</span>,
                            reference_v_target_CMCs <span class="op">=</span> <span class="va">knmComparison_allCMCs</span>,
                            target_v_reference_CMCs <span class="op">=</span> <span class="va">knmComparison_allCMCs_rev</span>,
                            type <span class="op">=</span> <span class="st">"faceted"</span>,
                            x3pNames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Fadul 1-1"</span>,<span class="st">"Fadul 2-1"</span><span class="op">)</span>,
                            legend.quantiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">.01</span>,<span class="fl">.2</span>,<span class="fl">.5</span>,<span class="fl">.8</span>,<span class="fl">.99</span>,<span class="fl">1</span><span class="op">)</span>,
                            cell.colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#a60b00"</span>,<span class="st">"#1b03a3"</span><span class="op">)</span>,
                            cell.alpha <span class="op">=</span> <span class="fl">.15</span>,
                            na.value <span class="op">=</span> <span class="st">"gray80"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="op">~</span> <span class="va">.</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">knmLegend</span> <span class="op">&lt;-</span> <span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/get_legend.html">get_legend</a></span><span class="op">(</span><span class="va">knmCMCPlot</span><span class="op">$</span><span class="va">originalMethodCMCs_reference_v_target</span> <span class="op">+</span>
                                   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.direction <span class="op">=</span> <span class="st">"horizontal"</span><span class="op">)</span><span class="op">)</span>

<span class="va">knm_reference_v_target</span> <span class="op">&lt;-</span> <span class="va">knmCMCPlot</span><span class="op">$</span><span class="va">originalMethodCMCs_reference_v_target</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span>,
        plot.margin<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">.05</span>,<span class="op">-</span><span class="fl">.5</span>,<span class="op">-</span><span class="fl">.05</span>,<span class="op">-</span><span class="fl">.5</span><span class="op">)</span>, <span class="st">"cm"</span><span class="op">)</span>,
        plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="va">knm_target_v_reference</span> <span class="op">&lt;-</span> <span class="va">knmCMCPlot</span><span class="op">$</span><span class="va">originalMethodCMCs_target_v_reference</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span>,
        plot.margin<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">.05</span>,<span class="op">-</span><span class="fl">.5</span>,<span class="op">-</span><span class="fl">.05</span>,<span class="op">-</span><span class="fl">.5</span><span class="op">)</span>, <span class="st">"cm"</span><span class="op">)</span>,
        plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="va">knm_cmcPlot_bothDirections</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">10</span><span class="op">)</span>,
                  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">11</span><span class="op">)</span>,
                  expand <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotation_custom.html">annotation_custom</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplotGrob.html">ggplotGrob</a></span><span class="op">(</span><span class="va">knm_reference_v_target</span><span class="op">)</span>,
                    xmin <span class="op">=</span> <span class="fl">1</span>,xmax <span class="op">=</span> <span class="fl">10</span>,ymin <span class="op">=</span> <span class="fl">6.5</span>,ymax <span class="op">=</span> <span class="fl">11</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotation_custom.html">annotation_custom</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplotGrob.html">ggplotGrob</a></span><span class="op">(</span><span class="va">knm_target_v_reference</span><span class="op">)</span>,
                    xmin <span class="op">=</span> <span class="fl">1</span>,xmax <span class="op">=</span> <span class="fl">10</span>,ymin <span class="op">=</span> <span class="fl">2</span>,ymax <span class="op">=</span> <span class="fl">6.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotation_custom.html">annotation_custom</a></span><span class="op">(</span><span class="va">knmLegend</span>,
                    xmin <span class="op">=</span> <span class="fl">1</span>,xmax <span class="op">=</span> <span class="fl">10</span>,ymin <span class="op">=</span> <span class="fl">1.45</span>,ymax <span class="op">=</span> <span class="fl">1.45</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>,x <span class="op">=</span> <span class="fl">3.75</span>,y <span class="op">=</span> <span class="fl">8.65</span>,size <span class="op">=</span> <span class="fl">5</span>,label <span class="op">=</span> <span class="st">"Fadul 1-1"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>,x <span class="op">=</span> <span class="fl">3.75</span>,y <span class="op">=</span> <span class="fl">4</span>,size <span class="op">=</span> <span class="fl">5</span>,label <span class="op">=</span> <span class="st">"Fadul 1-1"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>,x <span class="op">=</span> <span class="fl">7.45</span>,y <span class="op">=</span> <span class="fl">8.65</span>,size <span class="op">=</span> <span class="fl">5</span>,label <span class="op">=</span> <span class="st">"Fadul 2-1"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>,x <span class="op">=</span> <span class="fl">7.45</span>,y <span class="op">=</span> <span class="fl">4</span>,size <span class="op">=</span> <span class="fl">5</span>,label <span class="op">=</span> <span class="st">"Fadul 2-1"</span><span class="op">)</span>

<span class="va">knm_cmcPlot_bothDirections</span></pre></div>
<p><img src="cmcR_plotReproduction_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<ul>
<li><p>Song, J. (2013). Proposed “NIST Ballistics Identification System (NBIS)” Based on 3D Topogra-phy Measurements on Correlation Cells.American Firearm and Tool Mark Examiners Journal,45(2):11.</p></li>
<li><p>Tong, M., Song, J., and Chu, W. (2015). An Improved Algorithm of Congruent Matching Cells(CMC) Method for Firearm Evidence Identifications.Journal of Research of the National Institute of Standards and Technology, 120:102.</p></li>
<li><p>Fadul T., Hernandez G., Stoiloff S. and Gulati Sneh “An Empirical Study to Improve the Scientific Foundation of Forensic Firearm and Tool Mark Identification Utilizing 10 Consecutively Manufactured Slides,” 2011 NCJRS 237960</p></li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Joe Zemmels, Heike Hofmann, Susan VanderPlas.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
