<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reproducible Example • cmcR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Reproducible Example">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cmcR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/cmcR_plotReproduction.html">Reproduction of published plots using the cmcR package</a>
    </li>
    <li>
      <a href="../articles/reproducibleExample.html">Reproducible Example</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="reproducibleExample_files/htmlwidgets-1.5.1/htmlwidgets.js"></script><script src="reproducibleExample_files/jquery-1.12.4/jquery.min.js"></script><link href="reproducibleExample_files/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="reproducibleExample_files/datatables-binding-0.10/datatables.js"></script><link href="reproducibleExample_files/dt-core-1.10.19/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="reproducibleExample_files/dt-core-1.10.19/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="reproducibleExample_files/dt-core-1.10.19/js/jquery.dataTables.min.js"></script><link href="reproducibleExample_files/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet">
<script src="reproducibleExample_files/crosstalk-1.0.0/js/crosstalk.min.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Reproducible Example</h1>
            
      
      
      <div class="hidden name"><code>reproducibleExample.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>This vignette is meant to illustrate the usage of the cmcR package via a use-case similar to what a forensic examiner taking a cartridge case identification profiency test would experience. In particular, it is common in such tests to give an examiner some number of “known match” cartridge cases and asked to identify additional matches in a collection of unknown-source cartridge cases.</p>
<p>To install the cmcR package from github, run the following command in your R console.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1">devtools<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/devtools/man/remote-reexports.html">install_github</a></span>(<span class="st">"https://github.com/jzemmels/cmcR"</span>)</a></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(cmcR)</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(magrittr)</a>
<a class="sourceLine" id="cb2-3" title="3"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb2-4" title="4"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(dplyr)</a></code></pre></div>
<p>For this use case, suppose we have two known match cartridge cases (km1 and km2) and two of unknown source (unknown1 and unknown2). Let’s pretend that we don’t see the file path clearing indicating which of the unknown source cartridge cases match the known source. These cartridge case data came from a study done by Fadul et al. (2011) and are accessible <a href="https://tsapps.nist.gov/NRBTD/Studies/Studies/Details/e7a8aab8-8d5a-44ac-b2be-f0de7c2ca505?nm=True&amp;mt=1&amp;m=3&amp;sp=1">here</a>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">km1_raw &lt;-<span class="st"> </span>x3ptools<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/x3ptools/man/x3p_read.html">read_x3p</a></span>(<span class="st">"~/bulletCartridgeScans/fadul_allScans/Fadul_1/cc/Fadul 1-1.x3p"</span>)</a>
<a class="sourceLine" id="cb3-2" title="2">km2_raw &lt;-<span class="st"> </span>x3ptools<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/x3ptools/man/x3p_read.html">read_x3p</a></span>(<span class="st">"~/bulletCartridgeScans/fadul_allScans/Fadul_1/cc/Fadul 1-2.x3p"</span>)</a>
<a class="sourceLine" id="cb3-3" title="3">unknown1_raw &lt;-<span class="st"> </span>x3ptools<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/x3ptools/man/x3p_read.html">read_x3p</a></span>(<span class="st">"~/bulletCartridgeScans/fadul_allScans/Fadul_2/cc/Fadul 2-1.x3p"</span>)</a>
<a class="sourceLine" id="cb3-4" title="4">unknown2_raw &lt;-<span class="st"> </span>x3ptools<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/x3ptools/man/x3p_read.html">read_x3p</a></span>(<span class="st">"~/bulletCartridgeScans/fadul_allScans/Fadul_1/cc/Fadul F.x3p"</span>)</a></code></pre></div>
</div>
<div id="cartridge-case-visualization" class="section level2">
<h2 class="hasAnchor">
<a href="#cartridge-case-visualization" class="anchor"></a>Cartridge case visualization</h2>
<p>Visualizing cartridge case data is useful for determining, for example, how various pre-processing methods affect the final estimation of the breech face impressions. There are a number of ways to visualize cartridge case data, each with their own strengths and weaknesses.</p>
<div id="imager-with-base-plot" class="section level3">
<h3 class="hasAnchor">
<a href="#imager-with-base-plot" class="anchor"></a>Imager with Base Plot</h3>
<p>A quick yet inflexible way is to turn the surface matrix into a <code>cimg</code> object and use base plot.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="dt">mar =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb4-2" title="2"></a>
<a class="sourceLine" id="cb4-3" title="3">imager<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/imager/man/imlist.html">imlist</a></span>(</a>
<a class="sourceLine" id="cb4-4" title="4">km1_raw<span class="op">$</span>surface.matrix <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="st">  </span>imager<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/imager/man/as.cimg.html">as.cimg</a></span>(),</a>
<a class="sourceLine" id="cb4-6" title="6">km2_raw<span class="op">$</span>surface.matrix <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="st">  </span>imager<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/imager/man/as.cimg.html">as.cimg</a></span>(),</a>
<a class="sourceLine" id="cb4-8" title="8">unknown1_raw<span class="op">$</span>surface.matrix <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-9" title="9"><span class="st">  </span>imager<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/imager/man/as.cimg.html">as.cimg</a></span>(),</a>
<a class="sourceLine" id="cb4-10" title="10">unknown2_raw<span class="op">$</span>surface.matrix <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-11" title="11"><span class="st">  </span>imager<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/imager/man/as.cimg.html">as.cimg</a></span>()</a>
<a class="sourceLine" id="cb4-12" title="12">) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-13" title="13"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>()</a></code></pre></div>
<p><img src="reproducibleExample_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
</div>
<div id="ggplot2" class="section level3">
<h3 class="hasAnchor">
<a href="#ggplot2" class="anchor"></a>ggplot2</h3>
<p>ggplots are more flexible, but geom_tile takes a considerable amount of time to plot relative to base plotting a cimg object. For the sake of space, only one ggplot is shown below.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">km1_raw<span class="op">$</span>surface.matrix <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-2" title="2"><span class="st">  </span>imager<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/imager/man/as.cimg.html">as.cimg</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x,<span class="dt">y =</span> y)) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-5" title="5"><span class="st">  </span><span class="kw">geom_raster</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> value)) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-6" title="6"><span class="st">  </span><span class="kw">scale_fill_gradient2</span>(<span class="dt">low =</span> <span class="st">"grey0"</span>,</a>
<a class="sourceLine" id="cb5-7" title="7">                       <span class="dt">mid =</span> <span class="st">"grey50"</span>,</a>
<a class="sourceLine" id="cb5-8" title="8">                       <span class="dt">high =</span> <span class="st">"grey100"</span>,</a>
<a class="sourceLine" id="cb5-9" title="9">                       <span class="dt">na.value =</span> <span class="st">"white"</span>,</a>
<a class="sourceLine" id="cb5-10" title="10">                       <span class="dt">midpoint =</span> <span class="kw"><a href="https://rdrr.io/r/stats/median.html">median</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/median.html">median</a></span>(km1_raw<span class="op">$</span>surface.matrix,</a>
<a class="sourceLine" id="cb5-11" title="11">                                                          <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)))) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-12" title="12"><span class="st">  </span><span class="kw">coord_fixed</span>(<span class="dt">expand =</span> <span class="ot">FALSE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-13" title="13"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb5-14" title="14"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid.major =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb5-15" title="15">        <span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb5-16" title="16">        <span class="dt">legend.position =</span> <span class="st">"none"</span>,</a>
<a class="sourceLine" id="cb5-17" title="17">        <span class="dt">axis.title.x =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb5-18" title="18">        <span class="dt">axis.title.y =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
<p><img src="reproducibleExample_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
<div id="x3ptoolsimage_x3p" class="section level3">
<h3 class="hasAnchor">
<a href="#x3ptoolsimage_x3p" class="anchor"></a>x3ptools::image_x3p</h3>
<p>The <code><a href="https://rdrr.io/pkg/x3ptools/man/x3p_image.html">x3ptools::image_x3p</a></code> function provides 3D visualization functionality, but requires opening an RGL device on an individual machine (can’t be viewed in an R Markdown file without making it huge)</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">km1_raw <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-2" title="2"><span class="st">  </span>x3ptools<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/x3ptools/man/x3p_image.html">image_x3p</a></span>(<span class="dt">zoom =</span> <span class="fl">.7</span>)</a></code></pre></div>
</div>
</div>
<div id="pre-processing" class="section level2">
<h2 class="hasAnchor">
<a href="#pre-processing" class="anchor"></a>Pre-processing</h2>
<p>If we want to compare these cartridge case scans based on their breech face impressions, they need to undergo some pre-processing. The <code>cmcR</code> package has the modularized family of <code>preProcess_</code> functions or the all-in-one (except Gaussian filtering) <code>selectBFImpression_</code> functions to accomplish this.</p>
<p>Below we can see how the <code>preProcess_</code> family of functions can be used to process a cartridge case scan. The RANSAC method is applied twice for a more precise estimate of the breech face impression height value. Then the whitespace (all NA-valued rows/columns) on the exterior of the breech face impression is cropped. Next the firing pin circle is automatically estimated and any pixels within this circle are filtered out the scan. Lastly, a lowpass Gaussian filter meant to reduce the effect of high frequency “noise” in the scan is applied.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">3152020</span>) <span class="co">#RANSAC method is based on randomly sampling points in matrix</span></a>
<a class="sourceLine" id="cb7-2" title="2"></a>
<a class="sourceLine" id="cb7-3" title="3">km1_residuals &lt;-<span class="st"> </span>km1_raw <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-4" title="4"><span class="st">  </span>x3ptools<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/x3ptools/man/x3p_sample.html">sample_x3p</a></span>(<span class="dt">m =</span> <span class="dv">2</span>) <span class="co">#down-sampled copy of km1_raw</span></a>
<a class="sourceLine" id="cb7-5" title="5"></a>
<a class="sourceLine" id="cb7-6" title="6">km1_residuals<span class="op">$</span>surface.matrix &lt;-<span class="st"> </span>km1_residuals<span class="op">$</span>surface.matrix <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-7" title="7"><span class="st">  </span><span class="kw"><a href="../reference/preProcess_ransac.html">preProcess_ransac</a></span>(<span class="dt">inlierTreshold =</span> <span class="dv">10</span><span class="op">^</span>(<span class="op">-</span><span class="dv">5</span>),</a>
<a class="sourceLine" id="cb7-8" title="8">                    <span class="dt">finalSelectionThreshold =</span> <span class="dv">2</span><span class="op">*</span>(<span class="dv">10</span><span class="op">^</span>(<span class="op">-</span><span class="dv">5</span>)),</a>
<a class="sourceLine" id="cb7-9" title="9">                    <span class="dt">iters =</span> <span class="dv">150</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-10" title="10"><span class="st">  </span><span class="kw"><a href="../reference/preProcess_levelBF.html">preProcess_levelBF</a></span>(<span class="dt">useResiduals =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-11" title="11"><span class="st">  </span><span class="kw"><a href="../reference/preProcess_ransac.html">preProcess_ransac</a></span>(<span class="dt">inlierTreshold =</span> <span class="fl">.1</span><span class="op">*</span>(<span class="dv">10</span><span class="op">^</span>(<span class="op">-</span><span class="dv">5</span>)),</a>
<a class="sourceLine" id="cb7-12" title="12">                    <span class="dt">finalSelectionThreshold =</span> <span class="dv">2</span><span class="op">*</span>(<span class="dv">10</span><span class="op">^</span>(<span class="op">-</span><span class="dv">5</span>)),</a>
<a class="sourceLine" id="cb7-13" title="13">                    <span class="dt">iters =</span> <span class="dv">300</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-14" title="14"><span class="st">  </span><span class="kw"><a href="../reference/preProcess_levelBF.html">preProcess_levelBF</a></span>(<span class="dt">useResiduals =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-15" title="15"><span class="st">  </span><span class="kw"><a href="../reference/preProcess_cropWS.html">preProcess_cropWS</a></span>(<span class="dt">croppingThresh =</span> <span class="dv">2</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-16" title="16"><span class="st">  </span><span class="kw"><a href="../reference/preProcess_removeFPCircle.html">preProcess_removeFPCircle</a></span>(<span class="dt">aggregation_function =</span> mean,</a>
<a class="sourceLine" id="cb7-17" title="17">                            <span class="dt">smootherSize =</span> <span class="dv">2</span><span class="op">*</span><span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>((.<span class="dv">1</span><span class="op">*</span><span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(.)<span class="op">/</span><span class="dv">2</span>)) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb7-18" title="18">                            <span class="dt">meshSize =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb7-19" title="19">                            <span class="dt">houghScoreQuant =</span> <span class="fl">.9</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-20" title="20"><span class="st">  </span><span class="kw"><a href="../reference/preProcess_gaussFilter.html">preProcess_gaussFilter</a></span>(<span class="dt">res =</span> km1_residuals<span class="op">$</span>header.info<span class="op">$</span>incrementY,</a>
<a class="sourceLine" id="cb7-21" title="21">                         <span class="dt">wavelength =</span> <span class="dv">16</span>,</a>
<a class="sourceLine" id="cb7-22" title="22">                         <span class="dt">filtertype =</span> <span class="st">"lp"</span>)</a></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">km1_residuals <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-2" title="2"><span class="st">  </span>x3ptools<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/x3ptools/man/x3p_image.html">image_x3p</a></span>(<span class="dt">zoom =</span> <span class="fl">.7</span>)</a></code></pre></div>
<p>The <code>selectBFImpression_</code> functions perform all of the pre-processing steps except for the Gaussian filtering in one function call. The following will process the 3 other scans in an equivalent manner to km1_residuals above. Note that the <code>selectBFImpression_</code> functions actually returns a list of two elements: <code>params</code> containing the list of parameters under which the function call was made (for reproducibility purposes) and <code>x3p</code> containing the actual processed x3p object.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">km2_residuals &lt;-<span class="st"> </span><span class="kw"><a href="../reference/selectBFImpression_sample_x3p.html">selectBFImpression_sample_x3p</a></span>(<span class="dt">x3p_path =</span> <span class="st">"../../bulletCartridgeScans/fadul_allScans/Fadul_1/cc/Fadul 1-2.x3p"</span>,</a>
<a class="sourceLine" id="cb9-2" title="2">                                               <span class="dt">ransacIters =</span> <span class="dv">150</span>,</a>
<a class="sourceLine" id="cb9-3" title="3">                                               <span class="dt">ransacInlierThresh =</span> <span class="dv">10</span><span class="op">^-</span><span class="dv">5</span>,</a>
<a class="sourceLine" id="cb9-4" title="4">                                               <span class="dt">ransacFinalSelectThresh =</span> <span class="dv">2</span><span class="op">*</span>(<span class="dv">10</span><span class="op">^-</span><span class="dv">5</span>),</a>
<a class="sourceLine" id="cb9-5" title="5">                                               <span class="dt">useResiduals =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb9-6" title="6">unknown1_residuals &lt;-<span class="st"> </span><span class="kw"><a href="../reference/selectBFImpression_sample_x3p.html">selectBFImpression_sample_x3p</a></span>(<span class="dt">x3p_path =</span> <span class="st">"../../bulletCartridgeScans/fadul_allScans/Fadul_2/cc/Fadul 2-1.x3p"</span>,</a>
<a class="sourceLine" id="cb9-7" title="7">                                                    <span class="dt">ransacIters =</span> <span class="dv">150</span>,</a>
<a class="sourceLine" id="cb9-8" title="8">                                                    <span class="dt">ransacInlierThresh =</span> <span class="dv">10</span><span class="op">^-</span><span class="dv">5</span>,</a>
<a class="sourceLine" id="cb9-9" title="9">                                                    <span class="dt">ransacFinalSelectThresh =</span> <span class="dv">2</span><span class="op">*</span>(<span class="dv">10</span><span class="op">^-</span><span class="dv">5</span>),</a>
<a class="sourceLine" id="cb9-10" title="10">                                                    <span class="dt">useResiduals =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb9-11" title="11">unknown2_residuals &lt;-<span class="st"> </span><span class="kw"><a href="../reference/selectBFImpression_sample_x3p.html">selectBFImpression_sample_x3p</a></span>(<span class="dt">x3p_path =</span> <span class="st">"../../bulletCartridgeScans/fadul_allScans/Fadul_1/cc/Fadul F.x3p"</span>,</a>
<a class="sourceLine" id="cb9-12" title="12">                                                    <span class="dt">ransacIters =</span> <span class="dv">150</span>,</a>
<a class="sourceLine" id="cb9-13" title="13">                                                    <span class="dt">ransacInlierThresh =</span> <span class="dv">10</span><span class="op">^-</span><span class="dv">5</span>,</a>
<a class="sourceLine" id="cb9-14" title="14">                                                    <span class="dt">ransacFinalSelectThresh =</span> <span class="dv">2</span><span class="op">*</span>(<span class="dv">10</span><span class="op">^-</span><span class="dv">5</span>),</a>
<a class="sourceLine" id="cb9-15" title="15">                                                    <span class="dt">useResiduals =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb9-16" title="16"><span class="co">#&gt; Warning in predict.lm(candidatePlane, observedPixelLocations): prediction from a</span></a>
<a class="sourceLine" id="cb9-17" title="17"><span class="co">#&gt; rank-deficient fit may be misleading</span></a>
<a class="sourceLine" id="cb9-18" title="18"></a>
<a class="sourceLine" id="cb9-19" title="19">km2_residuals<span class="op">$</span>x3p<span class="op">$</span>surface.matrix &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb9-20" title="20"><span class="st">  </span>cmcR<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cmcR/man/preProcess_gaussFilter.html">preProcess_gaussFilter</a></span>(<span class="dt">surfaceMat =</span> km2_residuals<span class="op">$</span>x3p<span class="op">$</span>surface.matrix,</a>
<a class="sourceLine" id="cb9-21" title="21">                               <span class="dt">res =</span> km2_residuals<span class="op">$</span>x3p<span class="op">$</span>header.info<span class="op">$</span>incrementY,</a>
<a class="sourceLine" id="cb9-22" title="22">                               <span class="dt">wavelength =</span> <span class="dv">16</span>,</a>
<a class="sourceLine" id="cb9-23" title="23">                               <span class="dt">filtertype =</span> <span class="st">"lp"</span>)</a>
<a class="sourceLine" id="cb9-24" title="24"></a>
<a class="sourceLine" id="cb9-25" title="25">unknown1_residuals<span class="op">$</span>x3p<span class="op">$</span>surface.matrix &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb9-26" title="26"><span class="st">  </span>cmcR<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cmcR/man/preProcess_gaussFilter.html">preProcess_gaussFilter</a></span>(<span class="dt">surfaceMat =</span> unknown1_residuals<span class="op">$</span>x3p<span class="op">$</span>surface.matrix,</a>
<a class="sourceLine" id="cb9-27" title="27">                               <span class="dt">res =</span> unknown1_residuals<span class="op">$</span>x3p<span class="op">$</span>header.info<span class="op">$</span>incrementY,</a>
<a class="sourceLine" id="cb9-28" title="28">                               <span class="dt">wavelength =</span> <span class="dv">16</span>,</a>
<a class="sourceLine" id="cb9-29" title="29">                               <span class="dt">filtertype =</span> <span class="st">"lp"</span>)</a>
<a class="sourceLine" id="cb9-30" title="30"></a>
<a class="sourceLine" id="cb9-31" title="31">unknown2_residuals<span class="op">$</span>x3p<span class="op">$</span>surface.matrix &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb9-32" title="32"><span class="st">  </span>cmcR<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cmcR/man/preProcess_gaussFilter.html">preProcess_gaussFilter</a></span>(<span class="dt">surfaceMat =</span> unknown2_residuals<span class="op">$</span>x3p<span class="op">$</span>surface.matrix,</a>
<a class="sourceLine" id="cb9-33" title="33">                               <span class="dt">res =</span> unknown2_residuals<span class="op">$</span>x3p<span class="op">$</span>header.info<span class="op">$</span>incrementY,</a>
<a class="sourceLine" id="cb9-34" title="34">                               <span class="dt">wavelength =</span> <span class="dv">16</span>,</a>
<a class="sourceLine" id="cb9-35" title="35">                               <span class="dt">filtertype =</span> <span class="st">"lp"</span>)</a></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="dt">mar =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb10-2" title="2"></a>
<a class="sourceLine" id="cb10-3" title="3">imager<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/imager/man/imlist.html">imlist</a></span>(</a>
<a class="sourceLine" id="cb10-4" title="4">km1_residuals<span class="op">$</span>surface.matrix <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-5" title="5"><span class="st">  </span>imager<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/imager/man/as.cimg.html">as.cimg</a></span>(),</a>
<a class="sourceLine" id="cb10-6" title="6">km2_residuals<span class="op">$</span>x3p<span class="op">$</span>surface.matrix <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-7" title="7"><span class="st">  </span>imager<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/imager/man/as.cimg.html">as.cimg</a></span>(),</a>
<a class="sourceLine" id="cb10-8" title="8">unknown1_residuals<span class="op">$</span>x3p<span class="op">$</span>surface.matrix <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-9" title="9"><span class="st">  </span>imager<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/imager/man/as.cimg.html">as.cimg</a></span>(),</a>
<a class="sourceLine" id="cb10-10" title="10">unknown2_residuals<span class="op">$</span>x3p<span class="op">$</span>surface.matrix <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-11" title="11"><span class="st">  </span>imager<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/imager/man/as.cimg.html">as.cimg</a></span>()</a>
<a class="sourceLine" id="cb10-12" title="12">) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-13" title="13"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>()</a></code></pre></div>
<p><img src="reproducibleExample_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
</div>
<div id="cartridge-case-cell-pair-ccf-calculation" class="section level2">
<h2 class="hasAnchor">
<a href="#cartridge-case-cell-pair-ccf-calculation" class="anchor"></a>Cartridge case cell pair CCF calculation</h2>
<p>The Congruent Matching Cells (CMC) method was developed at the National Institute of Standards and Technology (NIST) to quantify the similarity between two spent cartridge cases based on their breech face impressions (Song (2013)). The CMC method involves dividing a breechface impression scan into a grid of cells and comparing each cell in one scan to a corresponding region in the other scan. The motivation for this particular methodis that two breech face impressions tend to have regions of high similarity, e.g., where the firearm’s breech face impressed strongly into the cartridge case, and regions of low similarity, e.g., where the breech face may not have come into contact with the cartridge case. The highly similar regions may be drowned-out, in a sense, by the less similar regions if one were to calculate a similarity score considering the entirety of the two scans. By breaking up the breech face scans into a grid of cells, one can instead use the number of highly similar cells between the two scans as a more granular similarity metric.</p>
<p>The <code>cellCCF</code> and <code>cellCCF_bothDirections</code> functions perform the splitting of two surface matrices into a grid of cells and performing the cross-correlation calculation for a variety of rotation values. The only difference between the two functions is that <code>cellCCF_bothDirections</code> calls <code>cellCCF</code> twice where each scan in a pair plays the role of the “questioned” scan that is divided into cells. These functions simply return results of the comparison and don’t actually implement any of the CMC logic that goes into identifying “congruent matching cells.”</p>
<p>The call below will compare <code>km1_residuals</code> and <code>unknown1_residuals</code> by performing the following:</p>
<ol style="list-style-type: decimal">
<li>Divide one of the matrices into a grid of <span class="math inline">\(8 \times 8\)</span> cells</li>
<li>Determine which of these cells contains fewer than 15% of observed values (i.e., 85% or more NA values). These cells are not considered for the CCF calculation.</li>
<li>For each remaining cell: (a) rotate the other matrix (not the one divided into cells) by some theta value using a linear interpolation scheme (b) extract a region from this rotated matrix that is centered on the same index as the cell is in its matrix but is 4 times larger. (c) shift each cell/region by its respective average element value and divide by its standard deviation (d) calculate the translation, <span class="math inline">\((dx,dy)\)</span>, values by which the maximum CCF is attained between a cell/region pair (e) using these translation values, calculate the “raw” cross-correlation between the cell and the cell-sized portion of the larger region at which the max CCF was attained</li>
<li>Compile a list of data frames, one per rotation value, of CCF, dx, and dy values per cell/region pair</li>
<li>Perform steps 1-4 again, but by dividing the other matrix into a grid of cells to be compared to larger regions in the other matrix (i.e., the matrices swap roles).</li>
</ol>
<p>For now we’ll just compare km1 to the two unknown source cartridge cases. The comparisons of km2 will be discussed below.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">km1_unknown1_comparison &lt;-<span class="st"> </span><span class="kw"><a href="../reference/cellCCF_bothDirections.html">cellCCF_bothDirections</a></span>(km1_residuals,</a>
<a class="sourceLine" id="cb11-2" title="2">                                                  unknown1_residuals<span class="op">$</span>x3p,</a>
<a class="sourceLine" id="cb11-3" title="3">                                                  <span class="dt">thetas =</span> <span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="op">-</span><span class="dv">30</span>,<span class="dv">30</span>,<span class="dt">by =</span> <span class="dv">3</span>),</a>
<a class="sourceLine" id="cb11-4" title="4">                                                  <span class="dt">cellNumHoriz =</span> <span class="dv">8</span>,</a>
<a class="sourceLine" id="cb11-5" title="5">                                                  <span class="dt">cellNumVert =</span> <span class="dv">8</span>,</a>
<a class="sourceLine" id="cb11-6" title="6">                                                  <span class="dt">regionToCellProp =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb11-7" title="7">                                                  <span class="dt">minObservedProp =</span> <span class="fl">.15</span>,</a>
<a class="sourceLine" id="cb11-8" title="8">                                                  <span class="dt">centerCell =</span> <span class="st">"individualCell"</span>,</a>
<a class="sourceLine" id="cb11-9" title="9">                                                  <span class="dt">scaleCell =</span> <span class="st">"individualCell"</span>)</a>
<a class="sourceLine" id="cb11-10" title="10"></a>
<a class="sourceLine" id="cb11-11" title="11">km1_unknown2_comparison &lt;-<span class="st"> </span><span class="kw"><a href="../reference/cellCCF_bothDirections.html">cellCCF_bothDirections</a></span>(km1_residuals,</a>
<a class="sourceLine" id="cb11-12" title="12">                                                  unknown2_residuals<span class="op">$</span>x3p,</a>
<a class="sourceLine" id="cb11-13" title="13">                                                  <span class="dt">thetas =</span> <span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="op">-</span><span class="dv">30</span>,<span class="dv">30</span>,<span class="dt">by =</span> <span class="dv">3</span>),</a>
<a class="sourceLine" id="cb11-14" title="14">                                                  <span class="dt">cellNumHoriz =</span> <span class="dv">8</span>,</a>
<a class="sourceLine" id="cb11-15" title="15">                                                  <span class="dt">cellNumVert =</span> <span class="dv">8</span>,</a>
<a class="sourceLine" id="cb11-16" title="16">                                                  <span class="dt">regionToCellProp =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb11-17" title="17">                                                  <span class="dt">minObservedProp =</span> <span class="fl">.15</span>,</a>
<a class="sourceLine" id="cb11-18" title="18">                                                  <span class="dt">centerCell =</span> <span class="st">"individualCell"</span>,</a>
<a class="sourceLine" id="cb11-19" title="19">                                                  <span class="dt">scaleCell =</span> <span class="st">"individualCell"</span>)</a></code></pre></div>
<p>We can see one of these data frames below, specifically where unknown1_residuals was rotated by 21 degrees before being compared to the cells of km1_residuals. The <code>cellID</code> column corresponds to the locations of each cell in km1_residuals. The <code>cellNum</code> column indexes the cells starting in the top left corner of the matrix moving right. The fact that this <code>cellNum == 1</code> is missing from this data frame means that the top left corner of the matrix contains too few observed (less than 15%) observed values to be considered for the CCF calculation. The <code>ccf</code>, <code>dx</code>, and <code>dy</code> columns represent the CCF<span class="math inline">\(_{\max}\)</span> value for a particular cell/region pair as well as the associated translation values at which this CCF value occurred. The values in the <code>ccf</code> column were calculated by replacing missing values (of which there are often many) with the average value in the cells/regions (which is necessary for calculating the CCF using the Cross-Correlation Theorem). The <code>rawCorr</code> column, on the other hand, contains correlation values calculated by effectively ignoring any NA-valued elements (specifically, using the <code>cor</code> function with <code>use = "pairwise.complete.obs"</code>).</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">km1_unknown1_comparison<span class="op">$</span>comparison_1to2<span class="op">$</span>ccfResults<span class="op">$</span><span class="st">`</span><span class="dt">21</span><span class="st">`</span></a></code></pre></div>
<div id="htmlwidget-27f2cb7bacf3bfd4dc1e" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-27f2cb7bacf3bfd4dc1e">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36"],[2,3,4,5,6,9,10,14,15,17,18,23,24,25,31,32,33,34,39,40,41,42,43,46,47,48,50,51,52,53,54,55,59,60,61,62],["y = 1 - 73, x = 74 - 145","y = 1 - 73, x = 146 - 217","y = 1 - 73, x = 218 - 289","y = 1 - 73, x = 290 - 361","y = 1 - 73, x = 362 - 433","y = 74 - 145, x = 1 - 73","y = 74 - 145, x = 74 - 145","y = 74 - 145, x = 362 - 433","y = 74 - 145, x = 434 - 505","y = 146 - 218, x = 1 - 73","y = 146 - 218, x = 74 - 145","y = 146 - 218, x = 434 - 505","y = 146 - 218, x = 506 - 577","y = 219 - 290, x = 1 - 73","y = 219 - 290, x = 434 - 505","y = 219 - 290, x = 506 - 577","y = 291 - 362, x = 1 - 73","y = 291 - 362, x = 74 - 145","y = 291 - 362, x = 434 - 505","y = 291 - 362, x = 506 - 577","y = 363 - 435, x = 1 - 73","y = 363 - 435, x = 74 - 145","y = 363 - 435, x = 146 - 217","y = 363 - 435, x = 362 - 433","y = 363 - 435, x = 434 - 505","y = 363 - 435, x = 506 - 577","y = 436 - 507, x = 74 - 145","y = 436 - 507, x = 146 - 217","y = 436 - 507, x = 218 - 289","y = 436 - 507, x = 290 - 361","y = 436 - 507, x = 362 - 433","y = 436 - 507, x = 434 - 505","y = 508 - 579, x = 146 - 217","y = 508 - 579, x = 218 - 289","y = 508 - 579, x = 290 - 361","y = 508 - 579, x = 362 - 433"],[0.62419465750754,0.788729974418626,0.643909696672902,0.49486684701021,0.421453899266515,0.766225786523371,0.816614310223822,0.662833325560952,0.630158525968909,0.662683405534632,0.484441135658477,0.372827954383014,0.682301758453447,0.69137763181263,-0.269856656249568,0.664630619404124,0.567585035649756,0.544308540403394,0.248743440099093,0.70165355150777,0.75500814477757,0.310874380194704,0.528588554634231,0.371410675290631,0.54812820696636,0.702710972507804,0.592842150386482,0.452771317990398,0.586933017444518,0.271928078156149,0.490150160044287,0.71928064740189,0.860315501825716,0.726010828842146,0.663595520529591,0.649006742665013],[0.229491666035914,0.530232387502976,0.523949127492013,0.270166298047283,0.209991380420476,0.235807007204428,0.526471843698466,0.207206228238627,0.339987398895601,0.296314629184866,0.166581791104671,0.095814385336168,0.370161392354981,0.330600949696919,0.174257103810095,0.320338251160154,0.210676163723411,0.296992148164984,0.0932041636701963,0.332661356031,0.363231618124949,0.167489285089742,0.194801913591385,0.120418053129013,0.219927504892667,0.306288920316288,0.283825319046374,0.201563744395839,0.206000539031857,0.128303548193265,0.224659594574182,0.355381379579523,0.445941916526352,0.429673473551952,0.419595045978395,0.326742740285311],[28,-22,33,-29,-2,-20,6,-36,32,-20,-16,35,4,-1,31,4,7,5,22,13,-28,9,32,-33,4,21,-36,-1,15,34,34,7,-27,19,-34,33],[-27,-17,-31,-3,-5,20,-25,17,22,36,24,-28,-13,23,-36,-5,35,-35,-36,-28,-36,-31,-11,14,-19,-30,-27,-9,-6,-19,-13,0,-7,4,11,-8],[21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>cellNum<\/th>\n      <th>cellID<\/th>\n      <th>ccf<\/th>\n      <th>fft.ccf<\/th>\n      <th>dx<\/th>\n      <th>dy<\/th>\n      <th>theta<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"columnDefs":[{"className":"dt-right","targets":[1,3,4,5,6,7]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>We are interested in extracting features from these CCF comparison results to differentiate matches from non-matches. In particular, we are interested only in cell/region pairs that are above a certain correlation threshold and have <code>dx</code>, <code>dy</code>, and <code>theta</code> values that are “close” to consensus-based values. We need to define what we mean be a consensus by determining some way to aggregate values together, preferably via some measure of center. It is common in the CMC literature to use the median <code>dx</code>, <code>dy</code>, and <code>theta</code> values, although the cmcR package lets you use any function you would like (although only mean, median, and mode have been tested).</p>
<p>The <code>topResultsPerCell</code> function will take the list of data frames returned by cellCCF (or cellCCF_bothDirections) and extract information about the <code>dx</code>, <code>dy</code>, and <code>theta</code> values at which each cell pair attained its maximum CCF value across the entire comparison (i.e., across every rotation). If we think of the CMC method as allowing cell pairs to “vote” for a translation and rotation of one cartridge case scan to align well with another, then the resulting data frame from <code>topResultsPerCell</code> is the number one choice per cell pair.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1">km1_unknown1_comparison<span class="op">$</span>comparison_1to2<span class="op">$</span>ccfResults <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-2" title="2"><span class="st">  </span><span class="kw"><a href="../reference/topResultsPerCell.html">topResultsPerCell</a></span>()</a></code></pre></div>
<div id="htmlwidget-29aff4de653108186e9f" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-29aff4de653108186e9f">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36"],[3,4,5,6,2,17,23,24,18,25,31,32,33,39,40,34,41,43,46,47,48,42,51,52,53,54,55,50,59,60,61,62,9,14,15,10],["y = 1 - 73, x = 146 - 217","y = 1 - 73, x = 218 - 289","y = 1 - 73, x = 290 - 361","y = 1 - 73, x = 362 - 433","y = 1 - 73, x = 74 - 145","y = 146 - 218, x = 1 - 73","y = 146 - 218, x = 434 - 505","y = 146 - 218, x = 506 - 577","y = 146 - 218, x = 74 - 145","y = 219 - 290, x = 1 - 73","y = 219 - 290, x = 434 - 505","y = 219 - 290, x = 506 - 577","y = 291 - 362, x = 1 - 73","y = 291 - 362, x = 434 - 505","y = 291 - 362, x = 506 - 577","y = 291 - 362, x = 74 - 145","y = 363 - 435, x = 1 - 73","y = 363 - 435, x = 146 - 217","y = 363 - 435, x = 362 - 433","y = 363 - 435, x = 434 - 505","y = 363 - 435, x = 506 - 577","y = 363 - 435, x = 74 - 145","y = 436 - 507, x = 146 - 217","y = 436 - 507, x = 218 - 289","y = 436 - 507, x = 290 - 361","y = 436 - 507, x = 362 - 433","y = 436 - 507, x = 434 - 505","y = 436 - 507, x = 74 - 145","y = 508 - 579, x = 146 - 217","y = 508 - 579, x = 218 - 289","y = 508 - 579, x = 290 - 361","y = 508 - 579, x = 362 - 433","y = 74 - 145, x = 1 - 73","y = 74 - 145, x = 362 - 433","y = 74 - 145, x = 434 - 505","y = 74 - 145, x = 74 - 145"],[0.836776138597235,0.671339331467246,0.512096556640058,0.423577733387412,0.869164380254287,0.724249031043336,0.795709717677104,0.813055005539918,0.742491163500062,0.757981100900184,0.829902791150099,0.796684999103939,0.8007951435917,0.714500746981789,0.760396985877571,0.681209635670955,0.831676733947466,0.802005674541154,0.68088777205159,0.550995972010819,0.735114783869134,0.538286912317467,0.572804766069587,0.703299485473367,0.378440286740488,0.512393387622995,0.843465116435529,0.67731941494784,0.887049592784987,0.809389305652429,0.746601028604103,0.793592723618708,0.833478279022146,0.789361909044144,0.674789205623236,0.818192325406945],[0.569993671730558,0.349250483808253,0.138387066929885,0.241977126829176,0.264733563677483,0.323778103139733,0.244141920120601,0.47484891226121,0.30534465081329,0.412154828342076,0.269207968760846,0.352005278239662,0.372575291785327,0.216717249426346,0.409787111296299,0.299248822968994,0.418891090680537,0.344951102155285,0.263225452129688,0.193992918974251,0.319375990020237,0.300286464009213,0.192147430057791,0.142070252687732,0.117520354999664,0.254141256948226,0.397787385410086,0.317756800435784,0.476291097964611,0.40887288062373,0.34807109030953,0.340921262653046,0.246747631657055,0.333654981363393,0.358804290672468,0.502053569004372],[-2,34,-9,-22,18,-7,35,14,-9,3,28,5,-8,26,2,4,-26,20,6,9,10,15,-17,35,11,14,20,-24,-3,-7,25,8,19,32,3,12],[-27,-22,13,-15,-17,14,-8,13,-21,-19,35,16,-36,-36,34,-32,-36,-9,-13,-11,-3,-33,23,24,-9,-6,-10,-21,0,5,4,3,-35,-14,-3,-32],[27,0,-18,12,-6,27,9,-3,-3,-15,-3,-27,-18,-9,-30,30,-12,-6,-30,-15,-9,-27,-30,12,12,27,-12,-9,15,-30,-30,-21,15,-24,12,24]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>cellNum<\/th>\n      <th>cellID<\/th>\n      <th>ccf<\/th>\n      <th>fft.ccf<\/th>\n      <th>dx<\/th>\n      <th>dy<\/th>\n      <th>theta<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"columnDefs":[{"className":"dt-right","targets":[1,3,4,5,6,7]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="congruent-matching-cells-filtering-logic" class="section level2">
<h2 class="hasAnchor">
<a href="#congruent-matching-cells-filtering-logic" class="anchor"></a>Congruent Matching Cells Filtering Logic</h2>
<div id="initially-proposed-method" class="section level3">
<h3 class="hasAnchor">
<a href="#initially-proposed-method" class="anchor"></a>Initially proposed method</h3>
<p>Song (2013) initially proposed using this data frame to determine CMCs. In particular, we can take the <code>dx</code>, <code>dy</code>, and <code>theta</code> columns, determine some consensus value among each (by, e.g, taking the median), and then determine how close each cell pair’s votes are to that consensus. For true matches, we would expect at least a majority of cells to have votes in the same ballpark. Thus, we can specify thresholds, <code>dx_thresh</code>, <code>dy_thresh</code>, and <code>theta_thresh</code> within which we will say that a cell pair’s vote is “close” to the consensual value. We also only want to consider pairs that achieve some minimum correlation threshold. The<code>ccf_thresh</code> argument sets this threshold.</p>
<p>Below we can see the CMCs selected using the top results between km1 and unknown1. We’ll refer to these as the “initial CMCs” since they were determined under the initially proposed CMC method by Song. There aren’t very many initial CMCs between km1 and unknown1.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1">km1_unknown1_comparison<span class="op">$</span>comparison_1to2<span class="op">$</span>ccfResults <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-2" title="2"><span class="st">  </span><span class="kw"><a href="../reference/topResultsPerCell.html">topResultsPerCell</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-3" title="3"><span class="st">  </span><span class="kw"><a href="../reference/cmcFilter.html">cmcFilter</a></span>(<span class="dt">ccf_thresh =</span> <span class="fl">.8</span>,</a>
<a class="sourceLine" id="cb14-4" title="4">            <span class="dt">dx_thresh =</span> <span class="dv">15</span>)</a></code></pre></div>
<div id="htmlwidget-068b3f0d3bdb4613869d" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-068b3f0d3bdb4613869d">{"x":{"filter":"none","data":[["1","2"],[2,43],["y = 1 - 73, x = 74 - 145","y = 363 - 435, x = 146 - 217"],[0.869164380254287,0.802005674541154],[0.264733563677483,0.344951102155285],[18,20],[-17,-9],[-6,-6]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>cellNum<\/th>\n      <th>cellID<\/th>\n      <th>ccf<\/th>\n      <th>fft.ccf<\/th>\n      <th>dx<\/th>\n      <th>dy<\/th>\n      <th>theta<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,3,4,5,6,7]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p>In contrast, there are more initial CMCs between km1 and unknown2. This indicates a greater level of similarity between km1 and unknown2.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1">km1_unknown2_comparison<span class="op">$</span>comparison_1to2<span class="op">$</span>ccfResults <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-2" title="2"><span class="st">  </span><span class="kw"><a href="../reference/topResultsPerCell.html">topResultsPerCell</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-3" title="3"><span class="st">  </span><span class="kw"><a href="../reference/cmcFilter.html">cmcFilter</a></span>(<span class="dt">ccf_thresh =</span> <span class="fl">.8</span>,</a>
<a class="sourceLine" id="cb15-4" title="4">            <span class="dt">dx_thresh =</span> <span class="dv">15</span>)</a></code></pre></div>
<div id="htmlwidget-8596c99344681f9bbd8f" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-8596c99344681f9bbd8f">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22"],[3,5,6,17,23,24,18,25,32,33,34,41,46,42,52,53,55,50,61,62,15,10],["y = 1 - 73, x = 146 - 217","y = 1 - 73, x = 290 - 361","y = 1 - 73, x = 362 - 433","y = 146 - 218, x = 1 - 73","y = 146 - 218, x = 434 - 505","y = 146 - 218, x = 506 - 577","y = 146 - 218, x = 74 - 145","y = 219 - 290, x = 1 - 73","y = 219 - 290, x = 506 - 577","y = 291 - 362, x = 1 - 73","y = 291 - 362, x = 74 - 145","y = 363 - 435, x = 1 - 73","y = 363 - 435, x = 362 - 433","y = 363 - 435, x = 74 - 145","y = 436 - 507, x = 218 - 289","y = 436 - 507, x = 290 - 361","y = 436 - 507, x = 434 - 505","y = 436 - 507, x = 74 - 145","y = 508 - 579, x = 290 - 361","y = 508 - 579, x = 362 - 433","y = 74 - 145, x = 434 - 505","y = 74 - 145, x = 74 - 145"],[0.919695208133283,0.872927146354342,0.831006476152352,0.939982466828974,0.937021838989156,0.871977073208607,0.945372019486634,0.934926173053475,0.800807205758815,0.967037699672796,0.857630982542721,0.962321936864752,0.865557729304148,0.95097356623024,0.872767082963815,0.878013620090208,0.871564713750204,0.933776240643433,0.804882283600781,0.84790793734294,0.81011540368149,0.954129971107575],[0.460436097120544,0.483656544335775,0.333848705400959,0.40844727254048,0.417848154448345,0.418365751413414,0.419932857818187,0.52171397168144,0.309289285477691,0.426190552387605,0.362122416248018,0.563415350476249,0.254131851560183,0.496873449323156,0.336310689714681,0.498380756242892,0.456878688277979,0.34898502842747,0.420981731999257,0.40218192908435,0.337435498994446,0.566023048194283],[3,-1,11,-6,0,-1,2,0,1,0,-1,-3,2,2,9,0,12,5,8,1,9,-1],[-4,1,4,9,-3,-6,-7,7,9,-5,-11,-1,-1,-5,-2,-3,-11,6,1,0,6,-2],[-18,-18,-15,-21,-18,-18,-18,-21,-15,-18,-18,-18,-18,-18,-21,-18,-21,-21,-21,-18,-15,-18]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>cellNum<\/th>\n      <th>cellID<\/th>\n      <th>ccf<\/th>\n      <th>fft.ccf<\/th>\n      <th>dx<\/th>\n      <th>dy<\/th>\n      <th>theta<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"columnDefs":[{"className":"dt-right","targets":[1,3,4,5,6,7]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="improved-method" class="section level3">
<h3 class="hasAnchor">
<a href="#improved-method" class="anchor"></a>“Improved” method</h3>
<p>Having chosen correlation and translation thresholds by which we can classify cell pairs as “congruent matching cells,” a useful way to determine an estimate for the rotation values by which two cartridge cases will align is to plot the number of CMCs per rotation value. Identifying “modes” in these CMC-per-theta plots is what Tong et al. (2015) proposed as one improvement to the initially proposed method.</p>
<p>The plots below show the “forward” and “backward” distribution of CMCs per theta value for the comparisons between km1 and unknown1 as well as km1 and unknown2. The “forward” and “backward” directions correspond to the which of the two scans in the comparison was partitioned into a grid of cells (think of this as the “questioned” cartridge case) and which was broken up into overlapping regions. For example, in the plot immediately below, the “x3p1 vs. x3p2” facet means that km1 was partitioned into a grid of cells, each of which were compared to larger regions in unknown1.</p>
<p>Tong et al. (2015) propose using these CMC-per-theta distributions to identify which theta values have a “high” number of associated CMCs. They define a “high” number of CMCs to be the maximum number of CMCs for a particular comparison minus some empirical constant (1 in their paper). If a theta value has an associated high number of CMCs, but is far away from the theta value with the maximum number of CMCs, then there’s evidence to suggest that the pair is a non-match. The plot immediately below illustrates this idea. In both bar plots, the maximum number of CMCs is 2 (at <span class="math inline">\(\theta = -9\)</span> in the first plot and <span class="math inline">\(\theta = 3\)</span> in the second). However, a number of other theta values have high CMC numbers (1 in this example) that are far away from the max CMC theta values. We define “far away” as being greater than <code>theta_thresh</code> degrees away from the max CMC theta value.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1"><span class="kw"><a href="../reference/cmcPerThetaBarPlot.html">cmcPerThetaBarPlot</a></span>(km1_unknown1_comparison,</a>
<a class="sourceLine" id="cb16-2" title="2">                   <span class="dt">ccf_thresh =</span> <span class="fl">.8</span>,</a>
<a class="sourceLine" id="cb16-3" title="3">                   <span class="dt">dx_thresh =</span> <span class="dv">15</span>,</a>
<a class="sourceLine" id="cb16-4" title="4">                   <span class="dt">theta_thresh =</span> <span class="dv">3</span>,</a>
<a class="sourceLine" id="cb16-5" title="5">                   <span class="dt">highCMCThresh =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="reproducibleExample_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
<p>In contrast, we can see a distinct mode in the bar plots below for the comparison between km1 and unknown2. Additionally, any theta values with associated high CMC counts are within <code>theta_thresh</code> degrees of the maximum CMC theta value. The two modes also agree with each other, up to a sign, which is what we would expect in comparing a true match pair in both directions.</p>
<p><img src="reproducibleExample_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
<p>To settle on a final CMC number, Tong et al. (2015) proposes first identifying whether the high CMC theta values are too diffuse around the max CMC theta value using the logic described above. If a particular pair doesn’t pass this criterion, then we assign to it the initial CMCs (described above) as its final CMC number. Otherwise, if a theta value mode is identified, then we count the number of CMCs in this mode, including those associated with the max CMC as well as CMCs associated with theta values within <code>theta_thresh</code> of the max CMC theta value. We do this for both the “forward” and “backward” CMC distributions and combine the results as the final CMC count, excluding any duplicate pairs.</p>
<p>The <code>cmcFilter_improved</code> function counts the number of CMCs under this improved method. It will return not only the final CMCs, but also the initial CMCs determined under the initially proposed method (in both directions).</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1">km1_unknown1_cmcs &lt;-<span class="st"> </span>cmcR<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cmcR/man/cmcFilter_improved.html">cmcFilter_improved</a></span>(km1_unknown1_comparison,</a>
<a class="sourceLine" id="cb17-2" title="2">                                              <span class="dt">consensus_function =</span> median,</a>
<a class="sourceLine" id="cb17-3" title="3">                                              <span class="dt">ccf_thresh =</span> <span class="fl">.8</span>,</a>
<a class="sourceLine" id="cb17-4" title="4">                                              <span class="dt">dx_thresh =</span> <span class="dv">15</span>,</a>
<a class="sourceLine" id="cb17-5" title="5">                                              <span class="dt">theta_thresh =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb17-6" title="6"></a>
<a class="sourceLine" id="cb17-7" title="7">km1_unknown2_cmcs &lt;-<span class="st"> </span>cmcR<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cmcR/man/cmcFilter_improved.html">cmcFilter_improved</a></span>(km1_unknown2_comparison,</a>
<a class="sourceLine" id="cb17-8" title="8">                                              <span class="dt">consensus_function =</span> median,</a>
<a class="sourceLine" id="cb17-9" title="9">                                              <span class="dt">ccf_thresh =</span> <span class="fl">.8</span>,</a>
<a class="sourceLine" id="cb17-10" title="10">                                              <span class="dt">dx_thresh =</span> <span class="dv">15</span>,</a>
<a class="sourceLine" id="cb17-11" title="11">                                              <span class="dt">theta_thresh =</span> <span class="dv">3</span>)</a></code></pre></div>
<p>The improved CMC method did not yield any “final CMCs” for the comparison between km1 and unknown1. As such, we would assign the pair whichever was the minimum number of initial CMCs calculated between both directions. The CMC(s) between km1 and unknown1 are shown below.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1">km1_unknown1_cmcs<span class="op">$</span>initialCMCs[[<span class="dv">1</span>]][[<span class="kw"><a href="https://rdrr.io/r/base/which.min.html">which.min</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(km1_unknown1_cmcs<span class="op">$</span>initialCMCs[[<span class="dv">1</span>]][[<span class="dv">1</span>]]),</a>
<a class="sourceLine" id="cb18-2" title="2">                                                <span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(km1_unknown1_cmcs<span class="op">$</span>initialCMCs[[<span class="dv">1</span>]][[<span class="dv">2</span>]])))]]</a></code></pre></div>
<div id="htmlwidget-c93231d715ad99ff1e50" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-c93231d715ad99ff1e50">{"x":{"filter":"none","data":[["1"],[60],["y = 506 - 577, x = 216 - 287"],[0.806448333071594],[0.524442617528531],[1],[-4],[12]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>cellNum<\/th>\n      <th>cellID<\/th>\n      <th>ccf<\/th>\n      <th>fft.ccf<\/th>\n      <th>dx<\/th>\n      <th>dy<\/th>\n      <th>theta<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,3,4,5,6,7]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p>In contrast, the comparison between km1 and unknown2 did yield final CMCs, which are shown below.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1">km1_unknown2_cmcs<span class="op">$</span>finalCMCs</a></code></pre></div>
<div id="htmlwidget-3bf4c3f24be4f7b5be7c" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-3bf4c3f24be4f7b5be7c">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31"],[17,52,55,3,5,10,18,24,33,34,42,53,59,62,6,32,31,50,60,4,14,15,23,25,39,41,46,51,54,48,61],["y = 146 - 218, x = 1 - 73","y = 436 - 507, x = 218 - 289","y = 436 - 507, x = 434 - 505","y = 1 - 73, x = 146 - 217","y = 1 - 73, x = 290 - 361","y = 74 - 145, x = 74 - 145","y = 146 - 218, x = 74 - 145","y = 146 - 218, x = 506 - 577","y = 291 - 362, x = 1 - 73","y = 291 - 362, x = 74 - 145","y = 363 - 435, x = 74 - 145","y = 436 - 507, x = 290 - 361","y = 508 - 579, x = 146 - 217","y = 508 - 579, x = 362 - 433","y = 1 - 73, x = 362 - 433","y = 219 - 290, x = 506 - 577","y = 218 - 289, x = 433 - 504","y = 435 - 506, x = 73 - 144","y = 507 - 578, x = 217 - 288","y = 1 - 73, x = 217 - 288","y = 74 - 145, x = 361 - 432","y = 74 - 145, x = 433 - 504","y = 146 - 217, x = 433 - 504","y = 218 - 289, x = 1 - 72","y = 290 - 362, x = 433 - 504","y = 363 - 434, x = 1 - 72","y = 363 - 434, x = 361 - 432","y = 435 - 506, x = 145 - 216","y = 435 - 506, x = 361 - 432","y = 363 - 434, x = 505 - 576","y = 507 - 578, x = 289 - 360"],[0.939982466828974,0.872767082963815,0.871564713750204,0.919695208133283,0.872927146354342,0.954129971107575,0.945372019486634,0.871977073208607,0.967037699672796,0.857630982542721,0.95097356623024,0.878013620090208,0.931552177178051,0.84790793734294,0.831006476152352,0.800807205758815,0.812301023403736,0.970249814242324,0.93713576465971,0.857116696432688,0.934012930677528,0.875000746293509,0.947164914349292,0.962316121515918,0.818774098867345,0.965334018958359,0.891838167874942,0.958668705535097,0.800917651383942,0.814784191703529,0.918228279123573],[0.40844727254048,0.336310689714681,0.456878688277979,0.460436097120544,0.483656544335775,0.566023048194283,0.419932857818187,0.418365751413414,0.426190552387605,0.362122416248018,0.496873449323156,0.498380756242892,0.547181514200022,0.40218192908435,0.333848705400959,0.309289285477691,0.465814317978773,0.575734719953688,0.606736921136622,0.504745980462285,0.404740591716446,0.463037763969122,0.335635477380256,0.646418410084808,0.290337331676029,0.412042013350991,0.428057782118228,0.381447817916257,0.266151406988695,0.499145749076519,0.531901060307018],[-6,9,12,3,-1,-1,2,-1,0,-1,2,0,-5,1,11,1,-6,12,11,-4,2,1,-1,1,-2,2,2,1,2,4,-4],[9,-2,-11,-4,1,-2,-7,-6,-5,-11,-5,-3,0,0,4,9,11,10,1,3,4,3,4,4,0,6,0,3,4,-11,-1],[-21,-21,-21,-18,-18,-18,-18,-18,-18,-18,-18,-18,-18,-18,-15,-15,15,15,15,18,18,18,18,18,18,18,18,18,18,21,21],["comparison_1to2","comparison_1to2","comparison_1to2","comparison_1to2","comparison_1to2","comparison_1to2","comparison_1to2","comparison_1to2","comparison_1to2","comparison_1to2","comparison_1to2","comparison_1to2","comparison_1to2","comparison_1to2","comparison_1to2","comparison_1to2","comparison_2to1","comparison_2to1","comparison_2to1","comparison_2to1","comparison_2to1","comparison_2to1","comparison_2to1","comparison_2to1","comparison_2to1","comparison_2to1","comparison_2to1","comparison_2to1","comparison_2to1","comparison_2to1","comparison_2to1"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>cellNum<\/th>\n      <th>cellID<\/th>\n      <th>ccf<\/th>\n      <th>fft.ccf<\/th>\n      <th>dx<\/th>\n      <th>dy<\/th>\n      <th>theta<\/th>\n      <th>comparison<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"columnDefs":[{"className":"dt-right","targets":[1,3,4,5,6,7]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>The same type of comparisons can be done between km2 and the two unknown source scans, although we now have very strong evidence (apart from being able to read file paths) that unknown1 does not match km1 while unknown2 does.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1">km2_unknown1_comparison &lt;-<span class="st"> </span><span class="kw"><a href="../reference/cellCCF_bothDirections.html">cellCCF_bothDirections</a></span>(km2_residuals<span class="op">$</span>x3p,</a>
<a class="sourceLine" id="cb20-2" title="2">                                                  unknown1_residuals<span class="op">$</span>x3p,</a>
<a class="sourceLine" id="cb20-3" title="3">                                                  <span class="dt">thetas =</span> <span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="op">-</span><span class="dv">30</span>,<span class="dv">30</span>,<span class="dt">by =</span> <span class="dv">3</span>),</a>
<a class="sourceLine" id="cb20-4" title="4">                                                  <span class="dt">cellNumHoriz =</span> <span class="dv">8</span>,</a>
<a class="sourceLine" id="cb20-5" title="5">                                                  <span class="dt">regionToCellProp =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb20-6" title="6">                                                  <span class="dt">minObservedProp =</span> <span class="fl">.15</span>,</a>
<a class="sourceLine" id="cb20-7" title="7">                                                  <span class="dt">centerCell =</span> <span class="st">"individualCell"</span>,</a>
<a class="sourceLine" id="cb20-8" title="8">                                                  <span class="dt">scaleCell =</span> <span class="st">"individualCell"</span>)</a>
<a class="sourceLine" id="cb20-9" title="9"></a>
<a class="sourceLine" id="cb20-10" title="10">km2_unknown2_comparison &lt;-<span class="st"> </span><span class="kw"><a href="../reference/cellCCF_bothDirections.html">cellCCF_bothDirections</a></span>(km2_residuals<span class="op">$</span>x3p,</a>
<a class="sourceLine" id="cb20-11" title="11">                                                  unknown2_residuals<span class="op">$</span>x3p,</a>
<a class="sourceLine" id="cb20-12" title="12">                                                  <span class="dt">thetas =</span> <span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="op">-</span><span class="dv">30</span>,<span class="dv">30</span>,<span class="dt">by =</span> <span class="dv">3</span>),</a>
<a class="sourceLine" id="cb20-13" title="13">                                                  <span class="dt">cellNumHoriz =</span> <span class="dv">8</span>,</a>
<a class="sourceLine" id="cb20-14" title="14">                                                  <span class="dt">regionToCellProp =</span> <span class="dv">4</span>,</a>
<a class="sourceLine" id="cb20-15" title="15">                                                  <span class="dt">minObservedProp =</span> <span class="fl">.15</span>,</a>
<a class="sourceLine" id="cb20-16" title="16">                                                  <span class="dt">centerCell =</span> <span class="st">"individualCell"</span>,</a>
<a class="sourceLine" id="cb20-17" title="17">                                                  <span class="dt">scaleCell =</span> <span class="st">"individualCell"</span>)</a>
<a class="sourceLine" id="cb20-18" title="18"></a>
<a class="sourceLine" id="cb20-19" title="19">km2_unknown1_cmcs &lt;-<span class="st"> </span>cmcR<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cmcR/man/cmcFilter_improved.html">cmcFilter_improved</a></span>(km2_unknown1_comparison,</a>
<a class="sourceLine" id="cb20-20" title="20">                                              <span class="dt">consensus_function =</span> median,</a>
<a class="sourceLine" id="cb20-21" title="21">                                              <span class="dt">ccf_thresh =</span> <span class="fl">.8</span>,</a>
<a class="sourceLine" id="cb20-22" title="22">                                              <span class="dt">dx_thresh =</span> <span class="dv">15</span>)</a>
<a class="sourceLine" id="cb20-23" title="23"></a>
<a class="sourceLine" id="cb20-24" title="24">km2_unknown2_cmcs &lt;-<span class="st"> </span>cmcR<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cmcR/man/cmcFilter_improved.html">cmcFilter_improved</a></span>(km2_unknown2_comparison,</a>
<a class="sourceLine" id="cb20-25" title="25">                                              <span class="dt">consensus_function =</span> median,</a>
<a class="sourceLine" id="cb20-26" title="26">                                              <span class="dt">ccf_thresh =</span> <span class="fl">.8</span>,</a>
<a class="sourceLine" id="cb20-27" title="27">                                              <span class="dt">dx_thresh =</span> <span class="dv">15</span>)</a></code></pre></div>
<p>Interestingly, we see that the comparison between km2 and unknown1 <em>does</em> actually yield final CMCs, although only 5. This illustates an important property of this method - its extreme sensitivity to making the “correct” pre, inter, and post-processing decisions. For example, changing <code>ccf_thresh</code> from .8 to .81 in the call to <code>cmcFilter_improved</code> between km1 and unknown1 above yields 0 initial and final CMCs.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1">km2_unknown1_cmcs<span class="op">$</span>finalCMCs</a></code></pre></div>
<div id="htmlwidget-8bc73e2ef5884f9f54a8" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-8bc73e2ef5884f9f54a8">{"x":{"filter":"none","data":[["1","2","3","4","5"],[31,24,61,62,23],["y = 220 - 292, x = 439 - 511","y = 147 - 219, x = 512 - 583","y = 512 - 583, x = 293 - 365","y = 512 - 583, x = 366 - 438","y = 147 - 219, x = 439 - 511"],[0.847289862108546,0.817962468334628,0.924128893170707,0.801679670631114,0.894732574227554],[0.521515689510951,0.387159041975348,0.479526090555481,0.321659970364797,0.549357186871879],[-4,11,6,14,1],[-8,-2,8,6,-16],[-18,-15,-15,-15,-12],["comparison_1to2","comparison_1to2","comparison_1to2","comparison_1to2","comparison_1to2"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>cellNum<\/th>\n      <th>cellID<\/th>\n      <th>ccf<\/th>\n      <th>fft.ccf<\/th>\n      <th>dx<\/th>\n      <th>dy<\/th>\n      <th>theta<\/th>\n      <th>comparison<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,3,4,5,6,7]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p>The final CMCs for the comparison between km2 and unknown2 are given below.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" title="1">km2_unknown2_cmcs<span class="op">$</span>finalCMCs</a></code></pre></div>
<div id="htmlwidget-e84e359c934dc1fcee4b" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-e84e359c934dc1fcee4b">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24"],[15,50,52,61,4,5,17,47,53,54,23,60,24,31,32,33,40,41,42,46,51,10,14,25],["y = 74 - 146, x = 439 - 511","y = 439 - 511, x = 74 - 146","y = 439 - 511, x = 220 - 292","y = 512 - 583, x = 293 - 365","y = 1 - 73, x = 220 - 292","y = 1 - 73, x = 293 - 365","y = 147 - 219, x = 1 - 73","y = 366 - 438, x = 439 - 511","y = 439 - 511, x = 293 - 365","y = 439 - 511, x = 366 - 438","y = 147 - 219, x = 439 - 511","y = 507 - 578, x = 217 - 288","y = 146 - 217, x = 505 - 576","y = 218 - 289, x = 433 - 504","y = 218 - 289, x = 505 - 576","y = 290 - 362, x = 1 - 72","y = 290 - 362, x = 505 - 576","y = 363 - 434, x = 1 - 72","y = 363 - 434, x = 73 - 144","y = 363 - 434, x = 361 - 432","y = 435 - 506, x = 145 - 216","y = 74 - 145, x = 73 - 144","y = 74 - 145, x = 361 - 432","y = 218 - 289, x = 1 - 72"],[0.84874992913548,0.87207885518384,0.837247595919014,0.868498375208422,0.898245055129219,0.858542925295717,0.943640293970768,0.815731939422026,0.866368641137721,0.802364059979629,0.886785507764456,0.835140697504622,0.86411939633541,0.95118967781251,0.84751759679924,0.914952814313408,0.813903156454133,0.944031923983816,0.949597448863246,0.894542127229414,0.939763939914773,0.907069827006724,0.941001478314204,0.951656561918881],[0.368399131580471,0.546060728583008,0.209417581890664,0.557787290099799,0.513466770339425,0.498745744972701,0.588252874240492,0.272613878961395,0.318775759335341,0.257468217315614,0.544916013353233,0.526264593067557,0.368791661878583,0.664393555487825,0.310868531490407,0.437902833844488,0.343085686205995,0.39665375691693,0.335367234926828,0.463365111288317,0.345967308566645,0.570630096356479,0.585126409539466,0.662109345423502],[-5,5,9,7,8,5,3,0,-2,-2,7,17,-5,-7,-6,-4,-8,1,-3,1,-1,2,0,-3],[-14,3,-10,0,-15,-14,-13,-7,-12,-10,-18,1,9,13,6,16,6,15,14,11,13,4,15,6],[3,3,3,3,6,6,6,6,6,6,9,-9,-6,-6,-6,-6,-6,-6,-6,-6,-6,-3,-3,-3],["comparison_1to2","comparison_1to2","comparison_1to2","comparison_1to2","comparison_1to2","comparison_1to2","comparison_1to2","comparison_1to2","comparison_1to2","comparison_1to2","comparison_1to2","comparison_2to1","comparison_2to1","comparison_2to1","comparison_2to1","comparison_2to1","comparison_2to1","comparison_2to1","comparison_2to1","comparison_2to1","comparison_2to1","comparison_2to1","comparison_2to1","comparison_2to1"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>cellNum<\/th>\n      <th>cellID<\/th>\n      <th>ccf<\/th>\n      <th>fft.ccf<\/th>\n      <th>dx<\/th>\n      <th>dy<\/th>\n      <th>theta<\/th>\n      <th>comparison<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"columnDefs":[{"className":"dt-right","targets":[1,3,4,5,6,7]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="diagnostic-tools" class="section level2">
<h2 class="hasAnchor">
<a href="#diagnostic-tools" class="anchor"></a>Diagnostic tools</h2>
<p>The <code>cmcPlot</code> function allows us to visualize the regions of a cartridge case scan that have been identified as “congruent matching.”</p>
<p>For example, the 1 initial CMC calculated between km1 and unknown1 is shown below.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" title="1">cmcR<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cmcR/man/cmcPlot.html">cmcPlot</a></span>(unknown1_residuals<span class="op">$</span>x3p,</a>
<a class="sourceLine" id="cb23-2" title="2">              <span class="dt">cmcDF =</span> km1_unknown1_cmcs<span class="op">$</span>initialCMCs[[<span class="dv">1</span>]][[<span class="dv">2</span>]])</a></code></pre></div>
<p><img src="reproducibleExample_files/figure-html/unnamed-chunk-32-1.png" width="700"></p>
<p>In contrast, the final CMCs between km1 and unknown2 are shown below.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" title="1">cmcR<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cmcR/man/cmcPlot.html">cmcPlot</a></span>(unknown2_residuals<span class="op">$</span>x3p,</a>
<a class="sourceLine" id="cb24-2" title="2">              <span class="dt">cmcDF =</span> km1_unknown2_cmcs<span class="op">$</span>finalCMCs)</a></code></pre></div>
<p><img src="reproducibleExample_files/figure-html/unnamed-chunk-33-1.png" width="700"></p>
<p>The same types of plots can be made for the comparison between km2 and the unknown source scans. Below are the final CMCs between km2 and unknown1.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" title="1">cmcR<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cmcR/man/cmcPlot.html">cmcPlot</a></span>(unknown1_residuals<span class="op">$</span>x3p,</a>
<a class="sourceLine" id="cb25-2" title="2">              <span class="dt">cmcDF =</span> km2_unknown1_cmcs<span class="op">$</span>finalCMCs)</a></code></pre></div>
<p><img src="reproducibleExample_files/figure-html/unnamed-chunk-34-1.png" width="700"></p>
<p>And the CMCs for the comparison between km2 and unknown2 are shown below.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" title="1">cmcR<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cmcR/man/cmcPlot.html">cmcPlot</a></span>(unknown2_residuals<span class="op">$</span>x3p,</a>
<a class="sourceLine" id="cb26-2" title="2">              <span class="dt">cmcDF =</span> km2_unknown2_cmcs<span class="op">$</span>finalCMCs)</a></code></pre></div>
<p><img src="reproducibleExample_files/figure-html/unnamed-chunk-35-1.png" width="700"></p>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<p>Song, J. (2013). Proposed “NIST Ballistics Identification System (NBIS)” Based on 3D Topogra-phy Measurements on Correlation Cells.American Firearm and Tool Mark Examiners Journal,45(2):11.</p>
<p>Tong, M., Song, J., and Chu, W. (2015). An Improved Algorithm of Congruent Matching Cells(CMC) Method for Firearm Evidence Identifications.Journal of Research of the National Institute of Standards and Technology, 120:102.</p>
<p>Fadul T., Hernandez G., Stoiloff S. and Gulati Sneh “An Empirical Study to Improve the Scientific Foundation of Forensic Firearm and Tool Mark Identification Utilizing 10 Consecutively Manufactured Slides,” 2011 NCJRS 237960</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#cartridge-case-visualization">Cartridge case visualization</a></li>
      <li><a href="#pre-processing">Pre-processing</a></li>
      <li><a href="#cartridge-case-cell-pair-ccf-calculation">Cartridge case cell pair CCF calculation</a></li>
      <li><a href="#congruent-matching-cells-filtering-logic">Congruent Matching Cells Filtering Logic</a></li>
      <li><a href="#diagnostic-tools">Diagnostic tools</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Joe Zemmels, Heike Hofmann, Susan VanderPlas.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
