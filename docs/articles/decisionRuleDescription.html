<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CMC Decision Rule Description • cmcR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="CMC Decision Rule Description">
<meta property="og:description" content="cmcR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cmcR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/cmcR_plotReproduction.html">Reproduction of Song et al. (2018) plots using the cmcR package</a>
    </li>
    <li>
      <a href="../articles/decisionRuleDescription.html">CMC Decision Rule Description</a>
    </li>
    <li>
      <a href="../articles/reproducibleExample.html">cmcR Reproducible Example</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="decisionRuleDescription_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>CMC Decision Rule Description</h1>
            
      
      
      <div class="hidden name"><code>decisionRuleDescription.Rmd</code></div>

    </div>

    
    
<p>This vignette will describe the decision rules used in the original method of <a href="https://tsapps.nist.gov/publication/get_pdf.cfm?pub_id=910868">Song (2013)</a> and the High CMC method of <a href="https://nvlpubs.nist.gov/nistpubs/jres/120/jres.120.008.pdf">Tong et al. (2015)</a>. For illustrative purposes, we will consider a comparison between a known match and known non-match pair of cartridge cases from the stuy performed by <a href="https://www.ncjrs.gov/pdffiles1/nij/grants/237960.pdf">Fadul et al. (2011)</a>. The raw cartridge case scans can be downloaded from the <a href="https://tsapps.nist.gov/NRBTD/Studies/Studies/Details/e7a8aab8-8d5a-44ac-b2be-f0de7c2ca505?nm=True&amp;mt=1&amp;m=3&amp;sp=1">National Ballistics &amp; Toolmark Research Database</a>. The scans were preprocessed using functions available in the <strong>cmcR</strong> package and are not discussed here. Refer to the <code>fadul_examples.R</code> script available on the <a href="https://github.com/CSAFE-ISU/cmcR/tree/master/data-raw"><strong>cmcR</strong> GitHub page</a> for how these scans were preprocessed. We will also not discuss how similarity features are extracted from two processed scans. Refer to the documentation of the <a href="https://csafe-isu.github.io/cmcR/reference/cellpairwiseCompCor_bothDirections.html"><code>cellpairwiseCompCor_bothDirections</code></a> function on the <strong>cmcR</strong> website for information regarding this procedure.</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">cmcR</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></pre></div>
<p>We will consider comparisons between three cartridge case scans. Fadul 1-1 and Fadul 1-2 are known matches (i.e., were fired from the same firearm) while Fadul 2-1 is a non-match. The comparisons considered are Fadul 1-1 vs. Fadul 1-2 and Fadul 1-1 vs. Fadul 2-1.</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"fadul1.1_processed"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"fadul1.2_processed"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"fadul2.1_processed"</span><span class="op">)</span></pre></div>
<p>The three processed cartridge cases are shown below.</p>
<p>To illustrate the assumptions underlying the CMC method, compare the results of the cell-based comparison procedure for the comparison between the known match pair Fadul 1-1 and Fadul 1-2 and the known non-match pair Fadul 1-1 and Fadul 2-1.  shows the distributions of the <span class="math inline">\(\{(x_i, y_i)\}_{i = 1,...,n}\)</span> values which produce the highest pairwiseCompCor for the alignment of each cell/region pair. The squares in  are centered on the comparisons’ respective <span class="math inline">\((x_{\text{ref}},y_{\text{ref}})\)</span> values and represent the maximum distance an <span class="math inline">\((x_i,y_i)\)</span> estimated translation value can be from <span class="math inline">\((x_{\text{ref}},y_{\text{ref}})\)</span> to be classified as “congruent” based on thresholds <span class="math inline">\(T_{x} = T_{y} = 20\)</span> pixels. Of the 29 cell/region pairs considered in the known match comparison between Fadul 1-1 and Fadul 1-2, 19 <span class="math inline">\((x_i,y_i)\)</span> values are within 20 pixels of <span class="math inline">\((x_{\text{ref}},y_{\text{ref}})\)</span>. In contrast, 3 out of 35 <span class="math inline">\((x_i,y_i)\)</span> are within 20 pixels of <span class="math inline">\((x_{\text{ref}},y_{\text{ref}})\)</span> for the known non-match comparison between Fadul 1-1 and Fadul 2-1. These plots exhibit similar behavior to Figures 1 and 2 in  which show the estimated translation values for various rotation values for the same cartridge case pairs. <!-- \svp{XXX I think some points are missing in the KM plot at least - how many points were excluded for not having enough area? I count 39 points (27 inside, I'm taking your word on that).} --></p>
<p>Turning our attention to the estimated rotation values,  shows the distribution of the <span class="math inline">\(\theta_i\)</span> values which produce the highest pairwiseCompCor for the comparisons of Fadul 1-1 vs. Fadul 1-2 and Fadul 1-1 vs. Fadul 2-1. A vertical line is drawn at the comparisons’ respective <span class="math inline">\(\theta_{\text{ref}}\)</span> value and a threshold of <span class="math inline">\(T_{\theta} = 6\)</span> degrees is used to classify <span class="math inline">\(\theta_i\)</span> values as “congruent.” 25 of 29 known match and 2 of 34 known non-match <span class="math inline">\(\theta_i\)</span> values are classified as congruent under these conditions.</p>
<p><img src="decisionRuleDescription_files/figure-html/unnamed-chunk-9-1.png" width="672" style="display: block; margin: auto;"></p>
<p><img src="decisionRuleDescription_files/figure-html/unnamed-chunk-13-1.png" width="672" style="display: block; margin: auto;"></p>
<p><img src="decisionRuleDescription_files/figure-html/unnamed-chunk-17-1.png" width="672" style="display: block; margin: auto;"></p>
<p>An analogy is useful for understanding the difference between the decision rules of the original method of  and the High CMC method. Consider the decision rules as a voting system by which each cell in the reference scan votes for what it considers to be the true registration phase (translations and rotation) of the overall scans. The “votes” of each cell are ranked based on the associated pairwiseCompCor<span class="math inline">\(_{\max}\)</span> value. The original method of  might be viewed as a single-choice voting system similar to the system used in U.S. presidential elections. That is, every cell is allowed to submit one vote corresponding to the registration phase with the highest pairwiseCompCor<span class="math inline">\(_{\max}\)</span> value. Some of these votes are discarded if the associated pairwiseCompCor<span class="math inline">\(_{\max}\)</span> are below the <span class="math inline">\(T_{\text{pairwiseCompCor}}\)</span> threshold. A consensus is determined by counting the number of votes that are close to the reference values <span class="math inline">\(x_{\text{ref}}, y_{\text{ref}}, \theta_{\text{ref}}\)</span> (which is yadically defined based on the <span class="math inline">\(T_x,T_y,T_{\theta}\)</span> thresholds). By considering only the “top vote” of each cell, information is lost regarding other registration phases for which a cell might also rank highly. As  observe:</p>
<blockquote>
<p>some of the valid cell pairs may be mistakenly excluded from the CMC count because by chance their correlation yields a higher pairwiseCompCor value at a rotation angle outside the threshold range <span class="math inline">\(T_\theta\)</span>.</p>
</blockquote>
<p>The High CMC method lifts the single-choice restriction by allowing cells to cast a vote for the translation phase at every <span class="math inline">\(\theta\)</span> value for which it has a sufficiently large associated pairwiseCompCor<span class="math inline">\(_{\max}\)</span> value. Under this system, each vote represents the translation phase that the cell considers to be the true translation phase of the overall scans conditional on a particular <span class="math inline">\(\theta\)</span> value. In this way, the High CMC method might be viewed as an approval voting system in which an individual may cast a vote for all of the candidates that they would like. For each <span class="math inline">\(\theta\)</span> value, the number of translation phase votes that are close to the <span class="math inline">\(\theta\)</span>-specific reference values <span class="math inline">\(x_{\text{ref},\theta}, y_{\text{ref},\theta}\)</span> are counted (now defined based only on the <span class="math inline">\(T_x,T_y\)</span> thresholds). This yields what  refer to as a “CMC-<span class="math inline">\(\theta\)</span>” distribution representing, as they consider it, the number of “congruent cells” per <span class="math inline">\(\theta\)</span> value. Thus, there may be more than one <span class="math inline">\(\theta\)</span> value for which a single cell/region pair is considered congruent. While seemingly contradictory (as there should be only one “true” <span class="math inline">\(\theta\)</span> alignment value),  justify their method by the empirical observation:</p>
<blockquote>
<p>[i]f two images are truly matching, the CMC-<span class="math inline">\(\theta\)</span> distribution of matching image pairs should have a prominent peak located near the initial phase angle <span class="math inline">\(\Theta_0\)</span>, while non-matching image pairs may have a relatively flat and random CMC-<span class="math inline">\(\theta\)</span> distribution pattern.</p>
</blockquote>
<p>The assumption underlying the High CMC method is that the number of cells classified as congruent should be larger near the true <span class="math inline">\(\theta\)</span> value (the “initial phase angle <span class="math inline">\(\Theta_0\)</span>”, as they call it) than for other <span class="math inline">\(\theta\)</span> values if the cartridge case pair is indeed a match. These phenomena are illustrated in Figures  and .  shows the CMC counts per rotation value in both directions for the known match pair Fadul 1-1 and Fadul 1-2 from . We can clearly see a CMC mode around <span class="math inline">\(\theta = -24\)</span> in one direction and <span class="math inline">\(21\)</span> in the other, which is to be expected for a known match pair. , on the other hand, shows the CMC counts for the known non-match pair Fadul 1-1 and Fadul 2-1; in this comparison, no such CMC count mode is achieved.</p>
<p>Based on this observation,  outline the following procedure for the High CMC method:</p>
<blockquote>
<p>Conduct both forward and backward correlations at each rotation and record the registration based on pairwiseCompCor<span class="math inline">\(_{\max}\)</span>, <span class="math inline">\(x\)</span>, and <span class="math inline">\(y\)</span> for each cell at each rotation. These data will be used in the next two steps separately.</p>
</blockquote>
<blockquote>
<p>At every rotation angle, each cell in the reference image finds a registration position in the compared image with a maximum pairwiseCompCor value. By selecting the registration with the maximum pairwiseCompCor value for each cell, the two CMC numbers determined by the four thresholds can be obtained based on the original algorithm []. The lower CMC number is used as the initial result.</p>
</blockquote>
<blockquote>
<p>Build CMC-<span class="math inline">\(\theta\)</span> distributions using the data generated in step 1, by counting the number of cells that have congruent positions at each individual rotation angle. Calculate the angular range of “high CMCs” using both the forward and backward CMC-<span class="math inline">\(\theta\)</span> distributions, as illustrated in Figs. 2 and 3.</p>
</blockquote>
<blockquote>
<p>If the angular range of the “high CMCs” is within the range <span class="math inline">\(T_\theta\)</span>, identify the CMCs for each rotation angle in this range and combine them to give the number of CMCs for this comparison in place of the original CMC number. In this step, if the range is narrower than <span class="math inline">\(T_\theta\)</span>, the nearby angles are included to make the range equal to <span class="math inline">\(T_\theta\)</span>; CMCs with same index in each rotation are only counted once.</p>
</blockquote>
<p> introduce an additional criterion to identify a mode in the CMC count per <span class="math inline">\(\theta\)</span> distribution. Let <span class="math inline">\(\{\text{CMC}_{\theta} : \theta \in \Theta \}\)</span> denote the CMC-<span class="math inline">\(\theta\)</span> distribution where <span class="math inline">\(\Theta\)</span> is the set of rotation values considered for the comparison. Define CMC<span class="math inline">\(_{\max} \equiv \max_{\theta} \{\text{CMC}_{\theta} : \theta \in \Theta\}\)</span>.   a “high” CMC threshold as CMC<span class="math inline">\(_{\text{high}} \equiv\)</span> CMC<span class="math inline">\(_{\max} - \tau\)</span> for some constant <span class="math inline">\(\tau\)</span> (they choose <span class="math inline">\(\tau = 1\)</span>). Now let <span class="math inline">\(\Theta_{\text{high}} \equiv \{\theta : \text{CMC}_{\theta} \geq \text{CMC}_{\text{high}}\}\)</span>. That is, <span class="math inline">\(\Theta_{\text{high}}\)</span> consists of the <span class="math inline">\(\theta\)</span> values with “high” CMC counts.  propose calculating <span class="math inline">\(R = \max_{\theta} \Theta_{\text{high}} - \min_{\theta} \Theta_{\text{high}}\)</span>. If <span class="math inline">\(R \leq T_{\theta}\)</span>, then there is evidence that a single mode exists in the CMC-<span class="math inline">\(\theta\)</span> distribution (and thus that the cartridge case pair is a match). Otherwise, no such mode exists (by their definition) and the cartridge case pair is likely not a match. The horizontal dashed lines in Figures  and  represent the CMC<span class="math inline">\(_{\text{high}}\)</span> thresholds. The <span class="math inline">\(\theta \in \Theta_{\text{high}}\)</span> are represented by blue bars. For the matching pair shown in , the range of <span class="math inline">\(\Theta_{\text{high}}\)</span> is less than the threshold <span class="math inline">\(T_{\theta} = 6\)</span> degrees, so this pair would “pass” the High CMC criterion. In contrast, the range of <span class="math inline">\(\Theta_{\text{high}}\)</span> is larger than <span class="math inline">\(T_{\theta} = 6\)</span> degrees for the non-match pair shown in . Thus, the non-match pair would “fail” the High CMC criterion.</p>
<p>The “prominent peak” empirical observation upon which the High CMC method is based does seem to hold for many known match and known non-match pairs in our experience. However, we’ve observed that the behavior of the CMC-<span class="math inline">\(\theta\)</span> distributions depend heavily on the preprocessing procedures used and thresholds set. In particular, the CMC-<span class="math inline">\(\theta\)</span> distributions for some KNM pairs exhibit the prominent peak behavior for a wide range of threshold values making them difficult to distinguish from KM pairs.</p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Joe Zemmels, Heike Hofmann, Susan VanderPlas.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
