<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>cmcFilter_improved function options • cmcR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="cmcFilter_improved function options">
<meta property="og:description" content="cmcR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cmcR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/cmcFilter_improved-function-options.html">cmcFilter_improved function options</a>
    </li>
    <li>
      <a href="../articles/cmcR_plotReproduction.html">Reproduction of Song et al. (2018) plots using the cmcR package</a>
    </li>
    <li>
      <a href="../articles/reproducibleExample.html">cmcR Reproducible Example</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>cmcFilter_improved function options</h1>
            
      
      
      <div class="hidden name"><code>cmcFilter_improved-function-options.Rmd</code></div>

    </div>

    
    
<div id="setup" class="section level1">
<h1 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h1>
<p>The <code>cmcFilter_improved</code> function implements the High CMC method as described in <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4730689/pdf/jres.120.008.pdf">Tong et al. (2015)</a>. This includes performing the CMC method as initially proposed by <a href="https://tsapps.nist.gov/publication/get_pdf.cfm?pub_id=911193">Song (2013)</a>. Due to some ambiguity in how the proposed method was actually implemented, the <code>cmcFilter_improved</code> function includes arguments that control how CMCs are assigned if a cartridge case pair satisfies certain criteria (this will be explained below). This vignette assumes that the reader is familiar with the CMC and will not discuss how CMCs are determined in great detail. Rather, this vignette will describe common, ambiguous situations that arise when performing the CMC method and available options for dealing with these situations. For more information about the initially proposed and High CMC methods, see the <a href="https://jzemmels.github.io/cmcR/articles/reproducibleExample.html#introduction-1">Reproducible Example</a> vignette that accompanies this package.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">cmcR</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">magrittr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span></pre></body></html></div>
<p>To illustrate the usage of the various options available in the <code>cmcFilter_improved</code> function, we will use cartridge case data available from the <a href="https://tsapps.nist.gov/NRBTD/Studies/Search">NIST Ballisitics and Toolmarks Research Database</a>. Note that <code>fadul1.1</code> and <code>fadul1.2</code> are a known match pair (i.e., were fired from the same firearm) while <code>fadul2.1</code> was fired from a different firearm (and is thus classified as a non-match). The following will perform the pre-processing procedures (again, described in the <a href="https://jzemmels.github.io/cmcR/articles/reproducibleExample.html#pre-processing-1">Reproducible Example</a> vignette) for these three cartridge cases.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">4132020</span>)

<span class="no">fadul1.1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/selectBFImpression_sample_x3p.html">selectBFImpression_sample_x3p</a></span>(<span class="kw">x3p_path</span> <span class="kw">=</span> <span class="st">"https://tsapps.nist.gov/NRBTD/Studies/CartridgeMeasurement/DownloadMeasurement/2d9cc51f-6f66-40a0-973a-a9292dbee36d"</span>,
                                               <span class="kw">ransacIters</span> <span class="kw">=</span> <span class="fl">300</span>,
                                               <span class="kw">ransacInlierThresh</span> <span class="kw">=</span> <span class="fl">1e-6</span>,
                                               <span class="kw">ransacFinalSelectThresh</span> <span class="kw">=</span> <span class="fl">2</span>*(<span class="fl">1e-5</span>),
                                               <span class="kw">useResiduals</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                                               <span class="kw">gaussFilterWavelength</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">16</span>,<span class="fl">500</span>),
                                               <span class="kw">gaussFilterType</span> <span class="kw">=</span> <span class="st">"bp"</span>)

<span class="no">fadul1.2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/selectBFImpression_sample_x3p.html">selectBFImpression_sample_x3p</a></span>(<span class="kw">x3p_path</span> <span class="kw">=</span> <span class="st">"https://tsapps.nist.gov/NRBTD/Studies/CartridgeMeasurement/DownloadMeasurement/cb296c98-39f5-46eb-abff-320a2f5568e8"</span>,
                                               <span class="kw">ransacIters</span> <span class="kw">=</span> <span class="fl">300</span>,
                                               <span class="kw">ransacInlierThresh</span> <span class="kw">=</span> <span class="fl">1e-6</span>,
                                               <span class="kw">ransacFinalSelectThresh</span> <span class="kw">=</span> <span class="fl">2</span>*(<span class="fl">1e-5</span>),
                                               <span class="kw">useResiduals</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                                               <span class="kw">gaussFilterWavelength</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">16</span>,<span class="fl">500</span>),
                                               <span class="kw">gaussFilterType</span> <span class="kw">=</span> <span class="st">"bp"</span>)
<span class="no">fadul2.1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/selectBFImpression_sample_x3p.html">selectBFImpression_sample_x3p</a></span>(<span class="kw">x3p_path</span> <span class="kw">=</span> <span class="st">"https://tsapps.nist.gov/NRBTD/Studies/CartridgeMeasurement/DownloadMeasurement/8ae0b86d-210a-41fd-ad75-8212f9522f96"</span>,
                                                    <span class="kw">ransacIters</span> <span class="kw">=</span> <span class="fl">300</span>,
                                                    <span class="kw">ransacInlierThresh</span> <span class="kw">=</span> <span class="fl">1e-6</span>,
                                                    <span class="kw">ransacFinalSelectThresh</span> <span class="kw">=</span> <span class="fl">2</span>*(<span class="fl">1e-5</span>),
                                                    <span class="kw">useResiduals</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
                                                    <span class="kw">gaussFilterWavelength</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">16</span>,<span class="fl">500</span>),
                                                    <span class="kw">gaussFilterType</span> <span class="kw">=</span> <span class="st">"bp"</span>)</pre></body></html></div>
<p>Next, <code>fadul1.1</code> is compared to <code>fadul1.2</code> and <code>fadul2.1</code> using the correlation cell comparison procedure outlined in <a href="https://tsapps.nist.gov/publication/get_pdf.cfm?pub_id=911193">Song (2013)</a>.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">kmComparison</span> <span class="kw">&lt;-</span> <span class="kw pkg">cmcR</span><span class="kw ns">::</span><span class="fu"><a href="../reference/cellCCF_bothDirections.html">cellCCF_bothDirections</a></span>(<span class="kw">x3p1</span> <span class="kw">=</span> <span class="no">fadul1.1</span>$<span class="no">x3p</span>,
                                             <span class="kw">x3p2</span> <span class="kw">=</span> <span class="no">fadul1.2</span>$<span class="no">x3p</span>,
                                             <span class="kw">cellNumHoriz</span> <span class="kw">=</span> <span class="fl">8</span>,
                                             <span class="kw">regionToCellProp</span> <span class="kw">=</span> <span class="fl">9</span>,
                                             <span class="kw">minObservedProp</span> <span class="kw">=</span> <span class="fl">.1</span>)

<span class="no">knmComparison</span> <span class="kw">&lt;-</span> <span class="kw pkg">cmcR</span><span class="kw ns">::</span><span class="fu"><a href="../reference/cellCCF_bothDirections.html">cellCCF_bothDirections</a></span>(<span class="kw">x3p1</span> <span class="kw">=</span> <span class="no">fadul1.1</span>$<span class="no">x3p</span>,
                                              <span class="kw">x3p2</span> <span class="kw">=</span> <span class="no">fadul2.1</span>$<span class="no">x3p</span>,
                                              <span class="kw">cellNumHoriz</span> <span class="kw">=</span> <span class="fl">8</span>,
                                              <span class="kw">regionToCellProp</span> <span class="kw">=</span> <span class="fl">9</span>,
                                              <span class="kw">minObservedProp</span> <span class="kw">=</span> <span class="fl">.1</span>)</pre></body></html></div>
<p>Finally, the High CMC method can be applied to the features extracted from the correlation cell comparison procedure. This is where the <code>cmcFilter_improved</code> function is used. The next few sections will use illustrate conventions and options in the <code>cmcFilter_improved</code> function using the features extracted from the correlation cell comparison procedure</p>
</div>
<div id="cmcfilter_improved-conventions" class="section level1">
<h1 class="hasAnchor">
<a href="#cmcfilter_improved-conventions" class="anchor"></a><code>cmcFilter_improved</code> conventions</h1>
<p>The following plots show the CMC counts per <span class="math inline">\(\theta\)</span> value considered (-30 degrees to 30 degrees with a step size of 3 degrees) under the specified CCF<span class="math inline">\(_{\max}\)</span> and translation thresholds in both directions (how these CMCs are determined is discussed in the <a href="https://jzemmels.github.io/cmcR/articles/reproducibleExample.html#congruent-matching-cells-filtering-logic-1">Reproducible Example</a> vignette). The <span class="math inline">\(\theta\)</span> value at which the CMC count attains a mode is likely the approximate rotation needed to align the two cartridge case scans. However, these examples illuminate some ambiguities in the original description of the High CMC method for how to handle certain behavior.</p>
<p>The plot below shows the CMC count per <span class="math inline">\(\theta\)</span> distributions for the matching pair of <code>fadul1.1</code> and <code>fadul1.2</code>. In the “Fadul 1-1 vs. Fadul 1-2” direction (meaning <code>fadul1.1</code> was partitioned into a grid of cells and compared to regions in <code>fadul2.1</code> rather than the other way around), we can see that a CMC count mode is attained at <span class="math inline">\(\theta = -24\)</span> degrees. Further, the only <span class="math inline">\(\theta\)</span> value with associated CMC count greater than or equal to the CMC<span class="math inline">\(_{\text{high}}\)</span> threshold (defined to be CMC<span class="math inline">\(_{\max} - \tau\)</span> for <span class="math inline">\(\tau = 1\)</span> in this example) is <span class="math inline">\(\theta = -27\)</span> degrees, which happens to be adjacent to <span class="math inline">\(\theta = -24\)</span> degrees based on the grid of <span class="math inline">\(\theta\)</span> values considered. As such, we would say that this direction “passes” the High CMC criterion. On the other hand, the “Fadul 1-2 vs. Fadul 1-1” direction yields a series of 4 <span class="math inline">\(\theta\)</span> values from <span class="math inline">\(-18\)</span> to <span class="math inline">\(27\)</span> degrees that tie for the CMC<span class="math inline">\(_{\max}\)</span> count. <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4730689/pdf/jres.120.008.pdf">Tong et al. (2015)</a> do not discuss how to handle such ties which we have observed to be fairly common when performing these comparisons. In the  package, the median of such consecutive <span class="math inline">\(\theta\)</span> values is used as the (un)official mode for the direction. Thus, <span class="math inline">\(\theta = 22.5\)</span> degrees would be used as the <span class="math inline">\(\theta\)</span> mode value in this example. This seems to agree with <span class="math inline">\(\theta = -24\)</span> identified as the mode in the other direction (within an allowable threshold). However, an obvious question is: “how many consecutive <span class="math inline">\(\theta\)</span> values is too many?” Additionally, <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4730689/pdf/jres.120.008.pdf">Tong et al. (2015)</a> don’t say what to do if both directions pass the High CMC criterion (as they do in this example), but the <span class="math inline">\(\theta\)</span> modes identified disagree with each other (e.g., the mode occurs at <span class="math inline">\(\theta = -24\)</span> degrees in one direction but <span class="math inline">\(\theta = 12\)</span> degrees in the other). The <code>cmcFilter_improved</code> function contains internal logic that determines whether the modal <span class="math inline">\(\theta\)</span> values agree with each other (are within <code>theta_thresh</code> of each other, up to a sign).</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="../reference/cmcPerThetaBarPlot.html">cmcPerThetaBarPlot</a></span>(<span class="no">kmComparison</span>,
                   <span class="kw">ccf_thresh</span> <span class="kw">=</span> <span class="fl">.5</span>,
                   <span class="kw">dx_thresh</span> <span class="kw">=</span> <span class="fl">25</span>,
                   <span class="kw">highCMCThresh</span> <span class="kw">=</span> <span class="fl">1</span>,
                   <span class="kw">x3pNames</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Fadul 1-1"</span>,<span class="st">"Fadul 1-2"</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">NA</span>,<span class="fl">40</span>))</pre></body></html></div>
<p><img src="cmcFilter_improved-function-options_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>Since both directions pass the High CMC criterion, all CMCs in and within <code>theta_thresh</code> of the CMC modes identified (which, again, are <span class="math inline">\(-24\)</span> and <span class="math inline">\(22.5\)</span> degrees) will be tallied for the “official” High CMC count (excluding replicates). Using a <code>theta_thresh = 3</code>, we can see based on the plot below that 42 out of 43 total cells were declared CMCs.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">kmCMC</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/cmcFilter_improved.html">cmcFilter_improved</a></span>(<span class="kw">cellCCF_bothDirections_output</span> <span class="kw">=</span> <span class="no">kmComparison</span>,
                            <span class="kw">ccf_thresh</span> <span class="kw">=</span> <span class="fl">.5</span>,
                            <span class="kw">dx_thresh</span> <span class="kw">=</span> <span class="fl">25</span>,
                            <span class="kw">theta_thresh</span> <span class="kw">=</span> <span class="fl">3</span>)

<span class="no">kmCMC_plt</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/cmcPlot.html">cmcPlot</a></span>(<span class="kw">x3p1</span> <span class="kw">=</span> <span class="no">fadul1.1</span>$<span class="no">x3p</span>,
                     <span class="kw">x3p2</span> <span class="kw">=</span> <span class="no">fadul1.2</span>$<span class="no">x3p</span>,
                     <span class="kw">cellCCF_bothDirections_output</span> <span class="kw">=</span> <span class="no">kmComparison</span>,
                     <span class="kw">cmcFilter_improved_output</span> <span class="kw">=</span> <span class="no">kmCMC</span>,
                     <span class="kw">x3pNames</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Fadul 1-1"</span>,<span class="st">"Fadul 1-2"</span>))

<span class="no">kmCMC_plt</span>$<span class="no">highCMC</span></pre></body></html></div>
<p><img src="cmcFilter_improved-function-options_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
<div id="the-missingtheta_decision-argument" class="section level1">
<h1 class="hasAnchor">
<a href="#the-missingtheta_decision-argument" class="anchor"></a>The <code>missingTheta_decision</code> argument</h1>
<p>In contrast to the known match pair, the plots below show the CMC count per <span class="math inline">\(\theta\)</span> distributions for the non-match pair <code>fadul1.1</code> and <code>fadul2.1</code> under the same thresholds. Note that “Fadul 1-1 vs. Fadul 2-1” direction would actually pass the High CMC criterion since the only <span class="math inline">\(\theta\)</span> with associated CMC count greater than or equal to the <span class="math inline">\(CMC_{\text{high}} = 22\)</span> threshold is <span class="math inline">\(\theta = -6\)</span> degrees. Depending on how the <code>theta_thresh</code> argument is set, the “Fadul 2-1 vs. Fadul 1-1” direction may fail High CMC criterion. For example, <code>theta_thresh</code> = 3 degrees would cause the direction to fail since <span class="math inline">\(\theta = 30\)</span> degrees would be “too far” from the CMC count mode of <span class="math inline">\(\theta = 24\)</span> degrees. Now the question becomes: “what do we do if only one direction passes the High CMC criterion?” The <code>missingTheta_decision</code> argument dictates how the <code>cmcFilter_improved</code> function handles such cases.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="../reference/cmcPerThetaBarPlot.html">cmcPerThetaBarPlot</a></span>(<span class="no">knmComparison</span>,
                   <span class="kw">ccf_thresh</span> <span class="kw">=</span> <span class="fl">.5</span>,
                   <span class="kw">dx_thresh</span> <span class="kw">=</span> <span class="fl">25</span>,
                   <span class="kw">highCMCThresh</span> <span class="kw">=</span> <span class="fl">1</span>,
                   <span class="kw">x3pNames</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Fadul 1-1"</span>,<span class="st">"Fadul 2-1"</span>))</pre></body></html></div>
<p><img src="cmcFilter_improved-function-options_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>The <code>missingTheta_decision</code> argument can take on 3 different strings, <code>"replace"</code>, <code>"dismiss"</code>, and <code>"fail"</code>, representing 3 possible approaches to dealing with cartridge case pairs for which only direction passes the High CMC criterion. <code>missingTheta_decision = "replace"</code> is arguably the most “liberal” of the 3 options in that it replaces the missing <span class="math inline">\(\theta\)</span> in the direction that failed the High CMC criterion with the opposite of the <span class="math inline">\(\theta\)</span> value identified in the other direction and then calculates the High CMCs as if both direction had passed the criterion. In the example above, this equates to using <span class="math inline">\(\theta = 6\)</span> degrees in the “Fadul 2-1 vs. Fadul 1-1” direction. Using this argument below on the non-match pair yields 32 High CMCs - which is quite high for a truly non-match pair. These are visualized below. Of course, tuning the thresholds will change the High CMC count (for example, setting <code>ccf_thresh = .7</code> below yields 0 High CMCs).</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">knmCMC_replace</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/cmcFilter_improved.html">cmcFilter_improved</a></span>(<span class="kw">cellCCF_bothDirections_output</span> <span class="kw">=</span> <span class="no">knmComparison</span>,
                                     <span class="kw">ccf_thresh</span> <span class="kw">=</span> <span class="fl">.5</span>,
                                     <span class="kw">dx_thresh</span> <span class="kw">=</span> <span class="fl">25</span>,
                                     <span class="kw">theta_thresh</span> <span class="kw">=</span> <span class="fl">3</span>,
                                     <span class="kw">missingTheta_decision</span> <span class="kw">=</span> <span class="st">"replace"</span>)

<span class="no">knmCMC_replace_plt</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/cmcPlot.html">cmcPlot</a></span>(<span class="kw">x3p1</span> <span class="kw">=</span> <span class="no">fadul1.1</span>$<span class="no">x3p</span>,
                              <span class="kw">x3p2</span> <span class="kw">=</span> <span class="no">fadul2.1</span>$<span class="no">x3p</span>,
                              <span class="kw">cellCCF_bothDirections_output</span> <span class="kw">=</span> <span class="no">knmComparison</span>,
                              <span class="kw">cmcFilter_improved_output</span> <span class="kw">=</span> <span class="no">knmCMC_replace</span>)

<span class="no">knmCMC_replace_plt</span>$<span class="no">highCMC</span></pre></body></html></div>
<p><img src="cmcFilter_improved-function-options_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>A slightly more “conservative” option would be to only count the High CMCs in the direction that passed the High CMC criterion and only count the initial CMCs (i.e., CMCs identified under the initially proposed method) in the other. Doing so for the currently considered non-match pair reduces the High CMC count from 32 to 28, which are visualized below.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">knmCMC_dismiss</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/cmcFilter_improved.html">cmcFilter_improved</a></span>(<span class="kw">cellCCF_bothDirections_output</span> <span class="kw">=</span> <span class="no">knmComparison</span>,
                   <span class="kw">ccf_thresh</span> <span class="kw">=</span> <span class="fl">.5</span>,
                   <span class="kw">dx_thresh</span> <span class="kw">=</span> <span class="fl">25</span>,
                   <span class="kw">theta_thresh</span> <span class="kw">=</span> <span class="fl">3</span>,
                   <span class="kw">missingTheta_decision</span> <span class="kw">=</span> <span class="st">"dismiss"</span>)

<span class="no">knmCMC_dismiss_plt</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/cmcPlot.html">cmcPlot</a></span>(<span class="kw">x3p1</span> <span class="kw">=</span> <span class="no">fadul1.1</span>$<span class="no">x3p</span>,
                              <span class="kw">x3p2</span> <span class="kw">=</span> <span class="no">fadul2.1</span>$<span class="no">x3p</span>,
                              <span class="kw">cellCCF_bothDirections_output</span> <span class="kw">=</span> <span class="no">knmComparison</span>,
                              <span class="kw">cmcFilter_improved_output</span> <span class="kw">=</span> <span class="no">knmCMC_dismiss</span>)

<span class="no">knmCMC_dismiss_plt</span>$<span class="no">highCMC</span></pre></body></html></div>
<p><img src="cmcFilter_improved-function-options_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>Finally, the most “conservative” option would be to only count High CMCs for cartridge case pairs that pass the High CMC criterion in <em>both</em> directions. That is, the pair would “fail” the High CMC criterion if either direction fails. In the event that a cartridge case pair fails the High CMC criterion for any reason, <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4730689/pdf/jres.120.008.pdf">Tong et al. (2015)</a> proposes using the minimum of the initial CMC counts determined in both directions. For the current non-match example, there were 5 initial CMCs for the “Fadul 1-1 vs. Fadul 2-1” direction and 4 initial CMCs for the “Fadul 2-1 vs. Fadul 1-1” direction. Thus, the official initial CMC count would be 4, which are visualized below.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">knmCMC_fail</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/cmcFilter_improved.html">cmcFilter_improved</a></span>(<span class="kw">cellCCF_bothDirections_output</span> <span class="kw">=</span> <span class="no">knmComparison</span>,
                                  <span class="kw">ccf_thresh</span> <span class="kw">=</span> <span class="fl">.5</span>,
                                  <span class="kw">dx_thresh</span> <span class="kw">=</span> <span class="fl">25</span>,
                                  <span class="kw">theta_thresh</span> <span class="kw">=</span> <span class="fl">3</span>,
                                  <span class="kw">missingTheta_decision</span> <span class="kw">=</span> <span class="st">"fail"</span>)

<span class="no">knmCMC_fail_plt</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/cmcPlot.html">cmcPlot</a></span>(<span class="kw">x3p1</span> <span class="kw">=</span> <span class="no">fadul1.1</span>$<span class="no">x3p</span>,
                           <span class="kw">x3p2</span> <span class="kw">=</span> <span class="no">fadul2.1</span>$<span class="no">x3p</span>,
                           <span class="kw">cellCCF_bothDirections_output</span> <span class="kw">=</span> <span class="no">knmComparison</span>,
                           <span class="kw">cmcFilter_improved_output</span> <span class="kw">=</span> <span class="no">knmCMC_fail</span>)

<span class="no">knmCMC_fail_plt</span>$<span class="no">initialCMC</span></pre></body></html></div>
<p><img src="cmcFilter_improved-function-options_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
</div>
<div id="the-compareinitialandhighthetas-argument" class="section level1">
<h1 class="hasAnchor">
<a href="#the-compareinitialandhighthetas-argument" class="anchor"></a>The <code>compareInitialAndHighThetas</code> argument</h1>
<p>Consider now the non-match comparison in which the translation thresholds are changed from <code>25</code> pixels to a slightly more restrictive <code>20</code> pixels. Even with a more restrictive translation threshold, the pair was still assigned 26 High CMCs. Consider, however, the behavior of the median <span class="math inline">\(\theta\)</span> values calculated under the initially proposed method and the High CMC method. Indeed, if we were to only consider the median <span class="math inline">\(\theta\)</span> values under the initially proposed method, they would appear to agree with each other (within <code>theta_thresh = 3</code>, at least) and similarly for the High CMC median <span class="math inline">\(\theta\)</span> values. However, the median <span class="math inline">\(\theta\)</span> values for the respective directions clearly don’t agree (<span class="math inline">\(-3\)</span> and <span class="math inline">\(15\)</span> degrees in one direction and <span class="math inline">\(6\)</span> and <span class="math inline">\(-12\)</span> degrees in the other). It’s reasonable to assume for a truly <em>matching</em> pair that the consensual <span class="math inline">\(\theta\)</span> values (where a “consensus” is determined by the median) should agree between the initially proposed and High CMC methods in both directions. Indeed, we have observed after considerable experimentation that this holds true for matching pairs. While not discussed in <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4730689/pdf/jres.120.008.pdf">Tong et al. (2015)</a>, we can use this to our advantage to weed-out non-matches that appear to have matching consensual <span class="math inline">\(\theta\)</span> values if considering the initially proposed or High CMC results independently. The <code>compareInitialAndHighThetas</code> argument can be set to <code>TRUE</code> (default is <code>FALSE</code>) to employ internal logic that determines whether the median <span class="math inline">\(\theta\)</span> values between both methods in both directions are within <code>theta_thresh</code> of each other. If a disagreement occurs, then the cartridge case pair is assigned 0 High CMCs.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">knmCMC_transThresh20</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/cmcFilter_improved.html">cmcFilter_improved</a></span>(<span class="no">knmComparison</span>,
                                           <span class="kw">ccf_thresh</span> <span class="kw">=</span> <span class="fl">.5</span>,
                                           <span class="kw">dx_thresh</span> <span class="kw">=</span> <span class="fl">20</span>,
                                           <span class="kw">theta_thresh</span> <span class="kw">=</span> <span class="fl">3</span>,
                                           <span class="kw">missingTheta_decision</span> <span class="kw">=</span> <span class="st">"replace"</span>)

<span class="co">#Initially proposed method median theta values:</span>
<span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span>(<span class="no">knmCMC_transThresh20</span>$<span class="no">initialCMCs</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">comparison</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"comparison_1to2"</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">knmCMC_transThresh20</span>$<span class="no">initialCMCs</span>$<span class="no">comparison_1to2</span>)),
                        <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"comparison_2to1"</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">knmCMC_transThresh20</span>$<span class="no">initialCMCs</span>$<span class="no">comparison_2to1</span>)))) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">comparison</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span>(<span class="kw">theta</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span>(<span class="no">theta</span>))
<span class="co">#&gt; # A tibble: 2 x 2</span>
<span class="co">#&gt;   comparison      theta</span>
<span class="co">#&gt;   &lt;chr&gt;           &lt;dbl&gt;</span>
<span class="co">#&gt; 1 comparison_1to2    -3</span>
<span class="co">#&gt; 2 comparison_2to1     6</span>

<span class="co">#High CMC method median theta values:</span>
<span class="no">knmCMC_transThresh20</span>$<span class="no">highCMCs</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">comparison</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span>(<span class="kw">theta</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span>(<span class="no">theta</span>))
<span class="co">#&gt; # A tibble: 2 x 2</span>
<span class="co">#&gt;   comparison      theta</span>
<span class="co">#&gt;   &lt;chr&gt;           &lt;dbl&gt;</span>
<span class="co">#&gt; 1 comparison_1to2    15</span>
<span class="co">#&gt; 2 comparison_2to1   -12</span></pre></body></html></div>
<p>Setting <code>compareInitialAndHighThetas = TRUE</code> for the current non-match examples yields 0 high CMCs as seen below.</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">knmCMC_transThresh20_compare</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/cmcFilter_improved.html">cmcFilter_improved</a></span>(<span class="no">knmComparison</span>,
                                           <span class="kw">ccf_thresh</span> <span class="kw">=</span> <span class="fl">.5</span>,
                                           <span class="kw">dx_thresh</span> <span class="kw">=</span> <span class="fl">20</span>,
                                           <span class="kw">theta_thresh</span> <span class="kw">=</span> <span class="fl">3</span>,
                                           <span class="kw">missingTheta_decision</span> <span class="kw">=</span> <span class="st">"replace"</span>,
                                           <span class="kw">compareInitialAndHighThetas</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">knmCMC_transThresh20_compare</span>$<span class="no">highCMCs</span>)
<span class="co">#&gt; [1] 0</span></pre></body></html></div>
<p>As an interesting final note, it’s important to realize that specifying less restrictive thresholds does not imply that a cartridge pair will be assigned a larger High CMC count (although this is the case under the initially proposed method). This is because of how the High CMCs are determined: if all restrictions were to be lifted such that all cells were declared to be CMCs, then there wouldn’t be a definite mode for the CMC count per <span class="math inline">\(\theta\)</span> distributions. This is illustrated by the non-match comparison if we change <code>theta_thresh = 3</code> to be <code>theta_thresh = 6</code>, as seen below. Making the threshold too flexible makes the cartridge case pair fail the High CMC criterion in both directions, in which case it is assigned 0 High CMCs.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">knmCMC</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/cmcFilter_improved.html">cmcFilter_improved</a></span>(<span class="no">knmComparison</span>,
                             <span class="kw">ccf_thresh</span> <span class="kw">=</span> <span class="fl">.5</span>,
                             <span class="kw">dx_thresh</span> <span class="kw">=</span> <span class="fl">20</span>,
                             <span class="kw">theta_thresh</span> <span class="kw">=</span> <span class="fl">6</span>)

<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">knmCMC</span>$<span class="no">highCMCs</span>)
<span class="co">#&gt; [1] 0</span></pre></body></html></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Joe Zemmels, Heike Hofmann, Susan VanderPlas.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
